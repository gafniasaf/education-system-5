// @ts-nocheck
"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[986],{"./src/stories/InteractiveEmbedClient.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>InteractiveEmbedClient_stories});var jsx_runtime=__webpack_require__("../../node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("../../node_modules/next/dist/compiled/react/index.js"),types=__webpack_require__("../../node_modules/zod/v3/types.js"),process=(__webpack_require__("./src/lib/serverFetch.ts"),__webpack_require__("../../node_modules/process/browser.js"));const exchangeResponse=types.Ry({runtimeToken:types.Z_(),expiresAt:types.Z_()}).partial();function createRuntimeGateway(){return function buildHttpGateway(){return{async exchange(token){{const base=process.env.NEXT_PUBLIC_BASE_URL||"",res=await fetch(`${base}/api/runtime/auth/exchange`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({token}),cache:"no-store"}),json=await res.json().catch(()=>({}));if(!res.ok)throw new Error(`HTTP ${res.status}`);return exchangeResponse.parse(json)}},async postEvent(input){{const base=process.env.NEXT_PUBLIC_BASE_URL||"",res=await fetch(`${base}/api/runtime/events`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(input),cache:"no-store"});if(!res.ok)throw new Error(`HTTP ${res.status}`)}return{ok:!0}}}}()}function InteractiveEmbedClient({courseId,src,allowedOrigin}){const frameRef=(0,react.useRef)(null),tokenRef=(0,react.useRef)(null);return(0,react.useEffect)(()=>{try{const u=new URL(src,window.location.origin);tokenRef.current=u.searchParams.get("token")}catch(e){}(async()=>{try{if(tokenRef.current&&frameRef.current&&allowedOrigin){const j=await createRuntimeGateway().exchange(tokenRef.current),rt=null==j?void 0:j.runtimeToken,expiresAt=null==j?void 0:j.expiresAt;var _frameRef_current_contentWindow;if(rt)null===(_frameRef_current_contentWindow=frameRef.current.contentWindow)||void 0===_frameRef_current_contentWindow||_frameRef_current_contentWindow.postMessage({type:"runtime.token",runtimeToken:rt,expiresAt},allowedOrigin)}}catch(e){}})();const handler=async evt=>{if(!evt||"object"!=typeof evt.data)return;if(!evt.origin||evt.origin!==allowedOrigin)return;const data=evt.data;if(data&&"string"==typeof data.type)try{await createRuntimeGateway().postEvent({courseId,event:data,token:tokenRef.current})}catch(e){}};return window.addEventListener("message",handler),()=>window.removeEventListener("message",handler)},[courseId,allowedOrigin,src]),(0,jsx_runtime.jsx)("section",{className:"border rounded",children:(0,jsx_runtime.jsx)("iframe",{ref:frameRef,src,className:"w-full h-[480px]",sandbox:"allow-scripts allow-forms allow-pointer-lock allow-same-origin"})})}InteractiveEmbedClient.__docgenInfo={description:"",methods:[],displayName:"InteractiveEmbedClient",props:{courseId:{required:!0,tsType:{name:"string"},description:""},src:{required:!0,tsType:{name:"string"},description:""},allowedOrigin:{required:!0,tsType:{name:"string"},description:""}}};const launchUrl="https://provider.example.com/launch?course=demo",allowed=(()=>{try{const u=new URL(launchUrl);return`${u.protocol}//${u.host}`}catch(e){return"https://provider.example.com"}})(),InteractiveEmbedClient_stories={title:"Student/InteractiveEmbed",component:InteractiveEmbedClient,parameters:{layout:"fullscreen"}},Default={args:{courseId:"course-1",src:`${launchUrl}&token=storybook`,allowedOrigin:allowed},render:args=>(0,jsx_runtime.jsx)(InteractiveEmbedClient,{...args})},__namedExportsOrder=["Default"];Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:'{\n  args: {\n    courseId: "course-1" as any,\n    src: `${launchUrl}&token=storybook`,\n    allowedOrigin: allowed\n  },\n  render: args => <InteractiveEmbedClient {...args as any} />\n}',...Default.parameters?.docs?.source}}}},"./src/lib/serverFetch.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__("../../node_modules/process/browser.js"),__webpack_require__("../../node_modules/console-browserify/index.js")}}]);