{"numFailedTestSuites":115,"numFailedTests":155,"numPassedTestSuites":224,"numPassedTests":454,"numPendingTestSuites":0,"numPendingTests":1,"numRuntimeErrorTestSuites":0,"numTodoTests":14,"numTotalTestSuites":339,"numTotalTests":624,"openHandles":[],"snapshot":{"added":0,"didUpdate":false,"failure":false,"filesAdded":0,"filesRemoved":0,"filesRemovedList":[],"filesUnmatched":0,"filesUpdated":0,"matched":0,"total":0,"unchecked":0,"uncheckedKeysByFile":[],"unmatched":0,"updated":0},"startTime":1756202394705,"success":false,"testResults":[{"assertionResults":[{"ancestorTitles":[],"duration":143,"failureDetails":[],"failureMessages":[],"fullName":"Mark all read calls API and updates list + toast","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"Mark all read calls API and updates list + toast"},{"ancestorTitles":[],"duration":1074,"failureDetails":[{"matcherResult":{"actual":20,"expected":2,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 2\nReceived: 20","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 2\nReceived: 20\n\nIgnored nodes: comments, script, style\n\u001b[36m<html>\u001b[39m\n  \u001b[36m<head />\u001b[39m\n  \u001b[36m<body>\u001b[39m\n    \u001b[36m<div>\u001b[39m\n      \u001b[36m<div\u001b[39m\n        \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-list\"\u001b[39m\n      \u001b[36m>\u001b[39m\n        \u001b[36m<div\u001b[39m\n          \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between mb-2\"\u001b[39m\n        \u001b[36m>\u001b[39m\n          \u001b[36m<span\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"font-medium\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[0mNotifications\u001b[0m\n          \u001b[36m</span>\u001b[39m\n          \u001b[36m<button\u001b[39m\n            \u001b[33maria-label\u001b[39m=\u001b[32m\"Mark all notifications as read\"\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"underline text-xs\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-mark-all\"\u001b[39m\n            \u001b[33mtitle\u001b[39m=\u001b[32m\"Mark all read\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[0mMark all\u001b[0m\n          \u001b[36m</button>\u001b[39m\n        \u001b[36m</div>\u001b[39m\n        \u001b[36m<ul\u001b[39m\n          \u001b[33mclass\u001b[39m=\u001b[32m\"space-y-2\"\u001b[39m\n        \u001b[36m>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0msubmission:graded\u001b[0m\n              \u001b[36m</span>\u001b[39m\n              \u001b[36m<span\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[0mScore: \u001b[0m\n                \u001b[0m80\u001b[0m\n              \u001b[36m</span>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n            \u001b[36m<button\u001b[39m\n              \u001b[33maria-label\u001b[39m=\u001b[32m\"Mark notification no-0000 as read\"\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"underline text-xs\"\u001b[39m\n              \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-read-btn\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[0mRead\u001b[0m\n            \u001b[36m</button>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0mmessage:new\u001b[0m\n              \u001b[36m</span>\u001b[39m\n              \u001b[36m<a\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2 underline\"\u001b[39m\n                \u001b[33mhref\u001b[39m=\u001b[32m\"/labs/system/inbox?thread=th-1\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[0mOpen thread\u001b[0m\n              \u001b[36m</a>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0mannouncement:published\u001b[0m\n              \u001b[36m</span>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0msubmission:graded\u001b[0m\n              \u001b[36m</span>\u001b[39m\n              \u001b[36m<span\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[0mScore: \u001b[0m\n                \u001b[0m83\u001b[0m\n              \u001b[36m</span>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0mmessage:new\u001b[0m\n              \u001b[36m</span>\u001b[39m\n              \u001b[36m<a\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2 underline\"\u001b[39m\n                \u001b[33mhref\u001b[39m=\u001b[32m\"/labs/system/inbox?thread=th-4\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[0mOpen thread\u001b[0m\n              \u001b[36m</a>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0mannouncement:published\u001b[0m\n              \u001b[36m</span>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n            \u001b[36m<button\u001b[39m\n              \u001b[33maria-label\u001b[39m=\u001b[32m\"Mark notification no-0005 as read\"\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"underline text-xs\"\u001b[39m\n              \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-read-btn\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[0mRead\u001b[0m\n            \u001b[36m</button>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0msubmission:graded\u001b[0m\n              \u001b[36m</span>\u001b[39m\n              \u001b[36m<span\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[0mScore: \u001b[0m\n                \u001b[0m86\u001b[0m\n              \u001b[36m</span>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0mmessage:new\u001b[0m\n              \u001b[36m</span>\u001b[39m\n              \u001b[36m<a\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2 underline\"\u001b[39m\n                \u001b[33mhref\u001b[39m=\u001b[32m\"/labs/system/inbox?thread=th-7\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[0mOpen thread\u001b[0m\n              \u001b[36m</a>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0mannouncement:published\u001b[0m\n              \u001b[36m</span>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0msubmission:graded\u001b[0m\n              \u001b[36m</span>\u001b[39m\n              \u001b[36m<span\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[0mScore: \u001b[0m\n                \u001b[0m89\u001b[0m\n              \u001b[36m</span>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0mmessage:new\u001b[0m\n              \u001b[36m</span>\u001b[39m\n              \u001b[36m<a\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2 underline\"\u001b[39m\n                \u001b[33mhref\u001b[39m=\u001b[32m\"/labs/system/inbox?thread=th-10\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[0mOpen thread\u001b[0m\n              \u001b[36m</a>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n            \u001b[36m<button\u001b[39m\n              \u001b[33maria-label\u001b[39m=\u001b[32m\"Mark notification no-0010 as read\"\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"underline text-xs\"\u001b[39m\n              \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-read-btn\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[0mRead\u001b[0m\n            \u001b[36m</button>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0mannouncement:published\u001b[0m\n              \u001b[36m</span>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0msubmission:graded\u001b[0m\n              \u001b[36m</span>\u001b[39m\n              \u001b[36m<span\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[0mScore: \u001b[0m\n                \u001b[0m92\u001b[0m\n              \u001b[36m</span>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0mmessage:new\u001b[0m\n              \u001b[36m</span>\u001b[39m\n              \u001b[36m<a\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2 underline\"\u001b[39m\n                \u001b[33mhref\u001b[39m=\u001b[32m\"/labs/system/inbox?thread=th-13\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[0mOpen thread\u001b[0m\n              \u001b[36m</a>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0mannouncement:published\u001b[0m\n              \u001b[36m</span>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0msubmission:graded\u001b[0m\n              \u001b[36m</span>\u001b[39m\n              \u001b[36m<span\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[0mScore: \u001b[0m\n                \u001b[0m95\u001b[0m\n              \u001b[36m</span>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n            \u001b[36m<button\u001b[39m\n              \u001b[33maria-label\u001b[39m=\u001b[32m\"Mark notification no-0015 as read\"\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"underline text-xs\"\u001b[39m\n              \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-read-btn\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[0mRead\u001b[0m\n            \u001b[36m</button>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0mmessage:new\u001b[0m\n              \u001b[36m</span>\u001b[39m\n              \u001b[36m<a\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2 underline\"\u001b[39m\n                \u001b[33mhref\u001b[39m=\u001b[32m\"/labs/system/inbox?thread=th-16\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[0mOpen thread\u001b[0m\n              \u001b[36m</a>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0mannouncement:published\u001b[0m\n              \u001b[36m</span>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0msubmission:graded\u001b[0m\n              \u001b[36m</span>\u001b[39m\n              \u001b[36m<span\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[0mScore: \u001b[0m\n                \u001b[0m98\u001b[0m\n              \u001b[36m</span>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n          \u001b[36m<li\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span>\u001b[39m\n                \u001b[0mmessage:new\u001b[0m\n              \u001b[36m</span>\u001b[39m\n              \u001b[36m<a\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2 underline\"\u001b[39m\n                \u001b[33mhref\u001b[39m=\u001b[32m\"/labs/system/inbox?thread=th-19\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[0mOpen thread\u001b[0m\n              \u001b[36m</a>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n          \u001b[36m</li>\u001b[39m\n        \u001b[36m</ul>\u001b[39m\n        \u001b[36m<div\u001b[39m\n          \u001b[33mclass\u001b[39m=\u001b[32m\"mt-2 flex justify-end\"\u001b[39m\n        \u001b[36m>\u001b[39m\n          \u001b[36m<button\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"underline text-xs\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-load-more\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[0mLoad more\u001b[0m\n          \u001b[36m</button>\u001b[39m\n        \u001b[36m</div>\u001b[39m\n      \u001b[36m</div>\u001b[39m\n    \u001b[36m</div>\u001b[39m\n  \u001b[36m</body>\u001b[39m\n\u001b[36m</html>\u001b[39m\n    at C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\NotificationsDropdownClient.spec.tsx:57:74\n    at runWithExpensiveErrorDiagnosticsDisabled (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\@testing-library\\dom\\dist\\config.js:47:12)\n    at checkCallback (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\@testing-library\\dom\\dist\\wait-for.js:124:77)\n    at checkRealTimersCallback (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\@testing-library\\dom\\dist\\wait-for.js:118:16)\n    at Timeout.task [as _onTimeout] (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jsdom\\lib\\jsdom\\browser\\Window.js:579:19)\n    at listOnTimeout (node:internal/timers:588:17)\n    at processTimers (node:internal/timers:523:7)"],"fullName":"Load more appends items","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"Load more appends items"}],"endTime":1756202399659,"message":"  ● Load more appends items\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 2\n    Received: 20\n\n    Ignored nodes: comments, script, style\n    \u001b[36m<html>\u001b[39m\n      \u001b[36m<head />\u001b[39m\n      \u001b[36m<body>\u001b[39m\n        \u001b[36m<div>\u001b[39m\n          \u001b[36m<div\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-list\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between mb-2\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<span\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"font-medium\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[0mNotifications\u001b[0m\n              \u001b[36m</span>\u001b[39m\n              \u001b[36m<button\u001b[39m\n                \u001b[33maria-label\u001b[39m=\u001b[32m\"Mark all notifications as read\"\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"underline text-xs\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-mark-all\"\u001b[39m\n                \u001b[33mtitle\u001b[39m=\u001b[32m\"Mark all read\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[0mMark all\u001b[0m\n              \u001b[36m</button>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n            \u001b[36m<ul\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"space-y-2\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0msubmission:graded\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                  \u001b[36m<span\u001b[39m\n                    \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2\"\u001b[39m\n                  \u001b[36m>\u001b[39m\n                    \u001b[0mScore: \u001b[0m\n                    \u001b[0m80\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n                \u001b[36m<button\u001b[39m\n                  \u001b[33maria-label\u001b[39m=\u001b[32m\"Mark notification no-0000 as read\"\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"underline text-xs\"\u001b[39m\n                  \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-read-btn\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[0mRead\u001b[0m\n                \u001b[36m</button>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0mmessage:new\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                  \u001b[36m<a\u001b[39m\n                    \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2 underline\"\u001b[39m\n                    \u001b[33mhref\u001b[39m=\u001b[32m\"/labs/system/inbox?thread=th-1\"\u001b[39m\n                  \u001b[36m>\u001b[39m\n                    \u001b[0mOpen thread\u001b[0m\n                  \u001b[36m</a>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0mannouncement:published\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0msubmission:graded\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                  \u001b[36m<span\u001b[39m\n                    \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2\"\u001b[39m\n                  \u001b[36m>\u001b[39m\n                    \u001b[0mScore: \u001b[0m\n                    \u001b[0m83\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0mmessage:new\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                  \u001b[36m<a\u001b[39m\n                    \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2 underline\"\u001b[39m\n                    \u001b[33mhref\u001b[39m=\u001b[32m\"/labs/system/inbox?thread=th-4\"\u001b[39m\n                  \u001b[36m>\u001b[39m\n                    \u001b[0mOpen thread\u001b[0m\n                  \u001b[36m</a>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0mannouncement:published\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n                \u001b[36m<button\u001b[39m\n                  \u001b[33maria-label\u001b[39m=\u001b[32m\"Mark notification no-0005 as read\"\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"underline text-xs\"\u001b[39m\n                  \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-read-btn\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[0mRead\u001b[0m\n                \u001b[36m</button>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0msubmission:graded\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                  \u001b[36m<span\u001b[39m\n                    \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2\"\u001b[39m\n                  \u001b[36m>\u001b[39m\n                    \u001b[0mScore: \u001b[0m\n                    \u001b[0m86\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0mmessage:new\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                  \u001b[36m<a\u001b[39m\n                    \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2 underline\"\u001b[39m\n                    \u001b[33mhref\u001b[39m=\u001b[32m\"/labs/system/inbox?thread=th-7\"\u001b[39m\n                  \u001b[36m>\u001b[39m\n                    \u001b[0mOpen thread\u001b[0m\n                  \u001b[36m</a>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0mannouncement:published\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0msubmission:graded\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                  \u001b[36m<span\u001b[39m\n                    \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2\"\u001b[39m\n                  \u001b[36m>\u001b[39m\n                    \u001b[0mScore: \u001b[0m\n                    \u001b[0m89\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0mmessage:new\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                  \u001b[36m<a\u001b[39m\n                    \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2 underline\"\u001b[39m\n                    \u001b[33mhref\u001b[39m=\u001b[32m\"/labs/system/inbox?thread=th-10\"\u001b[39m\n                  \u001b[36m>\u001b[39m\n                    \u001b[0mOpen thread\u001b[0m\n                  \u001b[36m</a>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n                \u001b[36m<button\u001b[39m\n                  \u001b[33maria-label\u001b[39m=\u001b[32m\"Mark notification no-0010 as read\"\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"underline text-xs\"\u001b[39m\n                  \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-read-btn\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[0mRead\u001b[0m\n                \u001b[36m</button>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0mannouncement:published\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0msubmission:graded\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                  \u001b[36m<span\u001b[39m\n                    \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2\"\u001b[39m\n                  \u001b[36m>\u001b[39m\n                    \u001b[0mScore: \u001b[0m\n                    \u001b[0m92\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0mmessage:new\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                  \u001b[36m<a\u001b[39m\n                    \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2 underline\"\u001b[39m\n                    \u001b[33mhref\u001b[39m=\u001b[32m\"/labs/system/inbox?thread=th-13\"\u001b[39m\n                  \u001b[36m>\u001b[39m\n                    \u001b[0mOpen thread\u001b[0m\n                  \u001b[36m</a>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0mannouncement:published\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0msubmission:graded\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                  \u001b[36m<span\u001b[39m\n                    \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2\"\u001b[39m\n                  \u001b[36m>\u001b[39m\n                    \u001b[0mScore: \u001b[0m\n                    \u001b[0m95\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n                \u001b[36m<button\u001b[39m\n                  \u001b[33maria-label\u001b[39m=\u001b[32m\"Mark notification no-0015 as read\"\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"underline text-xs\"\u001b[39m\n                  \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-read-btn\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[0mRead\u001b[0m\n                \u001b[36m</button>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0mmessage:new\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                  \u001b[36m<a\u001b[39m\n                    \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2 underline\"\u001b[39m\n                    \u001b[33mhref\u001b[39m=\u001b[32m\"/labs/system/inbox?thread=th-16\"\u001b[39m\n                  \u001b[36m>\u001b[39m\n                    \u001b[0mOpen thread\u001b[0m\n                  \u001b[36m</a>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0mannouncement:published\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0msubmission:graded\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                  \u001b[36m<span\u001b[39m\n                    \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2\"\u001b[39m\n                  \u001b[36m>\u001b[39m\n                    \u001b[0mScore: \u001b[0m\n                    \u001b[0m98\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n              \u001b[36m<li\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"flex items-center justify-between gap-2\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-item\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[36m<div\u001b[39m\n                  \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-500\"\u001b[39m\n                \u001b[36m>\u001b[39m\n                  \u001b[36m<span>\u001b[39m\n                    \u001b[0mmessage:new\u001b[0m\n                  \u001b[36m</span>\u001b[39m\n                  \u001b[36m<a\u001b[39m\n                    \u001b[33mclass\u001b[39m=\u001b[32m\"ml-2 underline\"\u001b[39m\n                    \u001b[33mhref\u001b[39m=\u001b[32m\"/labs/system/inbox?thread=th-19\"\u001b[39m\n                  \u001b[36m>\u001b[39m\n                    \u001b[0mOpen thread\u001b[0m\n                  \u001b[36m</a>\u001b[39m\n                \u001b[36m</div>\u001b[39m\n              \u001b[36m</li>\u001b[39m\n            \u001b[36m</ul>\u001b[39m\n            \u001b[36m<div\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"mt-2 flex justify-end\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[36m<button\u001b[39m\n                \u001b[33mclass\u001b[39m=\u001b[32m\"underline text-xs\"\u001b[39m\n                \u001b[33mdata-testid\u001b[39m=\u001b[32m\"notif-load-more\"\u001b[39m\n              \u001b[36m>\u001b[39m\n                \u001b[0mLoad more\u001b[0m\n              \u001b[36m</button>\u001b[39m\n            \u001b[36m</div>\u001b[39m\n          \u001b[36m</div>\u001b[39m\n        \u001b[36m</div>\u001b[39m\n      \u001b[36m</body>\u001b[39m\n    \u001b[36m</html>\u001b[39m\n\n    \u001b[0m \u001b[90m 55 |\u001b[39m   render(\u001b[33m<\u001b[39m\u001b[33mNotificationsDropdownClient\u001b[39m initial\u001b[33m=\u001b[39m{[]} \u001b[33m/\u001b[39m\u001b[33m>\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 56 |\u001b[39m   \u001b[36mawait\u001b[39m user\u001b[33m.\u001b[39mclick(screen\u001b[33m.\u001b[39mgetByTestId(\u001b[32m'notif-load-more'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 57 |\u001b[39m   \u001b[36mawait\u001b[39m waitFor(() \u001b[33m=>\u001b[39m expect(screen\u001b[33m.\u001b[39mgetAllByTestId(\u001b[32m'notif-item'\u001b[39m)\u001b[33m.\u001b[39mlength)\u001b[33m.\u001b[39mtoBe(\u001b[35m2\u001b[39m))\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                                                                          \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 58 |\u001b[39m   restore()\u001b[33m;\u001b[39m\n     \u001b[90m 59 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 60 |\u001b[39m\u001b[0m\n\n      at unit/ui/NotificationsDropdownClient.spec.tsx:57:74\n      at runWithExpensiveErrorDiagnosticsDisabled (../node_modules/@testing-library/dom/dist/config.js:47:12)\n      at checkCallback (../node_modules/@testing-library/dom/dist/wait-for.js:124:77)\n      at checkRealTimersCallback (../node_modules/@testing-library/dom/dist/wait-for.js:118:16)\n      at Timeout.task [as _onTimeout] (../node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\NotificationsDropdownClient.spec.tsx","startTime":1756202395825,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Student Study Digest (labs)"],"duration":1014,"failureDetails":[{"name":"TestingLibraryElementError"}],"failureMessages":["Error: Unable to find an element by: [data-testid=\"digest-grid\"]\n\nIgnored nodes: comments, script, style\n\u001b[36m<body>\u001b[39m\n  \u001b[36m<div>\u001b[39m\n    \u001b[36m<main\u001b[39m\n      \u001b[33mclass\u001b[39m=\u001b[32m\"p-6\"\u001b[39m\n    \u001b[36m>\u001b[39m\n      \u001b[36m<p\u001b[39m\n        \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-700\"\u001b[39m\n      \u001b[36m>\u001b[39m\n        \u001b[0mYou are not signed in.\u001b[0m\n        \u001b[0m \u001b[0m\n        \u001b[0m \u001b[0m\n        \u001b[36m<a\u001b[39m\n          \u001b[33mclass\u001b[39m=\u001b[32m\"underline\"\u001b[39m\n          \u001b[33mhref\u001b[39m=\u001b[32m\"/login\"\u001b[39m\n        \u001b[36m>\u001b[39m\n          \u001b[0mSign in\u001b[0m\n        \u001b[36m</a>\u001b[39m\n      \u001b[36m</p>\u001b[39m\n    \u001b[36m</main>\u001b[39m\n  \u001b[36m</div>\u001b[39m\n\u001b[36m</body>\u001b[39m\n    at waitForWrapper (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\@testing-library\\dom\\dist\\wait-for.js:163:27)\n    at C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\@testing-library\\dom\\dist\\query-helpers.js:86:33\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\StudentStudyDigest.spec.tsx:30:18)"],"fullName":"Student Study Digest (labs) renders digest cards with MSW jitter","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"renders digest cards with MSW jitter"}],"endTime":1756202402003,"message":"  ● Student Study Digest (labs) › renders digest cards with MSW jitter\n\n    Unable to find an element by: [data-testid=\"digest-grid\"]\n\n    Ignored nodes: comments, script, style\n    \u001b[36m<body>\u001b[39m\n      \u001b[36m<div>\u001b[39m\n        \u001b[36m<main\u001b[39m\n          \u001b[33mclass\u001b[39m=\u001b[32m\"p-6\"\u001b[39m\n        \u001b[36m>\u001b[39m\n          \u001b[36m<p\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-700\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[0mYou are not signed in.\u001b[0m\n            \u001b[0m \u001b[0m\n            \u001b[0m \u001b[0m\n            \u001b[36m<a\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"underline\"\u001b[39m\n              \u001b[33mhref\u001b[39m=\u001b[32m\"/login\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[0mSign in\u001b[0m\n            \u001b[36m</a>\u001b[39m\n          \u001b[36m</p>\u001b[39m\n        \u001b[36m</main>\u001b[39m\n      \u001b[36m</div>\u001b[39m\n    \u001b[36m</body>\u001b[39m\n\n    \u001b[0m \u001b[90m 28 |\u001b[39m     \u001b[36mconst\u001b[39m ui \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m \u001b[33mStudentStudyDigestPage\u001b[39m()\u001b[33m;\u001b[39m\n     \u001b[90m 29 |\u001b[39m     render(ui)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 30 |\u001b[39m     \u001b[36mawait\u001b[39m screen\u001b[33m.\u001b[39mfindByTestId(\u001b[32m'digest-grid'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                  \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 31 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 32 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 33 |\u001b[39m\u001b[0m\n\n      at waitForWrapper (../node_modules/@testing-library/dom/dist/wait-for.js:163:27)\n      at ../node_modules/@testing-library/dom/dist/query-helpers.js:86:33\n      at Object.<anonymous> (unit/ui/StudentStudyDigest.spec.tsx:30:18)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\StudentStudyDigest.spec.tsx","startTime":1756202400629,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Student Profile (labs)"],"duration":1015,"failureDetails":[{"name":"TestingLibraryElementError"}],"failureMessages":["Error: Unable to find an element by: [data-testid=\"profile-email\"]\n\nIgnored nodes: comments, script, style\n\u001b[36m<body>\u001b[39m\n  \u001b[36m<div>\u001b[39m\n    \u001b[36m<main\u001b[39m\n      \u001b[33mclass\u001b[39m=\u001b[32m\"p-6 space-y-3\"\u001b[39m\n    \u001b[36m>\u001b[39m\n      \u001b[36m<h1\u001b[39m\n        \u001b[33mclass\u001b[39m=\u001b[32m\"text-xl font-semibold\"\u001b[39m\n        \u001b[33mdata-testid\u001b[39m=\u001b[32m\"profile-title\"\u001b[39m\n      \u001b[36m>\u001b[39m\n        \u001b[0mStudent Profile\u001b[0m\n      \u001b[36m</h1>\u001b[39m\n      \u001b[36m<p\u001b[39m\n        \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-700\"\u001b[39m\n        \u001b[33mdata-testid\u001b[39m=\u001b[32m\"signin-prompt\"\u001b[39m\n      \u001b[36m>\u001b[39m\n        \u001b[0mYou are not signed in\u001b[0m\n      \u001b[36m</p>\u001b[39m\n      \u001b[36m<a\u001b[39m\n        \u001b[33mclass\u001b[39m=\u001b[32m\"underline\"\u001b[39m\n        \u001b[33mdata-testid\u001b[39m=\u001b[32m\"signin-link\"\u001b[39m\n        \u001b[33mhref\u001b[39m=\u001b[32m\"/login\"\u001b[39m\n      \u001b[36m>\u001b[39m\n        \u001b[0mGo to login\u001b[0m\n      \u001b[36m</a>\u001b[39m\n    \u001b[36m</main>\u001b[39m\n  \u001b[36m</div>\u001b[39m\n\u001b[36m</body>\u001b[39m\n    at waitForWrapper (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\@testing-library\\dom\\dist\\wait-for.js:163:27)\n    at C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\@testing-library\\dom\\dist\\query-helpers.js:86:33\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\StudentProfile.spec.tsx:17:25)"],"fullName":"Student Profile (labs) renders email and role when authenticated","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"renders email and role when authenticated"}],"endTime":1756202403298,"message":"  ● Student Profile (labs) › renders email and role when authenticated\n\n    Unable to find an element by: [data-testid=\"profile-email\"]\n\n    Ignored nodes: comments, script, style\n    \u001b[36m<body>\u001b[39m\n      \u001b[36m<div>\u001b[39m\n        \u001b[36m<main\u001b[39m\n          \u001b[33mclass\u001b[39m=\u001b[32m\"p-6 space-y-3\"\u001b[39m\n        \u001b[36m>\u001b[39m\n          \u001b[36m<h1\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"text-xl font-semibold\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"profile-title\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[0mStudent Profile\u001b[0m\n          \u001b[36m</h1>\u001b[39m\n          \u001b[36m<p\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-700\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"signin-prompt\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[0mYou are not signed in\u001b[0m\n          \u001b[36m</p>\u001b[39m\n          \u001b[36m<a\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"underline\"\u001b[39m\n            \u001b[33mdata-testid\u001b[39m=\u001b[32m\"signin-link\"\u001b[39m\n            \u001b[33mhref\u001b[39m=\u001b[32m\"/login\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[0mGo to login\u001b[0m\n          \u001b[36m</a>\u001b[39m\n        \u001b[36m</main>\u001b[39m\n      \u001b[36m</div>\u001b[39m\n    \u001b[36m</body>\u001b[39m\n\n    \u001b[0m \u001b[90m 15 |\u001b[39m     \u001b[36mconst\u001b[39m ui \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m \u001b[33mStudentProfilePage\u001b[39m()\u001b[33m;\u001b[39m\n     \u001b[90m 16 |\u001b[39m     render(ui)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 17 |\u001b[39m     expect(\u001b[36mawait\u001b[39m screen\u001b[33m.\u001b[39mfindByTestId(\u001b[32m'profile-email'\u001b[39m))\u001b[33m.\u001b[39mtoHaveTextContent(\u001b[32m's@example.com'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                         \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 18 |\u001b[39m     expect(\u001b[36mawait\u001b[39m screen\u001b[33m.\u001b[39mfindByTestId(\u001b[32m'profile-role'\u001b[39m))\u001b[33m.\u001b[39mtoHaveTextContent(\u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 19 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 20 |\u001b[39m })\u001b[33m;\u001b[39m\u001b[0m\n\n      at waitForWrapper (../node_modules/@testing-library/dom/dist/wait-for.js:163:27)\n      at ../node_modules/@testing-library/dom/dist/query-helpers.js:86:33\n      at Object.<anonymous> (unit/ui/StudentProfile.spec.tsx:17:25)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\StudentProfile.spec.tsx","startTime":1756202402021,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Student Learning Overview (detailed)"],"duration":1017,"failureDetails":[{"name":"TestingLibraryElementError"}],"failureMessages":["Error: Unable to find an element by: [data-testid=\"learning-grid\"]\n\nIgnored nodes: comments, script, style\n\u001b[36m<body>\u001b[39m\n  \u001b[36m<div>\u001b[39m\n    \u001b[36m<main\u001b[39m\n      \u001b[33mclass\u001b[39m=\u001b[32m\"p-6\"\u001b[39m\n    \u001b[36m>\u001b[39m\n      \u001b[36m<p\u001b[39m\n        \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-700\"\u001b[39m\n      \u001b[36m>\u001b[39m\n        \u001b[0mYou are not signed in.\u001b[0m\n        \u001b[0m \u001b[0m\n        \u001b[0m \u001b[0m\n        \u001b[36m<a\u001b[39m\n          \u001b[33mclass\u001b[39m=\u001b[32m\"underline\"\u001b[39m\n          \u001b[33mhref\u001b[39m=\u001b[32m\"/login\"\u001b[39m\n        \u001b[36m>\u001b[39m\n          \u001b[0mSign in\u001b[0m\n        \u001b[36m</a>\u001b[39m\n      \u001b[36m</p>\u001b[39m\n    \u001b[36m</main>\u001b[39m\n  \u001b[36m</div>\u001b[39m\n\u001b[36m</body>\u001b[39m\n    at waitForWrapper (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\@testing-library\\dom\\dist\\wait-for.js:163:27)\n    at C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\@testing-library\\dom\\dist\\query-helpers.js:86:33\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\StudentLearningOverviewDetailed.spec.tsx:29:18)"],"fullName":"Student Learning Overview (detailed) renders cards and counts with jitter","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"renders cards and counts with jitter"}],"endTime":1756202404641,"message":"  ● Student Learning Overview (detailed) › renders cards and counts with jitter\n\n    Unable to find an element by: [data-testid=\"learning-grid\"]\n\n    Ignored nodes: comments, script, style\n    \u001b[36m<body>\u001b[39m\n      \u001b[36m<div>\u001b[39m\n        \u001b[36m<main\u001b[39m\n          \u001b[33mclass\u001b[39m=\u001b[32m\"p-6\"\u001b[39m\n        \u001b[36m>\u001b[39m\n          \u001b[36m<p\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-700\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[0mYou are not signed in.\u001b[0m\n            \u001b[0m \u001b[0m\n            \u001b[0m \u001b[0m\n            \u001b[36m<a\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"underline\"\u001b[39m\n              \u001b[33mhref\u001b[39m=\u001b[32m\"/login\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[0mSign in\u001b[0m\n            \u001b[36m</a>\u001b[39m\n          \u001b[36m</p>\u001b[39m\n        \u001b[36m</main>\u001b[39m\n      \u001b[36m</div>\u001b[39m\n    \u001b[36m</body>\u001b[39m\n\n    \u001b[0m \u001b[90m 27 |\u001b[39m     \u001b[36mconst\u001b[39m ui \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m \u001b[33mStudentLearningOverviewDetailedPage\u001b[39m()\u001b[33m;\u001b[39m\n     \u001b[90m 28 |\u001b[39m     render(ui)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 29 |\u001b[39m     \u001b[36mawait\u001b[39m screen\u001b[33m.\u001b[39mfindByTestId(\u001b[32m'learning-grid'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                  \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 30 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 31 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 32 |\u001b[39m\u001b[0m\n\n      at waitForWrapper (../node_modules/@testing-library/dom/dist/wait-for.js:163:27)\n      at ../node_modules/@testing-library/dom/dist/query-helpers.js:86:33\n      at Object.<anonymous> (unit/ui/StudentLearningOverviewDetailed.spec.tsx:29:18)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\StudentLearningOverviewDetailed.spec.tsx","startTime":1756202403308,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["System Uptime Tile (labs)"],"duration":1026,"failureDetails":[{"name":"TestingLibraryElementError"}],"failureMessages":["Error: Unable to find an element by: [data-testid=\"uptime-ok\"]\n\nIgnored nodes: comments, script, style\n\u001b[36m<body>\u001b[39m\n  \u001b[36m<div>\u001b[39m\n    \u001b[36m<main\u001b[39m\n      \u001b[33mclass\u001b[39m=\u001b[32m\"p-6\"\u001b[39m\n    \u001b[36m>\u001b[39m\n      \u001b[36m<h1\u001b[39m\n        \u001b[33mclass\u001b[39m=\u001b[32m\"text-xl font-semibold\"\u001b[39m\n      \u001b[36m>\u001b[39m\n        \u001b[0mSystem uptime\u001b[0m\n      \u001b[36m</h1>\u001b[39m\n      \u001b[36m<p\u001b[39m\n        \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-700\"\u001b[39m\n      \u001b[36m>\u001b[39m\n        \u001b[0mUnable to load uptime.\u001b[0m\n      \u001b[36m</p>\u001b[39m\n    \u001b[36m</main>\u001b[39m\n  \u001b[36m</div>\u001b[39m\n\u001b[36m</body>\u001b[39m\n    at waitForWrapper (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\@testing-library\\dom\\dist\\wait-for.js:163:27)\n    at C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\@testing-library\\dom\\dist\\query-helpers.js:86:33\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemUptimeTile.spec.tsx:18:18)"],"fullName":"System Uptime Tile (labs) renders ok and ts fields under jitter","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"renders ok and ts fields under jitter"}],"endTime":1756202406199,"message":"  ● System Uptime Tile (labs) › renders ok and ts fields under jitter\n\n    Unable to find an element by: [data-testid=\"uptime-ok\"]\n\n    Ignored nodes: comments, script, style\n    \u001b[36m<body>\u001b[39m\n      \u001b[36m<div>\u001b[39m\n        \u001b[36m<main\u001b[39m\n          \u001b[33mclass\u001b[39m=\u001b[32m\"p-6\"\u001b[39m\n        \u001b[36m>\u001b[39m\n          \u001b[36m<h1\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"text-xl font-semibold\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[0mSystem uptime\u001b[0m\n          \u001b[36m</h1>\u001b[39m\n          \u001b[36m<p\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-700\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[0mUnable to load uptime.\u001b[0m\n          \u001b[36m</p>\u001b[39m\n        \u001b[36m</main>\u001b[39m\n      \u001b[36m</div>\u001b[39m\n    \u001b[36m</body>\u001b[39m\n\n    \u001b[0m \u001b[90m 16 |\u001b[39m     \u001b[36mconst\u001b[39m ui \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m \u001b[33mUptimeTilePage\u001b[39m()\u001b[33m;\u001b[39m\n     \u001b[90m 17 |\u001b[39m     render(ui)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 18 |\u001b[39m     \u001b[36mawait\u001b[39m screen\u001b[33m.\u001b[39mfindByTestId(\u001b[32m'uptime-ok'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                  \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 19 |\u001b[39m     \u001b[36mawait\u001b[39m screen\u001b[33m.\u001b[39mfindByTestId(\u001b[32m'uptime-ts-iso'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 20 |\u001b[39m     \u001b[36mawait\u001b[39m screen\u001b[33m.\u001b[39mfindByTestId(\u001b[32m'uptime-ts-human'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 21 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at waitForWrapper (../node_modules/@testing-library/dom/dist/wait-for.js:163:27)\n      at ../node_modules/@testing-library/dom/dist/query-helpers.js:86:33\n      at Object.<anonymous> (unit/ui/SystemUptimeTile.spec.tsx:18:18)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemUptimeTile.spec.tsx","startTime":1756202404662,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Teacher Announcements (labs)"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: c.getAll is not a function\n    at TeacherAnnouncementsPage (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\app\\labs\\teacher\\announcements\\page.tsx:13:45)\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\TeacherAnnouncements.spec.tsx:25:46)\n    at Promise.then.completed (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"Teacher Announcements (labs) renders course count and announcement list with jitter","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"renders course count and announcement list with jitter"}],"endTime":1756202406486,"message":"  ● Teacher Announcements (labs) › renders course count and announcement list with jitter\n\n    TypeError: c.getAll is not a function\n\n    \u001b[0m \u001b[90m 11 |\u001b[39m   \u001b[36mconst\u001b[39m h \u001b[33m=\u001b[39m headers()\u001b[33m;\u001b[39m\n     \u001b[90m 12 |\u001b[39m   \u001b[36mconst\u001b[39m c \u001b[33m=\u001b[39m cookies()\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 13 |\u001b[39m   \u001b[36mconst\u001b[39m cookieHeader \u001b[33m=\u001b[39m h\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"cookie\"\u001b[39m) \u001b[33m?\u001b[39m\u001b[33m?\u001b[39m c\u001b[33m.\u001b[39mgetAll()\u001b[33m.\u001b[39mmap(x \u001b[33m=>\u001b[39m \u001b[32m`${x.name}=${x.value}`\u001b[39m)\u001b[33m.\u001b[39mjoin(\u001b[32m\"; \"\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                                             \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 14 |\u001b[39m   \u001b[36mconst\u001b[39m testAuth \u001b[33m=\u001b[39m h\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"x-test-auth\"\u001b[39m) \u001b[33m?\u001b[39m\u001b[33m?\u001b[39m c\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"x-test-auth\"\u001b[39m)\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mvalue\u001b[33m;\u001b[39m\n     \u001b[90m 15 |\u001b[39m\n     \u001b[90m 16 |\u001b[39m   \u001b[36mconst\u001b[39m baseHeaders \u001b[33m=\u001b[39m { \u001b[33m...\u001b[39m(cookieHeader \u001b[33m?\u001b[39m { cookie\u001b[33m:\u001b[39m cookieHeader } \u001b[33m:\u001b[39m {})\u001b[33m,\u001b[39m \u001b[33m...\u001b[39m(testAuth \u001b[33m?\u001b[39m { \u001b[32m\"x-test-auth\"\u001b[39m\u001b[33m:\u001b[39m testAuth } \u001b[33m:\u001b[39m {}) } \u001b[36mas\u001b[39m \u001b[33mHeadersInit\u001b[39m\u001b[33m;\u001b[39m\u001b[0m\n\n      at TeacherAnnouncementsPage (../apps/web/src/app/labs/teacher/announcements/page.tsx:13:45)\n      at Object.<anonymous> (unit/ui/TeacherAnnouncements.spec.tsx:25:46)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\TeacherAnnouncements.spec.tsx","startTime":1756202406219,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Teacher Course Insights (Advanced)"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: cookieStore.getAll is not a function\n    at TeacherCourseInsightsAdvancedPage (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\app\\labs\\teacher\\course-insights-advanced\\page.tsx:17:36)\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\TeacherCourseInsightsAdvanced.spec.tsx:27:55)\n    at Promise.then.completed (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"Teacher Course Insights (Advanced) renders table and totals with jitter","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"renders table and totals with jitter"}],"endTime":1756202406689,"message":"  ● Teacher Course Insights (Advanced) › renders table and totals with jitter\n\n    TypeError: cookieStore.getAll is not a function\n\n    \u001b[0m \u001b[90m 15 |\u001b[39m   \u001b[36mconst\u001b[39m cookieStore \u001b[33m=\u001b[39m cookies()\u001b[33m;\u001b[39m\n     \u001b[90m 16 |\u001b[39m   \u001b[36mconst\u001b[39m incoming \u001b[33m=\u001b[39m headers()\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 17 |\u001b[39m   \u001b[36mconst\u001b[39m cookieHeader \u001b[33m=\u001b[39m cookieStore\u001b[33m.\u001b[39mgetAll()\u001b[33m.\u001b[39mmap(c \u001b[33m=>\u001b[39m \u001b[32m`${c.name}=${c.value}`\u001b[39m)\u001b[33m.\u001b[39mjoin(\u001b[32m\"; \"\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                                    \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 18 |\u001b[39m   \u001b[36mconst\u001b[39m xTestAuth \u001b[33m=\u001b[39m incoming\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"x-test-auth\"\u001b[39m) \u001b[33m?\u001b[39m\u001b[33m?\u001b[39m cookieStore\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"x-test-auth\"\u001b[39m)\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mvalue\u001b[33m;\u001b[39m\n     \u001b[90m 19 |\u001b[39m\n     \u001b[90m 20 |\u001b[39m   \u001b[36mconst\u001b[39m baseHeaders\u001b[33m:\u001b[39m \u001b[33mHeadersInit\u001b[39m \u001b[33m=\u001b[39m {\u001b[0m\n\n      at TeacherCourseInsightsAdvancedPage (../apps/web/src/app/labs/teacher/course-insights-advanced/page.tsx:17:36)\n      at Object.<anonymous> (unit/ui/TeacherCourseInsightsAdvanced.spec.tsx:27:55)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\TeacherCourseInsightsAdvanced.spec.tsx","startTime":1756202406496,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Student Learning Overview (advanced)"],"duration":1008,"failureDetails":[{"name":"TestingLibraryElementError"}],"failureMessages":["Error: Unable to find an element by: [data-testid=\"learning-grid\"]\n\nIgnored nodes: comments, script, style\n\u001b[36m<body>\u001b[39m\n  \u001b[36m<div>\u001b[39m\n    \u001b[36m<main\u001b[39m\n      \u001b[33mclass\u001b[39m=\u001b[32m\"p-6\"\u001b[39m\n    \u001b[36m>\u001b[39m\n      \u001b[36m<p\u001b[39m\n        \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-700\"\u001b[39m\n      \u001b[36m>\u001b[39m\n        \u001b[0mYou are not signed in.\u001b[0m\n        \u001b[0m \u001b[0m\n        \u001b[36m<a\u001b[39m\n          \u001b[33mclass\u001b[39m=\u001b[32m\"underline\"\u001b[39m\n          \u001b[33mhref\u001b[39m=\u001b[32m\"/login\"\u001b[39m\n        \u001b[36m>\u001b[39m\n          \u001b[0mSign in\u001b[0m\n        \u001b[36m</a>\u001b[39m\n      \u001b[36m</p>\u001b[39m\n    \u001b[36m</main>\u001b[39m\n  \u001b[36m</div>\u001b[39m\n\u001b[36m</body>\u001b[39m\n    at waitForWrapper (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\@testing-library\\dom\\dist\\wait-for.js:163:27)\n    at C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\@testing-library\\dom\\dist\\query-helpers.js:86:33\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\StudentLearningOverviewAdvanced.spec.tsx:29:18)"],"fullName":"Student Learning Overview (advanced) renders cards and counts with jitter","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"renders cards and counts with jitter"}],"endTime":1756202407830,"message":"  ● Student Learning Overview (advanced) › renders cards and counts with jitter\n\n    Unable to find an element by: [data-testid=\"learning-grid\"]\n\n    Ignored nodes: comments, script, style\n    \u001b[36m<body>\u001b[39m\n      \u001b[36m<div>\u001b[39m\n        \u001b[36m<main\u001b[39m\n          \u001b[33mclass\u001b[39m=\u001b[32m\"p-6\"\u001b[39m\n        \u001b[36m>\u001b[39m\n          \u001b[36m<p\u001b[39m\n            \u001b[33mclass\u001b[39m=\u001b[32m\"text-gray-700\"\u001b[39m\n          \u001b[36m>\u001b[39m\n            \u001b[0mYou are not signed in.\u001b[0m\n            \u001b[0m \u001b[0m\n            \u001b[36m<a\u001b[39m\n              \u001b[33mclass\u001b[39m=\u001b[32m\"underline\"\u001b[39m\n              \u001b[33mhref\u001b[39m=\u001b[32m\"/login\"\u001b[39m\n            \u001b[36m>\u001b[39m\n              \u001b[0mSign in\u001b[0m\n            \u001b[36m</a>\u001b[39m\n          \u001b[36m</p>\u001b[39m\n        \u001b[36m</main>\u001b[39m\n      \u001b[36m</div>\u001b[39m\n    \u001b[36m</body>\u001b[39m\n\n    \u001b[0m \u001b[90m 27 |\u001b[39m     \u001b[36mconst\u001b[39m ui \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m \u001b[33mStudentLearningOverviewAdvancedPage\u001b[39m()\u001b[33m;\u001b[39m\n     \u001b[90m 28 |\u001b[39m     render(ui)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 29 |\u001b[39m     \u001b[36mawait\u001b[39m screen\u001b[33m.\u001b[39mfindByTestId(\u001b[32m'learning-grid'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                  \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 30 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 31 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 32 |\u001b[39m\u001b[0m\n\n      at waitForWrapper (../node_modules/@testing-library/dom/dist/wait-for.js:163:27)\n      at ../node_modules/@testing-library/dom/dist/query-helpers.js:86:33\n      at Object.<anonymous> (unit/ui/StudentLearningOverviewAdvanced.spec.tsx:29:18)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\StudentLearningOverviewAdvanced.spec.tsx","startTime":1756202406700,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime CORS headers for allowed origin"],"duration":33,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 201, 204, 400]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 201, 204, 400]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.cors.headers.spec.ts:27:31)"],"fullName":"runtime CORS headers for allowed origin includes access-control-allow-origin when origin is allowed","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"includes access-control-allow-origin when origin is allowed"}],"endTime":1756202408471,"message":"  ● runtime CORS headers for allowed origin › includes access-control-allow-origin when origin is allowed\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 403\n    Received array: [200, 201, 204, 400]\n\n    \u001b[0m \u001b[90m 25 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mProgressPOST\u001b[39m \u001b[36mas\u001b[39m any)(post({ authorization\u001b[33m:\u001b[39m \u001b[32m`Bearer ${token}`\u001b[39m }))\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m     \u001b[90m// success or preflight OK\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 27 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m201\u001b[39m\u001b[33m,\u001b[39m\u001b[35m204\u001b[39m\u001b[33m,\u001b[39m\u001b[35m400\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                               \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 28 |\u001b[39m     \u001b[90m// @ts-ignore NextResponse-like headers\u001b[39m\n     \u001b[90m 29 |\u001b[39m     \u001b[36mconst\u001b[39m h \u001b[33m=\u001b[39m res\u001b[33m.\u001b[39mheaders \u001b[36mas\u001b[39m \u001b[33mHeaders\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 30 |\u001b[39m     expect(h\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'access-control-allow-origin'\u001b[39m))\u001b[33m.\u001b[39mtoBe(\u001b[32m'https://provider.example'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.cors.headers.spec.ts:27:31)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.cors.headers.spec.ts","startTime":1756202407871,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Admin Reports (dashboard)"],"duration":2,"failureDetails":[{}],"failureMessages":["TypeError: cc.getAll is not a function\n    at AdminReportsPage (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\app\\dashboard\\admin\\reports\\page.tsx:8:40)\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\AdminReports.spec.tsx:18:38)\n    at Promise.then.completed (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"Admin Reports (dashboard) renders reports tiles","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"renders reports tiles"}],"endTime":1756202408825,"message":"  ● Admin Reports (dashboard) › renders reports tiles\n\n    TypeError: cc.getAll is not a function\n\n    \u001b[0m \u001b[90m  6 |\u001b[39m \t\u001b[36mconst\u001b[39m hh \u001b[33m=\u001b[39m headers()\u001b[33m;\u001b[39m\n     \u001b[90m  7 |\u001b[39m \t\u001b[36mconst\u001b[39m cc \u001b[33m=\u001b[39m cookies()\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m  8 |\u001b[39m \t\u001b[36mconst\u001b[39m cookie \u001b[33m=\u001b[39m hh\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"cookie\"\u001b[39m) \u001b[33m?\u001b[39m\u001b[33m?\u001b[39m cc\u001b[33m.\u001b[39mgetAll()\u001b[33m.\u001b[39mmap(x \u001b[33m=>\u001b[39m \u001b[32m`${x.name}=${x.value}`\u001b[39m)\u001b[33m.\u001b[39mjoin(\u001b[32m\"; \"\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m \t                                      \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m  9 |\u001b[39m \t\u001b[36mconst\u001b[39m ta \u001b[33m=\u001b[39m hh\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"x-test-auth\"\u001b[39m) \u001b[33m?\u001b[39m\u001b[33m?\u001b[39m cc\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"x-test-auth\"\u001b[39m)\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mvalue\u001b[33m;\u001b[39m\n     \u001b[90m 10 |\u001b[39m \t\u001b[36mconst\u001b[39m gw \u001b[33m=\u001b[39m createReportsGateway()\u001b[33m;\u001b[39m\n     \u001b[90m 11 |\u001b[39m \t\u001b[36mconst\u001b[39m [engagement\u001b[33m,\u001b[39m grades\u001b[33m,\u001b[39m dau\u001b[33m,\u001b[39m activity] \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m \u001b[33mPromise\u001b[39m\u001b[33m.\u001b[39mall([\u001b[0m\n\n      at AdminReportsPage (../apps/web/src/app/dashboard/admin/reports/page.tsx:8:40)\n      at Object.<anonymous> (unit/ui/AdminReports.spec.tsx:18:38)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\AdminReports.spec.tsx","startTime":1756202408500,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["System Request ID (labs)"],"duration":14,"failureDetails":[{"matcherResult":{"pass":false,"message":"expect(element).toHaveTextContent()\n\nExpected element to have text content:\n  req-123\nReceived:\n  generated-1756202409089"}}],"failureMessages":["Error: expect(element).toHaveTextContent()\n\nExpected element to have text content:\n  req-123\nReceived:\n  generated-1756202409089\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemRequestId.spec.tsx:19:53)"],"fullName":"System Request ID (labs) renders request-id from response headers when present","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"renders request-id from response headers when present"}],"endTime":1756202409105,"message":"  ● System Request ID (labs) › renders request-id from response headers when present\n\n    expect(element).toHaveTextContent()\n\n    Expected element to have text content:\n      req-123\n    Received:\n      generated-1756202409089\n\n    \u001b[0m \u001b[90m 17 |\u001b[39m     \u001b[36mconst\u001b[39m ui \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m \u001b[33mRequestIdPage\u001b[39m()\u001b[33m;\u001b[39m\n     \u001b[90m 18 |\u001b[39m     render(ui)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 19 |\u001b[39m     expect(\u001b[36mawait\u001b[39m screen\u001b[33m.\u001b[39mfindByTestId(\u001b[32m'request-id'\u001b[39m))\u001b[33m.\u001b[39mtoHaveTextContent(\u001b[32m'req-123'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 20 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 21 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 22 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/ui/SystemRequestId.spec.tsx:19:53)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemRequestId.spec.tsx","startTime":1756202408842,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["System Role Badge (labs)"],"duration":1,"failureDetails":[{}],"failureMessages":["ReferenceError: fetch is not defined\n    at serverFetch (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\lib\\serverFetch.ts:74:15)\n    at fetchJson (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\lib\\serverFetch.ts:88:21)\n    at Object.get (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\lib\\data\\health.ts:14:23)\n    at SystemRoleBadgePage (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\app\\labs\\system\\role-badge\\page.tsx:10:44)\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemRoleBadge.spec.tsx:15:41)\n    at Promise.then.completed (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"System Role Badge (labs) renders role and test mode","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"renders role and test mode"}],"endTime":1756202409307,"message":"  ● System Role Badge (labs) › renders role and test mode\n\n    ReferenceError: fetch is not defined\n\n    \u001b[0m \u001b[90m 72 |\u001b[39m   }\n     \u001b[90m 73 |\u001b[39m   \u001b[36mconst\u001b[39m started \u001b[33m=\u001b[39m \u001b[33mDate\u001b[39m\u001b[33m.\u001b[39mnow()\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 74 |\u001b[39m   \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m fetch(url\u001b[33m,\u001b[39m { cache\u001b[33m:\u001b[39m \u001b[32m\"no-store\"\u001b[39m\u001b[33m,\u001b[39m \u001b[33m...\u001b[39minit\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m hdrs })\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m               \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 75 |\u001b[39m   \u001b[36mtry\u001b[39m {\n     \u001b[90m 76 |\u001b[39m     \u001b[36mconst\u001b[39m ms \u001b[33m=\u001b[39m \u001b[33mDate\u001b[39m\u001b[33m.\u001b[39mnow() \u001b[33m-\u001b[39m started\u001b[33m;\u001b[39m\n     \u001b[90m 77 |\u001b[39m     \u001b[90m// eslint-disable-next-line no-console\u001b[39m\u001b[0m\n\n      at serverFetch (../apps/web/src/lib/serverFetch.ts:74:15)\n      at fetchJson (../apps/web/src/lib/serverFetch.ts:88:21)\n      at Object.get (../apps/web/src/lib/data/health.ts:14:23)\n      at SystemRoleBadgePage (../apps/web/src/app/labs/system/role-badge/page.tsx:10:44)\n      at Object.<anonymous> (unit/ui/SystemRoleBadge.spec.tsx:15:41)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemRoleBadge.spec.tsx","startTime":1756202409115,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["System Auth Check (labs)"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: cookieStore.getAll is not a function\n    at AuthCheckPage (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\app\\labs\\system\\auth-check\\page.tsx:16:6)\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemAuthCheck.spec.tsx:15:35)\n    at Promise.then.completed (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"System Auth Check (labs) renders email and role when authenticated","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"renders email and role when authenticated"}],"endTime":1756202409542,"message":"  ● System Auth Check (labs) › renders email and role when authenticated\n\n    TypeError: cookieStore.getAll is not a function\n\n    \u001b[0m \u001b[90m 14 |\u001b[39m\n     \u001b[90m 15 |\u001b[39m   \u001b[36mconst\u001b[39m cookieHeader \u001b[33m=\u001b[39m incomingHeaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"cookie\"\u001b[39m) \u001b[33m?\u001b[39m\u001b[33m?\u001b[39m cookieStore\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 16 |\u001b[39m     \u001b[33m.\u001b[39mgetAll()\n     \u001b[90m    |\u001b[39m      \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 17 |\u001b[39m     \u001b[33m.\u001b[39mmap((c) \u001b[33m=>\u001b[39m \u001b[32m`${c.name}=${c.value}`\u001b[39m)\n     \u001b[90m 18 |\u001b[39m     \u001b[33m.\u001b[39mjoin(\u001b[32m\"; \"\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 19 |\u001b[39m   \u001b[36mconst\u001b[39m testAuthHeader \u001b[33m=\u001b[39m incomingHeaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"x-test-auth\"\u001b[39m) \u001b[33m?\u001b[39m\u001b[33m?\u001b[39m \u001b[32m\"\"\u001b[39m\u001b[33m;\u001b[39m\u001b[0m\n\n      at AuthCheckPage (../apps/web/src/app/labs/system/auth-check/page.tsx:16:6)\n      at Object.<anonymous> (unit/ui/SystemAuthCheck.spec.tsx:15:35)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemAuthCheck.spec.tsx","startTime":1756202409320,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/quiz-attempts"],"duration":3,"failureDetails":[{"matcherResult":{"actual":429,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.quiz-attempts.spec.ts:28:22)"],"fullName":"API /api/quiz-attempts start: unauth → 401; non-student → 403; bad quiz_id → 400","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"start: unauth → 401; non-student → 403; bad quiz_id → 400"},{"ancestorTitles":["API /api/quiz-attempts"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":401,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.quiz-attempts.spec.ts:41:22)"],"fullName":"API /api/quiz-attempts upsert: unauth → 401; non-student → 403; bad input → 400","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"upsert: unauth → 401; non-student → 403; bad input → 400"},{"ancestorTitles":["API /api/quiz-attempts"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"API /api/quiz-attempts GET: missing quiz_id → 400; unauth → 401; non-teacher → 403","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"GET: missing quiz_id → 400; unauth → 401; non-teacher → 403"}],"endTime":1756202409805,"message":"  ● API /api/quiz-attempts › start: unauth → 401; non-student → 403; bad quiz_id → 400\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 429\n\n    \u001b[0m \u001b[90m 26 |\u001b[39m \t\tglobalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 27 |\u001b[39m \t\tres \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAttemptsPOST\u001b[39m \u001b[36mas\u001b[39m any)(makePost({ quiz_id\u001b[33m:\u001b[39m \u001b[32m'00000000-0000-0000-0000-000000000001'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 28 |\u001b[39m \t\texpect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m \t\t                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 29 |\u001b[39m \t\t\u001b[90m// student bad uuid\u001b[39m\n     \u001b[90m 30 |\u001b[39m \t\t\u001b[90m// @ts-ignore\u001b[39m\n     \u001b[90m 31 |\u001b[39m \t\tglobalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.quiz-attempts.spec.ts:28:22)\n\n  ● API /api/quiz-attempts › upsert: unauth → 401; non-student → 403; bad input → 400\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 401\n    Received: 429\n\n    \u001b[0m \u001b[90m 39 |\u001b[39m \t\tglobalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mclear\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m()\u001b[33m;\u001b[39m\n     \u001b[90m 40 |\u001b[39m \t\t\u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAttemptsPATCH\u001b[39m \u001b[36mas\u001b[39m any)(makePatch({ attempt_id\u001b[33m:\u001b[39m \u001b[32m'00000000-0000-0000-0000-000000000001'\u001b[39m\u001b[33m,\u001b[39m question_id\u001b[33m:\u001b[39m \u001b[32m'00000000-0000-0000-0000-000000000002'\u001b[39m\u001b[33m,\u001b[39m choice_id\u001b[33m:\u001b[39m \u001b[32m'00000000-0000-0000-0000-000000000003'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 41 |\u001b[39m \t\texpect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m \t\t                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 42 |\u001b[39m \t\t\u001b[90m// teacher forbidden\u001b[39m\n     \u001b[90m 43 |\u001b[39m \t\t\u001b[90m// @ts-ignore\u001b[39m\n     \u001b[90m 44 |\u001b[39m \t\tglobalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.quiz-attempts.spec.ts:41:22)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.quiz-attempts.spec.ts","startTime":1756202409549,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["user role PATCH audit log"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [200, 403, 401]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [200, 403, 401]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.user.role.audit.spec.ts:16:27)"],"fullName":"user role PATCH audit log admin role update writes audit_logs entry","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"admin role update writes audit_logs entry"}],"endTime":1756202409923,"message":"  ● user role PATCH audit log › admin role update writes audit_logs entry\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 400\n    Received array: [200, 403, 401]\n\n    \u001b[0m \u001b[90m 14 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m \u001b[32m'getRouteHandlerSupabase'\u001b[39m)\u001b[33m.\u001b[39mmockReturnValue(mock)\u001b[33m;\u001b[39m\n     \u001b[90m 15 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mRolePATCH\u001b[39m \u001b[36mas\u001b[39m any)(patch({ userId\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m role\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 16 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m\u001b[33m,\u001b[39m\u001b[35m401\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                           \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 17 |\u001b[39m     \u001b[90m// Verify audit insert attempted\u001b[39m\n     \u001b[90m 18 |\u001b[39m     expect(insertSpy)\u001b[33m.\u001b[39mtoHaveBeenCalled()\u001b[33m;\u001b[39m\n     \u001b[90m 19 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.user.role.audit.spec.ts:16:27)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.user.role.audit.spec.ts","startTime":1756202409811,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/auth/logout"],"duration":2,"failureDetails":[{"matcherResult":{"actual":429,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.auth.logout.spec.ts:13:24)"],"fullName":"API /api/auth/logout returns 200 and clears test-mode cookie; idempotent","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"returns 200 and clears test-mode cookie; idempotent"}],"endTime":1756202410026,"message":"  ● API /api/auth/logout › returns 200 and clears test-mode cookie; idempotent\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 429\n\n    \u001b[0m \u001b[90m 11 |\u001b[39m     \u001b[90m// call again\u001b[39m\n     \u001b[90m 12 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mLogoutPOST\u001b[39m \u001b[36mas\u001b[39m any)(req)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 13 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 14 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 15 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 16 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.auth.logout.spec.ts:13:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.auth.logout.spec.ts","startTime":1756202409928,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Assignments CRUD API"],"duration":3,"failureDetails":[{"matcherResult":{"actual":429,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.assignments.crud.spec.ts:26:24)"],"fullName":"Assignments CRUD API POST 201 for teacher; 403 student; 401 unauth","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"POST 201 for teacher; 403 student; 401 unauth"},{"ancestorTitles":["Assignments CRUD API"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":400,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.assignments.crud.spec.ts:36:24)"],"fullName":"Assignments CRUD API PATCH validation and role","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"PATCH validation and role"},{"ancestorTitles":["Assignments CRUD API"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.assignments.crud.spec.ts:43:24)"],"fullName":"Assignments CRUD API DELETE role checks","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"DELETE role checks"}],"endTime":1756202410205,"message":"  ● Assignments CRUD API › POST 201 for teacher; 403 student; 401 unauth\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 429\n\n    \u001b[0m \u001b[90m 24 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m.\u001b[39mcookies\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 25 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAssignPOST\u001b[39m \u001b[36mas\u001b[39m any)(makePost({ course_id\u001b[33m:\u001b[39m \u001b[32m'00000000-0000-0000-0000-000000000001'\u001b[39m\u001b[33m,\u001b[39m title\u001b[33m:\u001b[39m \u001b[32m'Homework 1'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 26 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 27 |\u001b[39m     \u001b[90m// Unauth (clear cookie)\u001b[39m\n     \u001b[90m 28 |\u001b[39m     \u001b[90m// @ts-ignore\u001b[39m\n     \u001b[90m 29 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m.\u001b[39mcookies\u001b[33m.\u001b[39m\u001b[36mdelete\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.assignments.crud.spec.ts:26:24)\n\n  ● Assignments CRUD API › PATCH validation and role\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 400\n    Received: 429\n\n    \u001b[0m \u001b[90m 34 |\u001b[39m   test(\u001b[32m'PATCH validation and role'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 35 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAssignPATCH\u001b[39m \u001b[36mas\u001b[39m any)(makePatch(\u001b[32m'http://localhost/api/assignments?id=aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa'\u001b[39m\u001b[33m,\u001b[39m { points\u001b[33m:\u001b[39m \u001b[32m'bad'\u001b[39m }\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 36 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 37 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAssignPATCH\u001b[39m \u001b[36mas\u001b[39m any)(makePatch(\u001b[32m'http://localhost/api/assignments?id=aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa'\u001b[39m\u001b[33m,\u001b[39m { points\u001b[33m:\u001b[39m \u001b[35m50\u001b[39m }\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m }))\u001b[33m;\u001b[39m\n     \u001b[90m 38 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 39 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.assignments.crud.spec.ts:36:24)\n\n  ● Assignments CRUD API › DELETE role checks\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 429\n\n    \u001b[0m \u001b[90m 41 |\u001b[39m   test(\u001b[32m'DELETE role checks'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 42 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAssignDELETE\u001b[39m \u001b[36mas\u001b[39m any)(makeDelete(\u001b[32m'http://localhost/api/assignments?id=aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa'\u001b[39m\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 43 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 44 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAssignDELETE\u001b[39m \u001b[36mas\u001b[39m any)(makeDelete(\u001b[32m'http://localhost/api/assignments?id=aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa'\u001b[39m\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m }))\u001b[33m;\u001b[39m\n     \u001b[90m 45 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 46 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.assignments.crud.spec.ts:43:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.assignments.crud.spec.ts","startTime":1756202410031,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime asset sign-url scope"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"runtime asset sign-url scope missing files.write scope → 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"missing files.write scope → 403"},{"ancestorTitles":["runtime asset sign-url scope"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.asset.sign-url.scope.spec.ts:34:19)"],"fullName":"runtime asset sign-url scope valid scope and content-type → 200 with url/key","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"valid scope and content-type → 200 with url/key"},{"ancestorTitles":["runtime asset sign-url scope"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":400,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.asset.sign-url.scope.spec.ts:43:24)"],"fullName":"runtime asset sign-url scope unsupported content type → 400","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"unsupported content type → 400"}],"endTime":1756202410383,"message":"  ● runtime asset sign-url scope › valid scope and content-type → 200 with url/key\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 403\n    Received array: [200]\n\n    \u001b[0m \u001b[90m 32 |\u001b[39m     \u001b[36mconst\u001b[39m token \u001b[33m=\u001b[39m makeJwt([\u001b[32m'files.write'\u001b[39m])\u001b[33m;\u001b[39m\n     \u001b[90m 33 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAssetSignPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/asset/sign-url'\u001b[39m\u001b[33m,\u001b[39m { content_type\u001b[33m:\u001b[39m \u001b[32m'image/png'\u001b[39m }\u001b[33m,\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m`Bearer ${token}`\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 34 |\u001b[39m     expect([\u001b[35m200\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 35 |\u001b[39m     \u001b[36mconst\u001b[39m json \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m res\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n     \u001b[90m 36 |\u001b[39m     expect(json\u001b[33m.\u001b[39murl)\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m 37 |\u001b[39m     expect(json\u001b[33m.\u001b[39mkey)\u001b[33m.\u001b[39mtoMatch(\u001b[35m/runtime\\//\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.asset.sign-url.scope.spec.ts:34:19)\n\n  ● runtime asset sign-url scope › unsupported content type → 400\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 400\n    Received: 429\n\n    \u001b[0m \u001b[90m 41 |\u001b[39m     \u001b[36mconst\u001b[39m token \u001b[33m=\u001b[39m makeJwt([\u001b[32m'files.write'\u001b[39m])\u001b[33m;\u001b[39m\n     \u001b[90m 42 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAssetSignPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/asset/sign-url'\u001b[39m\u001b[33m,\u001b[39m { content_type\u001b[33m:\u001b[39m \u001b[32m'application/x-foo'\u001b[39m }\u001b[33m,\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m`Bearer ${token}`\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 43 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 44 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 45 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 46 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.asset.sign-url.scope.spec.ts:43:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.asset.sign-url.scope.spec.ts","startTime":1756202410208,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["messages threads and messages (TEST_MODE)"],"duration":4,"failureDetails":[{"matcherResult":{"actual":429,"expected":201,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 201\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 201\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.threads-and-messages.spec.ts:24:23)"],"fullName":"messages threads and messages (TEST_MODE) thread create has unique participants; unread counts adjust with read","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"thread create has unique participants; unread counts adjust with read"}],"endTime":1756202410553,"message":"  ● messages threads and messages (TEST_MODE) › thread create has unique participants; unread counts adjust with read\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 201\n    Received: 429\n\n    \u001b[0m \u001b[90m 22 |\u001b[39m     \u001b[90m// send two messages: one from teacher, one from student\u001b[39m\n     \u001b[90m 23 |\u001b[39m     \u001b[36mconst\u001b[39m m1 \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mMessagesPOST\u001b[39m \u001b[36mas\u001b[39m any)(postJson(\u001b[32m'http://localhost/api/messages'\u001b[39m\u001b[33m,\u001b[39m { thread_id\u001b[33m:\u001b[39m thread\u001b[33m.\u001b[39mid\u001b[33m,\u001b[39m body\u001b[33m:\u001b[39m \u001b[32m'hello'\u001b[39m }\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 24 |\u001b[39m     expect(m1\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m201\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 25 |\u001b[39m     \u001b[36mconst\u001b[39m m2 \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mMessagesPOST\u001b[39m \u001b[36mas\u001b[39m any)(postJson(\u001b[32m'http://localhost/api/messages'\u001b[39m\u001b[33m,\u001b[39m { thread_id\u001b[33m:\u001b[39m thread\u001b[33m.\u001b[39mid\u001b[33m,\u001b[39m body\u001b[33m:\u001b[39m \u001b[32m'hi'\u001b[39m }\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m }))\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m     expect(m2\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m201\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 27 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.messages.threads-and-messages.spec.ts:24:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.threads-and-messages.spec.ts","startTime":1756202410386,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime outcomes JWKS rotation"],"duration":69,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 201]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 201]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.outcomes.jwks.rotation.spec.ts:23:23)"],"fullName":"runtime outcomes JWKS rotation refreshes JWKS on verify failure","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"refreshes JWKS on verify failure"}],"endTime":1756202410748,"message":"  ● runtime outcomes JWKS rotation › refreshes JWKS on verify failure\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 403\n    Received array: [200, 201]\n\n    \u001b[0m \u001b[90m 21 |\u001b[39m     \u001b[36mconst\u001b[39m req \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/runtime/outcomes'\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'POST'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m { \u001b[32m'content-type'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'application/json'\u001b[39m\u001b[33m,\u001b[39m authorization\u001b[33m:\u001b[39m \u001b[32m'Bearer PROVIDERJWT'\u001b[39m } \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m body\u001b[33m:\u001b[39m \u001b[33mJSON\u001b[39m\u001b[33m.\u001b[39mstringify({ courseId\u001b[33m:\u001b[39m \u001b[32m'c1'\u001b[39m\u001b[33m,\u001b[39m userId\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m event\u001b[33m:\u001b[39m { type\u001b[33m:\u001b[39m \u001b[32m'attempt.completed'\u001b[39m\u001b[33m,\u001b[39m runtimeAttemptId\u001b[33m:\u001b[39m \u001b[32m'ra1'\u001b[39m\u001b[33m,\u001b[39m score\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m max\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m passed\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m } }) } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 22 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m route\u001b[33m.\u001b[39m\u001b[33mPOST\u001b[39m(req \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 23 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m201\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 24 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 25 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.outcomes.jwks.rotation.spec.ts:23:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.outcomes.jwks.rotation.spec.ts","startTime":1756202410556,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["System Health History (labs)"],"duration":2,"failureDetails":[{}],"failureMessages":["ReferenceError: fetch is not defined\n    at serverFetch (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\lib\\serverFetch.ts:74:15)\n    at fetchJson (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\lib\\serverFetch.ts:88:21)\n    at Object.get (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\lib\\data\\health.ts:14:23)\n    at takeSamples (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\app\\labs\\system\\health-history\\page.tsx:11:47)\n    at HealthHistoryPage (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\app\\labs\\system\\health-history\\page.tsx:34:25)\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemHealthHistory.spec.tsx:15:39)\n    at Promise.then.completed (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"System Health History (labs) renders delta stats and timestamps with jitter","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"renders delta stats and timestamps with jitter"}],"endTime":1756202411252,"message":"  ● System Health History (labs) › renders delta stats and timestamps with jitter\n\n    ReferenceError: fetch is not defined\n\n    \u001b[0m \u001b[90m 72 |\u001b[39m   }\n     \u001b[90m 73 |\u001b[39m   \u001b[36mconst\u001b[39m started \u001b[33m=\u001b[39m \u001b[33mDate\u001b[39m\u001b[33m.\u001b[39mnow()\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 74 |\u001b[39m   \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m fetch(url\u001b[33m,\u001b[39m { cache\u001b[33m:\u001b[39m \u001b[32m\"no-store\"\u001b[39m\u001b[33m,\u001b[39m \u001b[33m...\u001b[39minit\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m hdrs })\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m               \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 75 |\u001b[39m   \u001b[36mtry\u001b[39m {\n     \u001b[90m 76 |\u001b[39m     \u001b[36mconst\u001b[39m ms \u001b[33m=\u001b[39m \u001b[33mDate\u001b[39m\u001b[33m.\u001b[39mnow() \u001b[33m-\u001b[39m started\u001b[33m;\u001b[39m\n     \u001b[90m 77 |\u001b[39m     \u001b[90m// eslint-disable-next-line no-console\u001b[39m\u001b[0m\n\n      at serverFetch (../apps/web/src/lib/serverFetch.ts:74:15)\n      at fetchJson (../apps/web/src/lib/serverFetch.ts:88:21)\n      at Object.get (../apps/web/src/lib/data/health.ts:14:23)\n      at takeSamples (../apps/web/src/app/labs/system/health-history/page.tsx:11:47)\n      at HealthHistoryPage (../apps/web/src/app/labs/system/health-history/page.tsx:34:25)\n      at Object.<anonymous> (unit/ui/SystemHealthHistory.spec.tsx:15:39)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemHealthHistory.spec.tsx","startTime":1756202410755,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime endpoints require token (guard matrix)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"runtime endpoints require token (guard matrix) context GET missing token → 401","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"context GET missing token → 401"},{"ancestorTitles":["runtime endpoints require token (guard matrix)"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"runtime endpoints require token (guard matrix) asset sign-url POST missing token → 401/403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"asset sign-url POST missing token → 401/403"},{"ancestorTitles":["runtime endpoints require token (guard matrix)"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [401, 403]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [401, 403]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.guard.matrix.spec.ts:30:23)"],"fullName":"runtime endpoints require token (guard matrix) checkpoint save/load missing token → 401/403","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"checkpoint save/load missing token → 401/403"},{"ancestorTitles":["runtime endpoints require token (guard matrix)"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [401, 403]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [401, 403]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.guard.matrix.spec.ts:38:23)"],"fullName":"runtime endpoints require token (guard matrix) events/grade/progress missing token → 401/403","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"events/grade/progress missing token → 401/403"},{"ancestorTitles":["runtime endpoints require token (guard matrix)"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 200\nReceived array: [401, 403, 400, 500]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 200\nReceived array: [401, 403, 400, 500]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.guard.matrix.spec.ts:46:31)"],"fullName":"runtime endpoints require token (guard matrix) outcomes list/export missing token → 401/403/400","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"outcomes list/export missing token → 401/403/400"}],"endTime":1756202411480,"message":"  ● runtime endpoints require token (guard matrix) › checkpoint save/load missing token → 401/403\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 429\n    Received array: [401, 403]\n\n    \u001b[0m \u001b[90m 28 |\u001b[39m     \u001b[36mconst\u001b[39m save \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mSavePOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/checkpoint/save'\u001b[39m\u001b[33m,\u001b[39m { key\u001b[33m:\u001b[39m \u001b[32m'k'\u001b[39m\u001b[33m,\u001b[39m state\u001b[33m:\u001b[39m {} }))\u001b[33m;\u001b[39m\n     \u001b[90m 29 |\u001b[39m     \u001b[36mconst\u001b[39m load \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mLoadGET\u001b[39m \u001b[36mas\u001b[39m any)(\u001b[36mget\u001b[39m(\u001b[32m'http://localhost/api/runtime/checkpoint/load?key=k'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 30 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(save\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 31 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(load\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m 32 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 33 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.guard.matrix.spec.ts:30:23)\n\n  ● runtime endpoints require token (guard matrix) › events/grade/progress missing token → 401/403\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 429\n    Received array: [401, 403]\n\n    \u001b[0m \u001b[90m 36 |\u001b[39m     \u001b[36mconst\u001b[39m g \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mGradePOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/grade'\u001b[39m\u001b[33m,\u001b[39m { score\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m max\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m passed\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m }))\u001b[33m;\u001b[39m\n     \u001b[90m 37 |\u001b[39m     \u001b[36mconst\u001b[39m p \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mProgressPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/progress'\u001b[39m\u001b[33m,\u001b[39m { pct\u001b[33m:\u001b[39m \u001b[35m10\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 38 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(e\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 39 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(g\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m 40 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(p\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m 41 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.guard.matrix.spec.ts:38:23)\n\n  ● runtime endpoints require token (guard matrix) › outcomes list/export missing token → 401/403/400\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 200\n    Received array: [401, 403, 400, 500]\n\n    \u001b[0m \u001b[90m 44 |\u001b[39m     \u001b[36mconst\u001b[39m list \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mOutcomesGET\u001b[39m \u001b[36mas\u001b[39m any)(\u001b[36mget\u001b[39m(\u001b[32m'http://localhost/api/runtime/outcomes?course_id=00000000-0000-0000-0000-000000000001'\u001b[39m))\u001b[33m;\u001b[39m\n     \u001b[90m 45 |\u001b[39m     \u001b[36mconst\u001b[39m exp \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mOutcomesExportGET\u001b[39m \u001b[36mas\u001b[39m any)(\u001b[36mget\u001b[39m(\u001b[32m'http://localhost/api/runtime/outcomes/export?course_id=00000000-0000-0000-0000-000000000001'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 46 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m\u001b[33m,\u001b[39m\u001b[35m400\u001b[39m\u001b[33m,\u001b[39m\u001b[35m500\u001b[39m])\u001b[33m.\u001b[39mtoContain(list\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                               \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 47 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m\u001b[33m,\u001b[39m\u001b[35m400\u001b[39m\u001b[33m,\u001b[39m\u001b[35m500\u001b[39m])\u001b[33m.\u001b[39mtoContain(exp\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m 48 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 49 |\u001b[39m })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.guard.matrix.spec.ts:46:31)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.guard.matrix.spec.ts","startTime":1756202411255,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["External registry and runtime v2 (TEST_MODE)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"External registry and runtime v2 (TEST_MODE) registry courses GET requires auth and respects flag","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"registry courses GET requires auth and respects flag"},{"ancestorTitles":["External registry and runtime v2 (TEST_MODE)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"External registry and runtime v2 (TEST_MODE) runtime v2 auth exchange rejects bad token","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"runtime v2 auth exchange rejects bad token"},{"ancestorTitles":["External registry and runtime v2 (TEST_MODE)"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"External registry and runtime v2 (TEST_MODE) context requires bearer token","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"context requires bearer token"},{"ancestorTitles":["External registry and runtime v2 (TEST_MODE)"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":401,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.registry.spec.ts:52:25)"],"fullName":"External registry and runtime v2 (TEST_MODE) progress/grade require bearer token","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"progress/grade require bearer token"}],"endTime":1756202411641,"message":"  ● External registry and runtime v2 (TEST_MODE) › progress/grade require bearer token\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 401\n    Received: 429\n\n    \u001b[0m \u001b[90m 50 |\u001b[39m   test(\u001b[32m'progress/grade require bearer token'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 51 |\u001b[39m     \u001b[36mconst\u001b[39m resP \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mProgPOST\u001b[39m \u001b[36mas\u001b[39m any)(jsonReq(\u001b[32m'http://localhost/api/runtime/progress'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'POST'\u001b[39m\u001b[33m,\u001b[39m { pct\u001b[33m:\u001b[39m \u001b[35m10\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 52 |\u001b[39m     expect(resP\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                         \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 53 |\u001b[39m     \u001b[36mconst\u001b[39m resG \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mGradePOST\u001b[39m \u001b[36mas\u001b[39m any)(jsonReq(\u001b[32m'http://localhost/api/runtime/grade'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'POST'\u001b[39m\u001b[33m,\u001b[39m { score\u001b[33m:\u001b[39m \u001b[35m5\u001b[39m\u001b[33m,\u001b[39m max\u001b[33m:\u001b[39m \u001b[35m10\u001b[39m\u001b[33m,\u001b[39m passed\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m }))\u001b[33m;\u001b[39m\n     \u001b[90m 54 |\u001b[39m     expect(resG\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 55 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.registry.spec.ts:52:25)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.registry.spec.ts","startTime":1756202411483,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Parent Children (labs)"],"duration":4,"failureDetails":[{}],"failureMessages":["TypeError: c.getAll is not a function\n    at ParentChildrenListPage (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\app\\labs\\parent\\children\\page.tsx:11:44)\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\ParentChildren.spec.tsx:28:44)\n    at Promise.then.completed (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"Parent Children (labs) renders list with one linked student","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"renders list with one linked student"}],"endTime":1756202411940,"message":"  ● Parent Children (labs) › renders list with one linked student\n\n    TypeError: c.getAll is not a function\n\n    \u001b[0m \u001b[90m  9 |\u001b[39m \t\u001b[36mconst\u001b[39m h \u001b[33m=\u001b[39m headers()\u001b[33m;\u001b[39m\n     \u001b[90m 10 |\u001b[39m \t\u001b[36mconst\u001b[39m c \u001b[33m=\u001b[39m cookies()\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 11 |\u001b[39m \t\u001b[36mconst\u001b[39m cookieHeader \u001b[33m=\u001b[39m h\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"cookie\"\u001b[39m) \u001b[33m?\u001b[39m\u001b[33m?\u001b[39m c\u001b[33m.\u001b[39mgetAll()\u001b[33m.\u001b[39mmap(x \u001b[33m=>\u001b[39m \u001b[32m`${x.name}=${x.value}`\u001b[39m)\u001b[33m.\u001b[39mjoin(\u001b[32m\"; \"\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m \t                                          \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 12 |\u001b[39m \t\u001b[36mconst\u001b[39m testAuth \u001b[33m=\u001b[39m h\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"x-test-auth\"\u001b[39m) \u001b[33m?\u001b[39m\u001b[33m?\u001b[39m c\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"x-test-auth\"\u001b[39m)\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mvalue\u001b[33m;\u001b[39m\n     \u001b[90m 13 |\u001b[39m\n     \u001b[90m 14 |\u001b[39m \t\u001b[36mlet\u001b[39m links\u001b[33m:\u001b[39m \u001b[33mParentLink\u001b[39m[] \u001b[33m=\u001b[39m []\u001b[33m;\u001b[39m\u001b[0m\n\n      at ParentChildrenListPage (../apps/web/src/app/labs/parent/children/page.tsx:11:44)\n      at Object.<anonymous> (unit/ui/ParentChildren.spec.tsx:28:44)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\ParentChildren.spec.tsx","startTime":1756202411654,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["DB RLS negative cases (policy guards)"],"duration":43,"failureDetails":[],"failureMessages":[],"fullName":"DB RLS negative cases (policy guards) student cannot read other students notifications","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"student cannot read other students notifications"},{"ancestorTitles":["DB RLS negative cases (policy guards)"],"duration":20,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 404\nReceived array: [401, 403]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 404\nReceived array: [401, 403]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\db.rls.negative.spec.ts:25:23)"],"fullName":"DB RLS negative cases (policy guards) non-owner cannot finalize someone else file (RLS and route guard)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"non-owner cannot finalize someone else file (RLS and route guard)"},{"ancestorTitles":["DB RLS negative cases (policy guards)"],"duration":53,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 200\nReceived array: [401, 403]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 200\nReceived array: [401, 403]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\db.rls.negative.spec.ts:31:23)"],"fullName":"DB RLS negative cases (policy guards) student cannot list submissions for other assignment without auth as teacher","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"student cannot list submissions for other assignment without auth as teacher"}],"endTime":1756202412167,"message":"  ● DB RLS negative cases (policy guards) › non-owner cannot finalize someone else file (RLS and route guard)\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 404\n    Received array: [401, 403]\n\n    \u001b[0m \u001b[90m 23 |\u001b[39m     \u001b[36mconst\u001b[39m req \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/files/finalize'\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'POST'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m { \u001b[32m'content-type'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'application/json'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m } \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m body\u001b[33m:\u001b[39m \u001b[33mJSON\u001b[39m\u001b[33m.\u001b[39mstringify({ key\u001b[33m:\u001b[39m \u001b[32m'k1'\u001b[39m\u001b[33m,\u001b[39m size_bytes\u001b[33m:\u001b[39m \u001b[35m100\u001b[39m }) } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 24 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m route\u001b[33m.\u001b[39m\u001b[33mPOST\u001b[39m(req \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 25 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 26 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 27 |\u001b[39m\n     \u001b[90m 28 |\u001b[39m   test(\u001b[32m'student cannot list submissions for other assignment without auth as teacher'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/db.rls.negative.spec.ts:25:23)\n\n  ● DB RLS negative cases (policy guards) › student cannot list submissions for other assignment without auth as teacher\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 200\n    Received array: [401, 403]\n\n    \u001b[0m \u001b[90m 29 |\u001b[39m     \u001b[36mconst\u001b[39m route \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m \u001b[36mimport\u001b[39m(\u001b[32m'../../apps/web/src/app/api/submissions/route'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 30 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m route\u001b[33m.\u001b[39m\u001b[33mGET\u001b[39m(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/submissions?assignment_id=00000000-0000-0000-0000-000000000999'\u001b[39m\u001b[33m,\u001b[39m { headers\u001b[33m:\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m } } \u001b[36mas\u001b[39m any) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 31 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 32 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 33 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 34 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/db.rls.negative.spec.ts:31:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\db.rls.negative.spec.ts","startTime":1756202411946,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["System OK Card (labs)"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: cookieStore.getAll is not a function\n    at SystemOkCardPage (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\app\\labs\\system\\ok-card\\page.tsx:24:6)\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemOkCard.spec.tsx:16:38)\n    at Promise.then.completed (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"System OK Card (labs) renders ok and ts (human) on success","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"renders ok and ts (human) on success"}],"endTime":1756202412540,"message":"  ● System OK Card (labs) › renders ok and ts (human) on success\n\n    TypeError: cookieStore.getAll is not a function\n\n    \u001b[0m \u001b[90m 22 |\u001b[39m\n     \u001b[90m 23 |\u001b[39m   \u001b[36mconst\u001b[39m cookieHeader \u001b[33m=\u001b[39m cookieStore\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 24 |\u001b[39m     \u001b[33m.\u001b[39mgetAll()\n     \u001b[90m    |\u001b[39m      \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 25 |\u001b[39m     \u001b[33m.\u001b[39mmap((c) \u001b[33m=>\u001b[39m \u001b[32m`${c.name}=${c.value}`\u001b[39m)\n     \u001b[90m 26 |\u001b[39m     \u001b[33m.\u001b[39mjoin(\u001b[32m\"; \"\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 27 |\u001b[39m   \u001b[36mconst\u001b[39m xTestAuth \u001b[33m=\u001b[39m incomingHeaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"x-test-auth\"\u001b[39m) \u001b[33m?\u001b[39m\u001b[33m?\u001b[39m cookieStore\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"x-test-auth\"\u001b[39m)\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mvalue\u001b[33m;\u001b[39m\u001b[0m\n\n      at SystemOkCardPage (../apps/web/src/app/labs/system/ok-card/page.tsx:24:6)\n      at Object.<anonymous> (unit/ui/SystemOkCard.spec.tsx:16:38)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemOkCard.spec.tsx","startTime":1756202412176,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["files upload-url quota enforcement"],"duration":2,"failureDetails":[{"matcherResult":{"actual":401,"expected":413,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 413\nReceived: 401","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 413\nReceived: 401\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.upload-url.quota.spec.ts:19:24)"],"fullName":"files upload-url quota enforcement 413 when expected_bytes exceed remaining quota","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"413 when expected_bytes exceed remaining quota"}],"endTime":1756202412680,"message":"  ● files upload-url quota enforcement › 413 when expected_bytes exceed remaining quota\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 413\n    Received: 401\n\n    \u001b[0m \u001b[90m 17 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m \u001b[32m'getRouteHandlerSupabase'\u001b[39m)\u001b[33m.\u001b[39mmockReturnValue(mock)\u001b[33m;\u001b[39m\n     \u001b[90m 18 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mUploadUrlPOST\u001b[39m \u001b[36mas\u001b[39m any)(post({ owner_type\u001b[33m:\u001b[39m \u001b[32m'user'\u001b[39m\u001b[33m,\u001b[39m owner_id\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m content_type\u001b[33m:\u001b[39m \u001b[32m'image/png'\u001b[39m\u001b[33m,\u001b[39m expected_bytes\u001b[33m:\u001b[39m \u001b[35m200\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 19 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m413\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 20 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 21 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 22 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.files.upload-url.quota.spec.ts:19:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.upload-url.quota.spec.ts","startTime":1756202412545,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/enrollments"],"duration":3,"failureDetails":[{"matcherResult":{"actual":429,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.enrollments.spec.ts:23:22)"],"fullName":"API /api/enrollments POST unauth → 401; non-student → 403; student → 201 with own student_id","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"POST unauth → 401; non-student → 403; student → 201 with own student_id"},{"ancestorTitles":["API /api/enrollments"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"API /api/enrollments GET unauth → 401; echoes x-request-id","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"GET unauth → 401; echoes x-request-id"}],"endTime":1756202412802,"message":"  ● API /api/enrollments › POST unauth → 401; non-student → 403; student → 201 with own student_id\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 429\n\n    \u001b[0m \u001b[90m 21 |\u001b[39m \t\tglobalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 22 |\u001b[39m \t\tres \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mEnrollPOST\u001b[39m \u001b[36mas\u001b[39m any)(makePost({ course_id\u001b[33m:\u001b[39m \u001b[32m'00000000-0000-0000-0000-000000000001'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 23 |\u001b[39m \t\texpect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m \t\t                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 24 |\u001b[39m \t\t\u001b[90m// switch to student\u001b[39m\n     \u001b[90m 25 |\u001b[39m \t\t\u001b[90m// @ts-ignore\u001b[39m\n     \u001b[90m 26 |\u001b[39m \t\tglobalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.enrollments.spec.ts:23:22)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.enrollments.spec.ts","startTime":1756202412683,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime JWKS rotation (kid refresh)"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [401, 403]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [401, 403]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.jwks.rotation.spec.ts:12:23)"],"fullName":"runtime JWKS rotation (kid refresh) on verify failure, JWKS cache clears and a subsequent verify can succeed","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"on verify failure, JWKS cache clears and a subsequent verify can succeed"}],"endTime":1756202412900,"message":"  ● runtime JWKS rotation (kid refresh) › on verify failure, JWKS cache clears and a subsequent verify can succeed\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 400\n    Received array: [401, 403]\n\n    \u001b[0m \u001b[90m 10 |\u001b[39m     \u001b[36mconst\u001b[39m body \u001b[33m=\u001b[39m { courseId\u001b[33m:\u001b[39m \u001b[32m'c1'\u001b[39m\u001b[33m,\u001b[39m userId\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m event\u001b[33m:\u001b[39m { type\u001b[33m:\u001b[39m \u001b[32m'progress'\u001b[39m\u001b[33m,\u001b[39m pct\u001b[33m:\u001b[39m \u001b[35m10\u001b[39m } }\u001b[33m;\u001b[39m\n     \u001b[90m 11 |\u001b[39m     \u001b[36mconst\u001b[39m bad \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mOutcomesPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(body\u001b[33m,\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m'Bearer bad.token.value'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 12 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(bad\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 13 |\u001b[39m     \u001b[90m// Clear cache hook (simulated by env toggle) and retry\u001b[39m\n     \u001b[90m 14 |\u001b[39m     (process \u001b[36mas\u001b[39m any)\u001b[33m.\u001b[39menv\u001b[33m.\u001b[39m\u001b[33mJWKS_TTL_MS\u001b[39m \u001b[33m=\u001b[39m \u001b[32m'1'\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 15 |\u001b[39m     \u001b[36mconst\u001b[39m again \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mOutcomesPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(body\u001b[33m,\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m'Bearer bad.token.value'\u001b[39m }))\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.jwks.rotation.spec.ts:12:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.jwks.rotation.spec.ts","startTime":1756202412810,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["API flags/providers/user profile+role"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"API flags/providers/user profile+role flags: GET 401 unauth; PATCH requires key; both echo x-request-id","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"flags: GET 401 unauth; PATCH requires key; both echo x-request-id"},{"ancestorTitles":["API flags/providers/user profile+role"],"duration":3,"failureDetails":[{"matcherResult":{"actual":429,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.flags.providers.users.spec.ts:34:24)"],"fullName":"API flags/providers/user profile+role providers: GET 401; POST admin-only; PATCH/DELETE validations","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"providers: GET 401; POST admin-only; PATCH/DELETE validations"},{"ancestorTitles":["API flags/providers/user profile+role"],"duration":4,"failureDetails":[{"matcherResult":{"actual":429,"expected":400,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.flags.providers.users.spec.ts:62:24)"],"fullName":"API flags/providers/user profile+role user profile GET: unauth 401; 200 shape in TEST_MODE; PUT validation 400","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"user profile GET: unauth 401; 200 shape in TEST_MODE; PUT validation 400"},{"ancestorTitles":["API flags/providers/user profile+role"],"duration":5,"failureDetails":[{"matcherResult":{"actual":429,"expected":401,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.flags.providers.users.spec.ts:67:24)"],"fullName":"API flags/providers/user profile+role user role PATCH: unauth 401; non-admin 403; admin ok","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"user role PATCH: unauth 401; non-admin 403; admin ok"}],"endTime":1756202413079,"message":"  ● API flags/providers/user profile+role › providers: GET 401; POST admin-only; PATCH/DELETE validations\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 429\n\n    \u001b[0m \u001b[90m 32 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 33 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mProvidersPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/providers'\u001b[39m\u001b[33m,\u001b[39m { name\u001b[33m:\u001b[39m \u001b[32m'p'\u001b[39m\u001b[33m,\u001b[39m jwks_url\u001b[33m:\u001b[39m \u001b[32m'j'\u001b[39m\u001b[33m,\u001b[39m domain\u001b[33m:\u001b[39m \u001b[32m'd'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 34 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 35 |\u001b[39m     \u001b[90m// admin valid\u001b[39m\n     \u001b[90m 36 |\u001b[39m     \u001b[90m// @ts-ignore\u001b[39m\n     \u001b[90m 37 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'admin'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.flags.providers.users.spec.ts:34:24)\n\n  ● API flags/providers/user profile+role › user profile GET: unauth 401; 200 shape in TEST_MODE; PUT validation 400\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 400\n    Received: 429\n\n    \u001b[0m \u001b[90m 60 |\u001b[39m     \u001b[90m// invalid PUT → 400\u001b[39m\n     \u001b[90m 61 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mProfilePUT\u001b[39m \u001b[36mas\u001b[39m any)(put(\u001b[32m'http://localhost/api/user/profile'\u001b[39m\u001b[33m,\u001b[39m { display_name\u001b[33m:\u001b[39m \u001b[35m42\u001b[39m } \u001b[36mas\u001b[39m any))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 62 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 63 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 64 |\u001b[39m\n     \u001b[90m 65 |\u001b[39m   test(\u001b[32m'user role PATCH: unauth 401; non-admin 403; admin ok'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/api.flags.providers.users.spec.ts:62:24)\n\n  ● API flags/providers/user profile+role › user role PATCH: unauth 401; non-admin 403; admin ok\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 401\n    Received: 429\n\n    \u001b[0m \u001b[90m 65 |\u001b[39m   test(\u001b[32m'user role PATCH: unauth 401; non-admin 403; admin ok'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 66 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mRolePATCH\u001b[39m \u001b[36mas\u001b[39m any)(patch(\u001b[32m'http://localhost/api/user/role'\u001b[39m\u001b[33m,\u001b[39m { userId\u001b[33m:\u001b[39m \u001b[32m'00000000-0000-0000-0000-000000000001'\u001b[39m\u001b[33m,\u001b[39m role\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 67 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 68 |\u001b[39m     \u001b[90m// non-admin\u001b[39m\n     \u001b[90m 69 |\u001b[39m     \u001b[90m// @ts-ignore\u001b[39m\n     \u001b[90m 70 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.flags.providers.users.spec.ts:67:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.flags.providers.users.spec.ts","startTime":1756202412906,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Assignments RLS/authorization negatives"],"duration":24,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [401, 403]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [401, 403]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\db.rls.assignments.negative.spec.ts:6:23)"],"fullName":"Assignments RLS/authorization negatives student cannot create assignment","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"student cannot create assignment"},{"ancestorTitles":["Assignments RLS/authorization negatives"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [401, 403]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [401, 403]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\db.rls.assignments.negative.spec.ts:13:23)"],"fullName":"Assignments RLS/authorization negatives student cannot update assignment","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"student cannot update assignment"},{"ancestorTitles":["Assignments RLS/authorization negatives"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [401, 403]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [401, 403]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\db.rls.assignments.negative.spec.ts:20:23)"],"fullName":"Assignments RLS/authorization negatives student cannot delete assignment","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"student cannot delete assignment"}],"endTime":1756202413272,"message":"  ● Assignments RLS/authorization negatives › student cannot create assignment\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 400\n    Received array: [401, 403]\n\n    \u001b[0m \u001b[90m 4 |\u001b[39m     \u001b[36mconst\u001b[39m req \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/assignments'\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'POST'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m { \u001b[32m'content-type'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'application/json'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m } \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m body\u001b[33m:\u001b[39m \u001b[33mJSON\u001b[39m\u001b[33m.\u001b[39mstringify({ course_id\u001b[33m:\u001b[39m \u001b[32m'c1'\u001b[39m\u001b[33m,\u001b[39m title\u001b[33m:\u001b[39m \u001b[32m'X'\u001b[39m\u001b[33m,\u001b[39m points\u001b[33m:\u001b[39m \u001b[35m10\u001b[39m\u001b[33m,\u001b[39m due_at\u001b[33m:\u001b[39m \u001b[36mnull\u001b[39m }) } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 5 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m route\u001b[33m.\u001b[39m\u001b[33mPOST\u001b[39m(req \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 6 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m   |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 7 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 8 |\u001b[39m\n     \u001b[90m 9 |\u001b[39m   test(\u001b[32m'student cannot update assignment'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/db.rls.assignments.negative.spec.ts:6:23)\n\n  ● Assignments RLS/authorization negatives › student cannot update assignment\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 429\n    Received array: [401, 403]\n\n    \u001b[0m \u001b[90m 11 |\u001b[39m     \u001b[36mconst\u001b[39m req \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/assignments?id=aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa'\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'PATCH'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m { \u001b[32m'content-type'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'application/json'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m } \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m body\u001b[33m:\u001b[39m \u001b[33mJSON\u001b[39m\u001b[33m.\u001b[39mstringify({ title\u001b[33m:\u001b[39m \u001b[32m'New'\u001b[39m }) } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 12 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m route\u001b[33m.\u001b[39m\u001b[33mPATCH\u001b[39m(req \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 13 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 14 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 15 |\u001b[39m\n     \u001b[90m 16 |\u001b[39m   test(\u001b[32m'student cannot delete assignment'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/db.rls.assignments.negative.spec.ts:13:23)\n\n  ● Assignments RLS/authorization negatives › student cannot delete assignment\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 429\n    Received array: [401, 403]\n\n    \u001b[0m \u001b[90m 18 |\u001b[39m     \u001b[36mconst\u001b[39m req \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/assignments?id=aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa'\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'DELETE'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m } } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 19 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m route\u001b[33m.\u001b[39m\u001b[33mDELETE\u001b[39m(req \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 20 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 21 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 22 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 23 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/db.rls.assignments.negative.spec.ts:20:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\db.rls.assignments.negative.spec.ts","startTime":1756202413083,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["validation bad-request matrix"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"validation bad-request matrix assignments invalid course_id → 400/401","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"assignments invalid course_id → 400/401"},{"ancestorTitles":["validation bad-request matrix"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"validation bad-request matrix quizzes invalid course_id → 400/401","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"quizzes invalid course_id → 400/401"},{"ancestorTitles":["validation bad-request matrix"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"validation bad-request matrix quiz-questions invalid quiz_id → 400/401","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"quiz-questions invalid quiz_id → 400/401"},{"ancestorTitles":["validation bad-request matrix"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"validation bad-request matrix messages invalid thread_id → 400/401","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"messages invalid thread_id → 400/401"},{"ancestorTitles":["validation bad-request matrix"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"validation bad-request matrix parent-links missing fields → 400/401","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"parent-links missing fields → 400/401"},{"ancestorTitles":["validation bad-request matrix"],"duration":0,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [400, 401]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [400, 401]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.validation.bad-request.matrix.spec.ts:43:23)"],"fullName":"validation bad-request matrix upload-url missing content_type → 400/401","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"upload-url missing content_type → 400/401"},{"ancestorTitles":["validation bad-request matrix"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"validation bad-request matrix download-url missing id → 400/401","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"download-url missing id → 400/401"},{"ancestorTitles":["validation bad-request matrix"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [400, 401]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [400, 401]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.validation.bad-request.matrix.spec.ts:53:23)"],"fullName":"validation bad-request matrix resolve missing keys in body → 400/401","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"resolve missing keys in body → 400/401"},{"ancestorTitles":["validation bad-request matrix"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"validation bad-request matrix engagement missing course_id → 400/401","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"engagement missing course_id → 400/401"},{"ancestorTitles":["validation bad-request matrix"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"validation bad-request matrix registry versions missing external_course_id → 400/401/403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"registry versions missing external_course_id → 400/401/403"}],"endTime":1756202413653,"message":"  ● validation bad-request matrix › upload-url missing content_type → 400/401\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 429\n    Received array: [400, 401]\n\n    \u001b[0m \u001b[90m 41 |\u001b[39m   test(\u001b[32m'upload-url missing content_type → 400/401'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 42 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mUploadPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/files/upload-url'\u001b[39m\u001b[33m,\u001b[39m { owner_type\u001b[33m:\u001b[39m \u001b[32m'user'\u001b[39m\u001b[33m,\u001b[39m owner_id\u001b[33m:\u001b[39m \u001b[32m'u'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 43 |\u001b[39m     expect([\u001b[35m400\u001b[39m\u001b[33m,\u001b[39m\u001b[35m401\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 44 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 45 |\u001b[39m\n     \u001b[90m 46 |\u001b[39m   test(\u001b[32m'download-url missing id → 400/401'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/api.validation.bad-request.matrix.spec.ts:43:23)\n\n  ● validation bad-request matrix › resolve missing keys in body → 400/401\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 429\n    Received array: [400, 401]\n\n    \u001b[0m \u001b[90m 51 |\u001b[39m   test(\u001b[32m'resolve missing keys in body → 400/401'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 52 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mResolvePOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/files/resolve'\u001b[39m\u001b[33m,\u001b[39m {}))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 53 |\u001b[39m     expect([\u001b[35m400\u001b[39m\u001b[33m,\u001b[39m\u001b[35m401\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 54 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 55 |\u001b[39m\n     \u001b[90m 56 |\u001b[39m   test(\u001b[32m'engagement missing course_id → 400/401'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/api.validation.bad-request.matrix.spec.ts:53:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.validation.bad-request.matrix.spec.ts","startTime":1756202413275,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime outcomes rate-limit headers"],"duration":1,"failureDetails":[{"matcherResult":{"actual":400,"expected":429,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 429\nReceived: 400","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 429\nReceived: 400\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.outcomes.rate-limit.spec.ts:27:24)"],"fullName":"runtime outcomes rate-limit headers 429 includes retry-after and rate-limit headers","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"429 includes retry-after and rate-limit headers"}],"endTime":1756202413874,"message":"  ● runtime outcomes rate-limit headers › 429 includes retry-after and rate-limit headers\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 429\n    Received: 400\n\n    \u001b[0m \u001b[90m 25 |\u001b[39m     })\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mOutcomesPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/outcomes'\u001b[39m\u001b[33m,\u001b[39m { courseId\u001b[33m:\u001b[39m \u001b[32m'c1'\u001b[39m\u001b[33m,\u001b[39m userId\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m event\u001b[33m:\u001b[39m { type\u001b[33m:\u001b[39m \u001b[32m'progress'\u001b[39m\u001b[33m,\u001b[39m pct\u001b[33m:\u001b[39m \u001b[35m10\u001b[39m } }\u001b[33m,\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m'Bearer good'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 27 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m429\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 28 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'retry-after'\u001b[39m))\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m 29 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'x-rate-limit-remaining'\u001b[39m))\u001b[33m.\u001b[39mtoBe(\u001b[32m'0'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 30 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'x-rate-limit-reset'\u001b[39m))\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.outcomes.rate-limit.spec.ts:27:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.outcomes.rate-limit.spec.ts","startTime":1756202413662,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["providers POST negatives"],"duration":3,"failureDetails":[{"matcherResult":{"actual":429,"expected":400,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.providers.create.negatives.spec.ts:23:25)"],"fullName":"providers POST negatives rejects non-https jwks_url and domain","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"rejects non-https jwks_url and domain"}],"endTime":1756202414053,"message":"  ● providers POST negatives › rejects non-https jwks_url and domain\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 400\n    Received: 429\n\n    \u001b[0m \u001b[90m 21 |\u001b[39m     expect(bad1\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 22 |\u001b[39m     \u001b[36mconst\u001b[39m bad2 \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mProvidersPOST\u001b[39m \u001b[36mas\u001b[39m any)(req({ name\u001b[33m:\u001b[39m \u001b[32m'P'\u001b[39m\u001b[33m,\u001b[39m jwks_url\u001b[33m:\u001b[39m \u001b[32m'https://ok'\u001b[39m\u001b[33m,\u001b[39m domain\u001b[33m:\u001b[39m \u001b[32m'http://no'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 23 |\u001b[39m     expect(bad2\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                         \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 24 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 25 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.providers.create.negatives.spec.ts:23:25)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.providers.create.negatives.spec.ts","startTime":1756202413884,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime outcomes JWKS verification"],"duration":1,"failureDetails":[{"matcherResult":{"actual":400,"expected":401,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 400","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 400\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.outcomes.jwks.spec.ts:20:24)"],"fullName":"runtime outcomes JWKS verification missing provider token -> 401 when jwks_url present","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"missing provider token -> 401 when jwks_url present"},{"ancestorTitles":["runtime outcomes JWKS verification"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [403]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [403]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.outcomes.jwks.spec.ts:34:19)"],"fullName":"runtime outcomes JWKS verification invalid provider token -> 403","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"invalid provider token -> 403"},{"ancestorTitles":["runtime outcomes JWKS verification"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [200, 201]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [200, 201]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.outcomes.jwks.spec.ts:49:23)"],"fullName":"runtime outcomes JWKS verification valid provider token (mocked) -> 201","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"valid provider token (mocked) -> 201"}],"endTime":1756202414293,"message":"  ● runtime outcomes JWKS verification › missing provider token -> 401 when jwks_url present\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 401\n    Received: 400\n\n    \u001b[0m \u001b[90m 18 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m \u001b[32m'getRouteHandlerSupabase'\u001b[39m)\u001b[33m.\u001b[39mmockReturnValue(mock)\u001b[33m;\u001b[39m\n     \u001b[90m 19 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mOutcomesPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/outcomes'\u001b[39m\u001b[33m,\u001b[39m { courseId\u001b[33m:\u001b[39m \u001b[32m'c1'\u001b[39m\u001b[33m,\u001b[39m userId\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m event\u001b[33m:\u001b[39m { type\u001b[33m:\u001b[39m \u001b[32m'progress'\u001b[39m\u001b[33m,\u001b[39m pct\u001b[33m:\u001b[39m \u001b[35m10\u001b[39m } }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 20 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 21 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 22 |\u001b[39m\n     \u001b[90m 23 |\u001b[39m   test(\u001b[32m'invalid provider token -> 403'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.outcomes.jwks.spec.ts:20:24)\n\n  ● runtime outcomes JWKS verification › invalid provider token -> 403\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 400\n    Received array: [403]\n\n    \u001b[0m \u001b[90m 32 |\u001b[39m     })\u001b[33m;\u001b[39m\n     \u001b[90m 33 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mOutcomesPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/outcomes'\u001b[39m\u001b[33m,\u001b[39m { courseId\u001b[33m:\u001b[39m \u001b[32m'c1'\u001b[39m\u001b[33m,\u001b[39m userId\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m event\u001b[33m:\u001b[39m { type\u001b[33m:\u001b[39m \u001b[32m'progress'\u001b[39m\u001b[33m,\u001b[39m pct\u001b[33m:\u001b[39m \u001b[35m10\u001b[39m } }\u001b[33m,\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m'Bearer bad'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 34 |\u001b[39m     expect([\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 35 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 36 |\u001b[39m\n     \u001b[90m 37 |\u001b[39m   test(\u001b[32m'valid provider token (mocked) -> 201'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.outcomes.jwks.spec.ts:34:19)\n\n  ● runtime outcomes JWKS verification › valid provider token (mocked) -> 201\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 429\n    Received array: [200, 201]\n\n    \u001b[0m \u001b[90m 47 |\u001b[39m     })\u001b[33m;\u001b[39m\n     \u001b[90m 48 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mOutcomesPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/outcomes'\u001b[39m\u001b[33m,\u001b[39m { courseId\u001b[33m:\u001b[39m \u001b[32m'c1'\u001b[39m\u001b[33m,\u001b[39m userId\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m event\u001b[33m:\u001b[39m { type\u001b[33m:\u001b[39m \u001b[32m'attempt.completed'\u001b[39m\u001b[33m,\u001b[39m score\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m max\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m passed\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m } }\u001b[33m,\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m'Bearer good'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 49 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m201\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 50 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 51 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 52 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.outcomes.jwks.spec.ts:49:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.outcomes.jwks.spec.ts","startTime":1756202414062,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime progress idempotency"],"duration":7,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 201, 204]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 201, 204]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.idempotency.spec.ts:27:27)"],"fullName":"runtime progress idempotency duplicate request with same Idempotency-Key is replayed 200 with header","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"duplicate request with same Idempotency-Key is replayed 200 with header"}],"endTime":1756202414480,"message":"  ● runtime progress idempotency › duplicate request with same Idempotency-Key is replayed 200 with header\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 403\n    Received array: [200, 201, 204]\n\n    \u001b[0m \u001b[90m 25 |\u001b[39m     \u001b[36mconst\u001b[39m h \u001b[33m=\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m`Bearer ${token}`\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'Idempotency-Key'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'dup-1'\u001b[39m } \u001b[36mas\u001b[39m \u001b[33mRecord\u001b[39m\u001b[33m<\u001b[39m\u001b[33mstring\u001b[39m\u001b[33m,\u001b[39mstring\u001b[33m>\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mProgressPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/progress'\u001b[39m\u001b[33m,\u001b[39m h))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 27 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m201\u001b[39m\u001b[33m,\u001b[39m\u001b[35m204\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                           \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 28 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mProgressPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/progress'\u001b[39m\u001b[33m,\u001b[39m h))\u001b[33m;\u001b[39m\n     \u001b[90m 29 |\u001b[39m     expect([\u001b[35m200\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m 30 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'idempotency-replayed'\u001b[39m))\u001b[33m.\u001b[39mtoBe(\u001b[32m'1'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.idempotency.spec.ts:27:27)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.idempotency.spec.ts","startTime":1756202414297,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["files default content_type"],"duration":4,"failureDetails":[{"matcherResult":{"actual":"application/json","expected":"application/octet-stream","message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: \"application/octet-stream\"\nReceived: \"application/json\"","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: \"application/octet-stream\"\nReceived: \"application/json\"\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.content-type-default.spec.ts:24:44)"],"fullName":"files default content_type defaults to application/octet-stream when omitted","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"defaults to application/octet-stream when omitted"}],"endTime":1756202414649,"message":"  ● files default content_type › defaults to application/octet-stream when omitted\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"application/octet-stream\"\n    Received: \"application/json\"\n\n    \u001b[0m \u001b[90m 22 |\u001b[39m     \u001b[36mconst\u001b[39m { id } \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m put\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n     \u001b[90m 23 |\u001b[39m     \u001b[36mconst\u001b[39m dl \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mDownloadGET\u001b[39m \u001b[36mas\u001b[39m any)(getUrl(\u001b[32m`http://localhost/api/files/download-url?id=${id}`\u001b[39m\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 24 |\u001b[39m     expect(dl\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'content-type'\u001b[39m))\u001b[33m.\u001b[39mtoBe(\u001b[32m'application/octet-stream'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                                            \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 25 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 27 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.files.content-type-default.spec.ts:24:44)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.content-type-default.spec.ts","startTime":1756202414485,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Feature flags API (test-mode)"],"duration":21,"failureDetails":[{"matcherResult":{"actual":429,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.flags.spec.ts:18:23)"],"fullName":"Feature flags API (test-mode) GET requires auth, returns list; PATCH validates key","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"failed","title":"GET requires auth, returns list; PATCH validates key"}],"endTime":1756202414812,"message":"  ● Feature flags API (test-mode) › GET requires auth, returns list; PATCH validates key\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 429\n\n    \u001b[0m \u001b[90m 16 |\u001b[39m     \u001b[90m// PATCH toggle a flag\u001b[39m\n     \u001b[90m 17 |\u001b[39m     \u001b[36mconst\u001b[39m ok \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m route\u001b[33m.\u001b[39m\u001b[33mPATCH\u001b[39m(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/flags'\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'PATCH'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m { \u001b[32m'content-type'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'application/json'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'admin'\u001b[39m }\u001b[33m,\u001b[39m body\u001b[33m:\u001b[39m \u001b[33mJSON\u001b[39m\u001b[33m.\u001b[39mstringify({ key\u001b[33m:\u001b[39m \u001b[32m'reports.enabled'\u001b[39m\u001b[33m,\u001b[39m value\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m }) }) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 18 |\u001b[39m     expect(ok\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 19 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 20 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 21 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.flags.spec.ts:18:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.flags.spec.ts","startTime":1756202414652,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime checkpoint scopes"],"duration":8,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 201, 204]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 201, 204]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.checkpoint.scopes.spec.ts:37:27)"],"fullName":"runtime checkpoint scopes save requires progress.write; load requires progress.read","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"save requires progress.write; load requires progress.read"}],"endTime":1756202415129,"message":"  ● runtime checkpoint scopes › save requires progress.write; load requires progress.read\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 403\n    Received array: [200, 201, 204]\n\n    \u001b[0m \u001b[90m 35 |\u001b[39m     token \u001b[33m=\u001b[39m makeJwt([\u001b[32m'progress.write'\u001b[39m])\u001b[33m;\u001b[39m\n     \u001b[90m 36 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mSavePOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/checkpoint/save'\u001b[39m\u001b[33m,\u001b[39m { key\u001b[33m:\u001b[39m \u001b[32m'k'\u001b[39m\u001b[33m,\u001b[39m state\u001b[33m:\u001b[39m { a\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m } }\u001b[33m,\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m`Bearer ${token}`\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 37 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m201\u001b[39m\u001b[33m,\u001b[39m\u001b[35m204\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                           \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 38 |\u001b[39m     \u001b[90m// Load without scope -> 403\u001b[39m\n     \u001b[90m 39 |\u001b[39m     token \u001b[33m=\u001b[39m makeJwt([])\u001b[33m;\u001b[39m\n     \u001b[90m 40 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mLoadGET\u001b[39m \u001b[36mas\u001b[39m any)(\u001b[36mget\u001b[39m(\u001b[32m'http://localhost/api/runtime/checkpoint/load?key=k'\u001b[39m\u001b[33m,\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m`Bearer ${token}`\u001b[39m }))\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.checkpoint.scopes.spec.ts:37:27)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.checkpoint.scopes.spec.ts","startTime":1756202414815,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime auth exchange"],"duration":3,"failureDetails":[{"matcherResult":{"actual":400,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 400","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 400\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.auth.exchange.spec.ts:24:24)"],"fullName":"runtime auth exchange invalid token → 403","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"invalid token → 403"},{"ancestorTitles":["runtime auth exchange"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"runtime auth exchange audience mismatch when origin allowed → 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"audience mismatch when origin allowed → 403"},{"ancestorTitles":["runtime auth exchange"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [200]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [200]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.auth.exchange.spec.ts:49:19)"],"fullName":"runtime auth exchange valid dev token and matching origin → 200 returns runtimeToken","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"valid dev token and matching origin → 200 returns runtimeToken"}],"endTime":1756202415291,"message":"  ● runtime auth exchange › invalid token → 403\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 400\n\n    \u001b[0m \u001b[90m 22 |\u001b[39m   test(\u001b[32m'invalid token → 403'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 23 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mExchangePOST\u001b[39m \u001b[36mas\u001b[39m any)(post({ token\u001b[33m:\u001b[39m \u001b[32m'bad'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 24 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 25 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m\n     \u001b[90m 27 |\u001b[39m   test(\u001b[32m'audience mismatch when origin allowed → 403'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.auth.exchange.spec.ts:24:24)\n\n  ● runtime auth exchange › valid dev token and matching origin → 200 returns runtimeToken\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 429\n    Received array: [200]\n\n    \u001b[0m \u001b[90m 47 |\u001b[39m     \u001b[36mconst\u001b[39m token \u001b[33m=\u001b[39m makeHsToken(claims)\u001b[33m;\u001b[39m\n     \u001b[90m 48 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mExchangePOST\u001b[39m \u001b[36mas\u001b[39m any)(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/runtime/auth/exchange'\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'POST'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m { \u001b[32m'content-type'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'application/json'\u001b[39m\u001b[33m,\u001b[39m origin\u001b[33m:\u001b[39m \u001b[32m'https://provider.example'\u001b[39m } \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m body\u001b[33m:\u001b[39m \u001b[33mJSON\u001b[39m\u001b[33m.\u001b[39mstringify({ token }) } \u001b[36mas\u001b[39m any))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 49 |\u001b[39m     expect([\u001b[35m200\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 50 |\u001b[39m     \u001b[36mconst\u001b[39m json \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m res\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n     \u001b[90m 51 |\u001b[39m     expect(json\u001b[33m.\u001b[39mruntimeToken)\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m 52 |\u001b[39m     expect(json\u001b[33m.\u001b[39mexpiresAt)\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.auth.exchange.spec.ts:49:19)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.auth.exchange.spec.ts","startTime":1756202415134,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Parent Children Report (labs)"],"duration":1,"failureDetails":[{}],"failureMessages":["TypeError: c.getAll is not a function\n    at ParentChildrenReportPage (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\app\\labs\\parent\\children-report\\page.tsx:10:45)\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\ParentChildrenReport.spec.tsx:30:46)\n    at Promise.then.completed (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"Parent Children Report (labs) renders total and items","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"renders total and items"}],"endTime":1756202415621,"message":"  ● Parent Children Report (labs) › renders total and items\n\n    TypeError: c.getAll is not a function\n\n    \u001b[0m \u001b[90m  8 |\u001b[39m   \u001b[36mconst\u001b[39m h \u001b[33m=\u001b[39m headers()\u001b[33m;\u001b[39m\n     \u001b[90m  9 |\u001b[39m   \u001b[36mconst\u001b[39m c \u001b[33m=\u001b[39m cookies()\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 10 |\u001b[39m   \u001b[36mconst\u001b[39m cookieHeader \u001b[33m=\u001b[39m h\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"cookie\"\u001b[39m) \u001b[33m?\u001b[39m\u001b[33m?\u001b[39m c\u001b[33m.\u001b[39mgetAll()\u001b[33m.\u001b[39mmap(x \u001b[33m=>\u001b[39m \u001b[32m`${x.name}=${x.value}`\u001b[39m)\u001b[33m.\u001b[39mjoin(\u001b[32m\"; \"\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                                             \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 11 |\u001b[39m   \u001b[36mconst\u001b[39m testAuth \u001b[33m=\u001b[39m h\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"x-test-auth\"\u001b[39m) \u001b[33m?\u001b[39m\u001b[33m?\u001b[39m c\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m\"x-test-auth\"\u001b[39m)\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mvalue\u001b[33m;\u001b[39m\n     \u001b[90m 12 |\u001b[39m\n     \u001b[90m 13 |\u001b[39m   \u001b[36mlet\u001b[39m rows\u001b[33m:\u001b[39m \u001b[33mParentLink\u001b[39m[] \u001b[33m=\u001b[39m []\u001b[33m;\u001b[39m\u001b[0m\n\n      at ParentChildrenReportPage (../apps/web/src/app/labs/parent/children-report/page.tsx:10:45)\n      at Object.<anonymous> (unit/ui/ParentChildrenReport.spec.tsx:30:46)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\ParentChildrenReport.spec.tsx","startTime":1756202415302,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/quiz-questions (TEST_MODE)"],"duration":3,"failureDetails":[{"matcherResult":{"actual":429,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.quiz-questions.spec.ts:20:24)"],"fullName":"API /api/quiz-questions (TEST_MODE) POST: unauth 401; non-teacher 403; invalid payload 400","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"POST: unauth 401; non-teacher 403; invalid payload 400"},{"ancestorTitles":["API /api/quiz-questions (TEST_MODE)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"API /api/quiz-questions (TEST_MODE) GET: unauth 401; missing quiz_id 400; ok 200","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"GET: unauth 401; missing quiz_id 400; ok 200"}],"endTime":1756202415720,"message":"  ● API /api/quiz-questions (TEST_MODE) › POST: unauth 401; non-teacher 403; invalid payload 400\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 429\n\n    \u001b[0m \u001b[90m 18 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 19 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mQQPost\u001b[39m \u001b[36mas\u001b[39m any)(post({ quiz_id\u001b[33m:\u001b[39m \u001b[32m'00000000-0000-0000-0000-000000000123'\u001b[39m\u001b[33m,\u001b[39m text\u001b[33m:\u001b[39m \u001b[32m'Question'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 20 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 21 |\u001b[39m     \u001b[90m// teacher invalid payload -> 400 (min text len)\u001b[39m\n     \u001b[90m 22 |\u001b[39m     \u001b[90m// @ts-ignore\u001b[39m\n     \u001b[90m 23 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.quiz-questions.spec.ts:20:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.quiz-questions.spec.ts","startTime":1756202415625,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["files finalize ownership checks"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 401\nReceived array: [200, 403, 404]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 401\nReceived array: [200, 403, 404]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.finalize.permissions.spec.ts:17:27)"],"fullName":"files finalize ownership checks owner-only for user/submission attachments; teacher for lesson/announcement","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"owner-only for user/submission attachments; teacher for lesson/announcement"}],"endTime":1756202415804,"message":"  ● files finalize ownership checks › owner-only for user/submission attachments; teacher for lesson/announcement\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 401\n    Received array: [200, 403, 404]\n\n    \u001b[0m \u001b[90m 15 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m \u001b[32m'getRouteHandlerSupabase'\u001b[39m)\u001b[33m.\u001b[39mmockReturnValue(mock1)\u001b[33m;\u001b[39m\n     \u001b[90m 16 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mFinalizePOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/files/finalize'\u001b[39m\u001b[33m,\u001b[39m { key\u001b[33m:\u001b[39m \u001b[32m'k'\u001b[39m\u001b[33m,\u001b[39m size_bytes\u001b[33m:\u001b[39m \u001b[35m10\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 17 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m\u001b[33m,\u001b[39m\u001b[35m404\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                           \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 18 |\u001b[39m\n     \u001b[90m 19 |\u001b[39m     \u001b[90m// Submission non-owner -> 403\u001b[39m\n     \u001b[90m 20 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m \u001b[32m'getCurrentUserInRoute'\u001b[39m)\u001b[33m.\u001b[39mmockResolvedValue({ id\u001b[33m:\u001b[39m \u001b[32m'u2'\u001b[39m } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.files.finalize.permissions.spec.ts:17:27)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.finalize.permissions.spec.ts","startTime":1756202415722,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["messages POST rate limit headers"],"duration":3,"failureDetails":[{"matcherResult":{"actual":201,"expected":429,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 429\nReceived: 201","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 429\nReceived: 201\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.post.ratelimit.spec.ts:21:24)"],"fullName":"messages POST rate limit headers returns 429 with standard headers when rate-limited","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"returns 429 with standard headers when rate-limited"}],"endTime":1756202415931,"message":"  ● messages POST rate limit headers › returns 429 with standard headers when rate-limited\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 429\n    Received: 201\n\n    \u001b[0m \u001b[90m 19 |\u001b[39m   test(\u001b[32m'returns 429 with standard headers when rate-limited'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 20 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mMessagesPOST\u001b[39m \u001b[36mas\u001b[39m any)(post({ thread_id\u001b[33m:\u001b[39m \u001b[32m'00000000-0000-0000-0000-000000000001'\u001b[39m\u001b[33m,\u001b[39m body\u001b[33m:\u001b[39m \u001b[32m'hello'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 21 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m429\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 22 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'retry-after'\u001b[39m))\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m 23 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'x-rate-limit-reset'\u001b[39m))\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m 24 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'x-rate-limit-remaining'\u001b[39m))\u001b[33m.\u001b[39mtoBe(\u001b[32m'0'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.messages.post.ratelimit.spec.ts:21:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.post.ratelimit.spec.ts","startTime":1756202415806,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime outcomes JWKS/JWT rotation and alg/aud/iss enforcement"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [401, 403]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [401, 403]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.outcomes.alg-kid-iss-aud.spec.ts:10:23)"],"fullName":"runtime outcomes JWKS/JWT rotation and alg/aud/iss enforcement rejects non-RS256 tokens","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"rejects non-RS256 tokens"}],"endTime":1756202416061,"message":"  ● runtime outcomes JWKS/JWT rotation and alg/aud/iss enforcement › rejects non-RS256 tokens\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 400\n    Received array: [401, 403]\n\n    \u001b[0m \u001b[90m  8 |\u001b[39m   test(\u001b[32m'rejects non-RS256 tokens'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m  9 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mOutcomesPOST\u001b[39m \u001b[36mas\u001b[39m any)(post({ courseId\u001b[33m:\u001b[39m \u001b[32m'c1'\u001b[39m\u001b[33m,\u001b[39m userId\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m event\u001b[33m:\u001b[39m { type\u001b[33m:\u001b[39m \u001b[32m'progress'\u001b[39m\u001b[33m,\u001b[39m pct\u001b[33m:\u001b[39m \u001b[35m10\u001b[39m } }\u001b[33m,\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m'Bearer header.payload.sig'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 10 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 11 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 12 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 13 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.outcomes.alg-kid-iss-aud.spec.ts:10:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.outcomes.alg-kid-iss-aud.spec.ts","startTime":1756202415933,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/parent-links"],"duration":4,"failureDetails":[{"matcherResult":{"actual":429,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.parent-links.spec.ts:25:24)"],"fullName":"API /api/parent-links POST unauth → 401; non-admin → 403; admin 201","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"POST unauth → 401; non-admin → 403; admin 201"},{"ancestorTitles":["API /api/parent-links"],"duration":2,"failureDetails":[{"matcherResult":{"actual":429,"expected":401,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.parent-links.spec.ts:35:24)"],"fullName":"API /api/parent-links DELETE unauth → 401; non-admin → 403; admin 200","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"DELETE unauth → 401; non-admin → 403; admin 200"},{"ancestorTitles":["API /api/parent-links"],"duration":3,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 204]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 204]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.parent-links.spec.ts:60:24)"],"fullName":"API /api/parent-links GET unauth → 401; missing parent_id → 400; non-admin self allowed; non-self forbidden","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"GET unauth → 401; missing parent_id → 400; non-admin self allowed; non-self forbidden"}],"endTime":1756202416235,"message":"  ● API /api/parent-links › POST unauth → 401; non-admin → 403; admin 201\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 429\n\n    \u001b[0m \u001b[90m 23 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 24 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mPLPost\u001b[39m \u001b[36mas\u001b[39m any)(makePost({ parent_id\u001b[33m:\u001b[39m \u001b[32m'p1'\u001b[39m\u001b[33m,\u001b[39m student_id\u001b[33m:\u001b[39m \u001b[32m's1'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 25 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 26 |\u001b[39m     \u001b[90m// simulate admin\u001b[39m\n     \u001b[90m 27 |\u001b[39m     \u001b[90m// @ts-ignore\u001b[39m\n     \u001b[90m 28 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'admin'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.parent-links.spec.ts:25:24)\n\n  ● API /api/parent-links › DELETE unauth → 401; non-admin → 403; admin 200\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 401\n    Received: 429\n\n    \u001b[0m \u001b[90m 33 |\u001b[39m   test(\u001b[32m'DELETE unauth → 401; non-admin → 403; admin 200'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 34 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mPLDelete\u001b[39m \u001b[36mas\u001b[39m any)(makeDelete({ parent_id\u001b[33m:\u001b[39m \u001b[32m'p1'\u001b[39m\u001b[33m,\u001b[39m student_id\u001b[33m:\u001b[39m \u001b[32m's1'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 35 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 36 |\u001b[39m     \u001b[90m// teacher forbidden\u001b[39m\n     \u001b[90m 37 |\u001b[39m     \u001b[90m// @ts-ignore\u001b[39m\n     \u001b[90m 38 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.parent-links.spec.ts:35:24)\n\n  ● API /api/parent-links › GET unauth → 401; missing parent_id → 400; non-admin self allowed; non-self forbidden\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 403\n    Received array: [200, 204]\n\n    \u001b[0m \u001b[90m 58 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'parent'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 59 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mPLGet\u001b[39m \u001b[36mas\u001b[39m any)(makeGet(\u001b[32m'http://localhost/api/parent-links?parent_id=test-parent-id'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 60 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m \u001b[35m204\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 61 |\u001b[39m     \u001b[90m// parent non-self forbidden\u001b[39m\n     \u001b[90m 62 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mPLGet\u001b[39m \u001b[36mas\u001b[39m any)(makeGet(\u001b[32m'http://localhost/api/parent-links?parent_id=other-parent-id'\u001b[39m))\u001b[33m;\u001b[39m\n     \u001b[90m 63 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.parent-links.spec.ts:60:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.parent-links.spec.ts","startTime":1756202416065,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/lessons/complete"],"duration":3,"failureDetails":[{"matcherResult":{"actual":429,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.lessons.complete.spec.ts:19:24)"],"fullName":"API /api/lessons/complete unauth → 401; non-student → 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"unauth → 401; non-student → 403"},{"ancestorTitles":["API /api/lessons/complete"],"duration":2,"failureDetails":[{"matcherResult":{"actual":429,"expected":400,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.lessons.complete.spec.ts:27:24)"],"fullName":"API /api/lessons/complete invalid payload → 400; success returns latest with lessonId/completedAt","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"invalid payload → 400; success returns latest with lessonId/completedAt"},{"ancestorTitles":["POST /api/lessons/complete"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":401,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.lessons.complete.spec.ts:54:24)"],"fullName":"POST /api/lessons/complete requires auth","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"requires auth"},{"ancestorTitles":["POST /api/lessons/complete"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.lessons.complete.spec.ts:61:24)"],"fullName":"POST /api/lessons/complete student can mark complete","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"student can mark complete"}],"endTime":1756202416401,"message":"  ● API /api/lessons/complete › unauth → 401; non-student → 403\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 429\n\n    \u001b[0m \u001b[90m 17 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 18 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mCompletePOST\u001b[39m \u001b[36mas\u001b[39m any)(makePost({ lessonId\u001b[33m:\u001b[39m id }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 19 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 20 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 21 |\u001b[39m\n     \u001b[90m 22 |\u001b[39m   test(\u001b[32m'invalid payload → 400; success returns latest with lessonId/completedAt'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/api.lessons.complete.spec.ts:19:24)\n\n  ● API /api/lessons/complete › invalid payload → 400; success returns latest with lessonId/completedAt\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 400\n    Received: 429\n\n    \u001b[0m \u001b[90m 25 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mCompletePOST\u001b[39m \u001b[36mas\u001b[39m any)(makePost({}))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 27 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 28 |\u001b[39m     \u001b[36mconst\u001b[39m id \u001b[33m=\u001b[39m \u001b[32m'00000000-0000-0000-0000-00000000ab02'\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 29 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mCompletePOST\u001b[39m \u001b[36mas\u001b[39m any)(makePost({ lessonId\u001b[33m:\u001b[39m id }))\u001b[33m;\u001b[39m\n     \u001b[90m 30 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.lessons.complete.spec.ts:27:24)\n\n  ● POST /api/lessons/complete › requires auth\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 401\n    Received: 429\n\n    \u001b[0m \u001b[90m 52 |\u001b[39m   test(\u001b[32m\"requires auth\"\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 53 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mLessonsCompletePOST\u001b[39m \u001b[36mas\u001b[39m any)(makeReq({ lessonId\u001b[33m:\u001b[39m \u001b[32m\"11111111-1111-1111-1111-111111111111\"\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 54 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 55 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 56 |\u001b[39m\n     \u001b[90m 57 |\u001b[39m   test(\u001b[32m\"student can mark complete\"\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/api.lessons.complete.spec.ts:54:24)\n\n  ● POST /api/lessons/complete › student can mark complete\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 429\n\n    \u001b[0m \u001b[90m 59 |\u001b[39m       makeReq({ lessonId\u001b[33m:\u001b[39m \u001b[32m\"11111111-1111-1111-1111-111111111111\"\u001b[39m }\u001b[33m,\u001b[39m { \u001b[32m\"x-test-auth\"\u001b[39m\u001b[33m:\u001b[39m \u001b[32m\"student\"\u001b[39m })\n     \u001b[90m 60 |\u001b[39m     )\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 61 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 62 |\u001b[39m     \u001b[36mconst\u001b[39m json \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m res\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n     \u001b[90m 63 |\u001b[39m     expect(json\u001b[33m.\u001b[39mlatest\u001b[33m.\u001b[39mlessonId)\u001b[33m.\u001b[39mtoBe(\u001b[32m\"11111111-1111-1111-1111-111111111111\"\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 64 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.lessons.complete.spec.ts:61:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.lessons.complete.spec.ts","startTime":1756202416245,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/files/resolve"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"API /api/files/resolve unauth → 401 with x-request-id","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"unauth → 401 with x-request-id"},{"ancestorTitles":["API /api/files/resolve"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":400,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.resolve.spec.ts:19:24)"],"fullName":"API /api/files/resolve invalid payload → 400 Problem","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"invalid payload → 400 Problem"},{"ancestorTitles":["API /api/files/resolve"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.resolve.spec.ts:24:24)"],"fullName":"API /api/files/resolve test-mode: returns mapping for keys with signed download-url","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"test-mode: returns mapping for keys with signed download-url"}],"endTime":1756202416544,"message":"  ● API /api/files/resolve › invalid payload → 400 Problem\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 400\n    Received: 429\n\n    \u001b[0m \u001b[90m 17 |\u001b[39m   test(\u001b[32m'invalid payload → 400 Problem'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 18 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mResolvePOST\u001b[39m \u001b[36mas\u001b[39m any)(makePost({}))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 19 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 20 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 21 |\u001b[39m\n     \u001b[90m 22 |\u001b[39m   test(\u001b[32m'test-mode: returns mapping for keys with signed download-url'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/api.files.resolve.spec.ts:19:24)\n\n  ● API /api/files/resolve › test-mode: returns mapping for keys with signed download-url\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 429\n\n    \u001b[0m \u001b[90m 22 |\u001b[39m   test(\u001b[32m'test-mode: returns mapping for keys with signed download-url'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 23 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mResolvePOST\u001b[39m \u001b[36mas\u001b[39m any)(makePost({ keys\u001b[33m:\u001b[39m [\u001b[32m'abc'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'x y'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'z/1'\u001b[39m] }\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 24 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 25 |\u001b[39m     \u001b[36mconst\u001b[39m json \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m res\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m     expect(json[\u001b[32m'abc'\u001b[39m]\u001b[33m.\u001b[39murl)\u001b[33m.\u001b[39mtoBe(\u001b[32m'/api/files/download-url?id=abc'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 27 |\u001b[39m     expect(json[\u001b[32m'x y'\u001b[39m]\u001b[33m.\u001b[39murl)\u001b[33m.\u001b[39mtoBe(\u001b[32m'/api/files/download-url?id=x%20y'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.files.resolve.spec.ts:24:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.resolve.spec.ts","startTime":1756202416404,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/announcements (TEST_MODE)"],"duration":3,"failureDetails":[{"matcherResult":{"actual":429,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.announcements.spec.ts:20:24)"],"fullName":"API /api/announcements (TEST_MODE) POST: unauth 401; non-teacher 403; teacher 201","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"POST: unauth 401; non-teacher 403; teacher 201"},{"ancestorTitles":["API /api/announcements (TEST_MODE)"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"API /api/announcements (TEST_MODE) GET: unauth 401; missing course_id 400; ok 200","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"GET: unauth 401; missing course_id 400; ok 200"},{"ancestorTitles":["API /api/announcements (TEST_MODE)"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":401,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.announcements.spec.ts:43:24)"],"fullName":"API /api/announcements (TEST_MODE) DELETE: unauth 401; non-teacher 403; missing id 400; teacher 200","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"DELETE: unauth 401; non-teacher 403; missing id 400; teacher 200"}],"endTime":1756202416717,"message":"  ● API /api/announcements (TEST_MODE) › POST: unauth 401; non-teacher 403; teacher 201\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 429\n\n    \u001b[0m \u001b[90m 18 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 19 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAnnPOST\u001b[39m \u001b[36mas\u001b[39m any)(post({ course_id\u001b[33m:\u001b[39m \u001b[32m'00000000-0000-0000-0000-000000000123'\u001b[39m\u001b[33m,\u001b[39m title\u001b[33m:\u001b[39m \u001b[32m'T'\u001b[39m\u001b[33m,\u001b[39m body\u001b[33m:\u001b[39m \u001b[32m'B'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 20 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 21 |\u001b[39m     \u001b[90m// teacher ok\u001b[39m\n     \u001b[90m 22 |\u001b[39m     \u001b[90m// @ts-ignore\u001b[39m\n     \u001b[90m 23 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.announcements.spec.ts:20:24)\n\n  ● API /api/announcements (TEST_MODE) › DELETE: unauth 401; non-teacher 403; missing id 400; teacher 200\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 401\n    Received: 429\n\n    \u001b[0m \u001b[90m 41 |\u001b[39m   test(\u001b[32m'DELETE: unauth 401; non-teacher 403; missing id 400; teacher 200'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 42 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAnnDEL\u001b[39m \u001b[36mas\u001b[39m any)(del(\u001b[32m'http://localhost/api/announcements'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 43 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 44 |\u001b[39m     \u001b[90m// student forbidden\u001b[39m\n     \u001b[90m 45 |\u001b[39m     \u001b[90m// @ts-ignore\u001b[39m\n     \u001b[90m 46 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.announcements.spec.ts:43:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.announcements.spec.ts","startTime":1756202416549,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["PATCH /api/submissions grading validation"],"duration":3,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [200, 400]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [200, 400]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.submissions.grade.validation.spec.ts:15:24)"],"fullName":"PATCH /api/submissions grading validation missing score → 400; unknown keys tolerated","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"missing score → 400; unknown keys tolerated"}],"endTime":1756202416852,"message":"  ● PATCH /api/submissions grading validation › missing score → 400; unknown keys tolerated\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 429\n    Received array: [200, 400]\n\n    \u001b[0m \u001b[90m 13 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 14 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mSubsPATCH\u001b[39m \u001b[36mas\u001b[39m any)(patchJson(url\u001b[33m,\u001b[39m { score\u001b[33m:\u001b[39m \u001b[35m95\u001b[39m\u001b[33m,\u001b[39m extra\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m }\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 15 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m \u001b[35m400\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m \u001b[90m// schema discards extra\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 16 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 17 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 18 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.submissions.grade.validation.spec.ts:15:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.submissions.grade.validation.spec.ts","startTime":1756202416722,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["files AV stub and quota exceed"],"duration":4,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [400, 200]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [400, 200]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.av-and-quota.negatives.spec.ts:16:23)"],"fullName":"files AV stub and quota exceed EICAR-like content rejected","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"EICAR-like content rejected"}],"endTime":1756202417013,"message":"  ● files AV stub and quota exceed › EICAR-like content rejected\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 429\n    Received array: [400, 200]\n\n    \u001b[0m \u001b[90m 14 |\u001b[39m     \u001b[36mconst\u001b[39m id \u001b[33m=\u001b[39m encodeURIComponent(j\u001b[33m.\u001b[39mkey \u001b[33m||\u001b[39m \u001b[32m'k'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 15 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mUploadPUT\u001b[39m \u001b[36mas\u001b[39m any)(put(\u001b[32m`?owner_type=user&owner_id=u1&content_type=text/plain`\u001b[39m\u001b[33m,\u001b[39m \u001b[32m`X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*`\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 16 |\u001b[39m     expect([\u001b[35m400\u001b[39m\u001b[33m,\u001b[39m\u001b[35m200\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 17 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 18 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 19 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.files.av-and-quota.negatives.spec.ts:16:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.av-and-quota.negatives.spec.ts","startTime":1756202416855,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["x-request-id presence on error responses"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"x-request-id presence on error responses health 200 includes x-request-id","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"health 200 includes x-request-id"},{"ancestorTitles":["x-request-id presence on error responses"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"x-request-id presence on error responses messages POST unauthenticated 401 includes x-request-id","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"messages POST unauthenticated 401 includes x-request-id"},{"ancestorTitles":["x-request-id presence on error responses"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [401, 403]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [401, 403]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.requestId.headers.matrix.spec.ts:23:23)"],"fullName":"x-request-id presence on error responses runtime progress 403 when disabled includes x-request-id","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"runtime progress 403 when disabled includes x-request-id"}],"endTime":1756202417321,"message":"  ● x-request-id presence on error responses › runtime progress 403 when disabled includes x-request-id\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 429\n    Received array: [401, 403]\n\n    \u001b[0m \u001b[90m 21 |\u001b[39m     process\u001b[33m.\u001b[39menv \u001b[33m=\u001b[39m { \u001b[33m...\u001b[39moriginal\u001b[33m,\u001b[39m \u001b[33mRUNTIME_API_V2\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'0'\u001b[39m\u001b[33m,\u001b[39m \u001b[33mNEXT_RUNTIME_SECRET\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'dev-secret'\u001b[39m } \u001b[36mas\u001b[39m any\u001b[33m;\u001b[39m\n     \u001b[90m 22 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mProgressPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/progress'\u001b[39m\u001b[33m,\u001b[39m { pct\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 23 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 24 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'x-request-id'\u001b[39m))\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m 25 |\u001b[39m     process\u001b[33m.\u001b[39menv \u001b[33m=\u001b[39m original\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.requestId.headers.matrix.spec.ts:23:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.requestId.headers.matrix.spec.ts","startTime":1756202417024,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["PATCH /api/submissions grade"],"duration":5,"failureDetails":[{"matcherResult":{"actual":429,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.submissions.grade.spec.ts:15:24)"],"fullName":"PATCH /api/submissions grade teacher-only and validation envelope","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"teacher-only and validation envelope"}],"endTime":1756202417521,"message":"  ● PATCH /api/submissions grade › teacher-only and validation envelope\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 429\n\n    \u001b[0m \u001b[90m 13 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 14 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mSubmissionsPATCH\u001b[39m \u001b[36mas\u001b[39m any)(makeReq(url\u001b[33m,\u001b[39m { score\u001b[33m:\u001b[39m \u001b[35m90\u001b[39m }\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 15 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 16 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mSubmissionsPATCH\u001b[39m \u001b[36mas\u001b[39m any)(makeReq(url\u001b[33m,\u001b[39m { score\u001b[33m:\u001b[39m \u001b[32m'bad'\u001b[39m } \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m }))\u001b[33m;\u001b[39m\n     \u001b[90m 17 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 18 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.submissions.grade.spec.ts:15:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.submissions.grade.spec.ts","startTime":1756202417326,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime grade idempotency"],"duration":8,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 201, 204]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 201, 204]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.grade.idempotency.spec.ts:29:27)"],"fullName":"runtime grade idempotency duplicate grade request with same Idempotency-Key returns replayed 200","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"duplicate grade request with same Idempotency-Key returns replayed 200"}],"endTime":1756202417700,"message":"  ● runtime grade idempotency › duplicate grade request with same Idempotency-Key returns replayed 200\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 403\n    Received array: [200, 201, 204]\n\n    \u001b[0m \u001b[90m 27 |\u001b[39m     \u001b[36mconst\u001b[39m h \u001b[33m=\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m`Bearer ${token}`\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'Idempotency-Key'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'grade-dup-1'\u001b[39m } \u001b[36mas\u001b[39m \u001b[33mRecord\u001b[39m\u001b[33m<\u001b[39m\u001b[33mstring\u001b[39m\u001b[33m,\u001b[39mstring\u001b[33m>\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 28 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mGradePOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/grade'\u001b[39m\u001b[33m,\u001b[39m { score\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m max\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m passed\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m }\u001b[33m,\u001b[39m h))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 29 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m201\u001b[39m\u001b[33m,\u001b[39m\u001b[35m204\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                           \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 30 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mGradePOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/grade'\u001b[39m\u001b[33m,\u001b[39m { score\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m max\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m passed\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m }\u001b[33m,\u001b[39m h))\u001b[33m;\u001b[39m\n     \u001b[90m 31 |\u001b[39m     expect([\u001b[35m200\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m 32 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'idempotency-replayed'\u001b[39m))\u001b[33m.\u001b[39mtoBe(\u001b[32m'1'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.grade.idempotency.spec.ts:29:27)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.grade.idempotency.spec.ts","startTime":1756202417524,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime events rate-limit headers"],"duration":7,"failureDetails":[{"matcherResult":{"actual":403,"expected":429,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 429\nReceived: 403","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 429\nReceived: 403\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.events.ratelimit.spec.ts:32:24)"],"fullName":"runtime events rate-limit headers returns 429 with standard headers on rate limit","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"returns 429 with standard headers on rate limit"}],"endTime":1756202417889,"message":"  ● runtime events rate-limit headers › returns 429 with standard headers on rate limit\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 429\n    Received: 403\n\n    \u001b[0m \u001b[90m 30 |\u001b[39m     \u001b[36mconst\u001b[39m token \u001b[33m=\u001b[39m makeJwt([\u001b[32m'progress.write'\u001b[39m])\u001b[33m;\u001b[39m\n     \u001b[90m 31 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mEventsPOST\u001b[39m \u001b[36mas\u001b[39m any)(post({ type\u001b[33m:\u001b[39m \u001b[32m'course.progress'\u001b[39m\u001b[33m,\u001b[39m pct\u001b[33m:\u001b[39m \u001b[35m10\u001b[39m }\u001b[33m,\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m`Bearer ${token}`\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 32 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m429\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 33 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'retry-after'\u001b[39m))\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m 34 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'x-rate-limit-reset'\u001b[39m))\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m 35 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'x-rate-limit-remaining'\u001b[39m))\u001b[33m.\u001b[39mtoBe(\u001b[32m'0'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.events.ratelimit.spec.ts:32:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.events.ratelimit.spec.ts","startTime":1756202417705,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["GET /api/progress error paths"],"duration":4,"failureDetails":[{"matcherResult":{"actual":200,"expected":500,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 500\nReceived: 200","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 500\nReceived: 200\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.progress.errors.spec.ts:17:24)"],"fullName":"GET /api/progress error paths 500 when lessons query fails","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"500 when lessons query fails"},{"ancestorTitles":["GET /api/progress error paths"],"duration":1,"failureDetails":[{"matcherResult":{"actual":200,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 200","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 200\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.progress.errors.spec.ts:27:24)"],"fullName":"GET /api/progress error paths 403 for per_student when not teacher (non-test mode)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"403 for per_student when not teacher (non-test mode)"}],"endTime":1756202418108,"message":"  ● GET /api/progress error paths › 500 when lessons query fails\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 500\n    Received: 200\n\n    \u001b[0m \u001b[90m 15 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supabaseServer\u001b[33m,\u001b[39m \u001b[32m'getCurrentUserInRoute'\u001b[39m)\u001b[33m.\u001b[39mmockResolvedValue({ id\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m email\u001b[33m:\u001b[39m \u001b[32m't@example.com'\u001b[39m\u001b[33m,\u001b[39m user_metadata\u001b[33m:\u001b[39m { role\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m } } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 16 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mProgressGET\u001b[39m \u001b[36mas\u001b[39m any)(makeReq(\u001b[32m'http://localhost/api/progress?course_id=00000000-0000-0000-0000-000000000001'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 17 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m500\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 18 |\u001b[39m     \u001b[36mconst\u001b[39m json \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m res\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n     \u001b[90m 19 |\u001b[39m     expect(json\u001b[33m.\u001b[39merror\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcode)\u001b[33m.\u001b[39mtoBe(\u001b[32m'DB_ERROR'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 20 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.progress.errors.spec.ts:17:24)\n\n  ● GET /api/progress error paths › 403 for per_student when not teacher (non-test mode)\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 200\n\n    \u001b[0m \u001b[90m 25 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supabaseServer\u001b[33m,\u001b[39m \u001b[32m'getCurrentUserInRoute'\u001b[39m)\u001b[33m.\u001b[39mmockResolvedValue({ id\u001b[33m:\u001b[39m \u001b[32m'u2'\u001b[39m\u001b[33m,\u001b[39m email\u001b[33m:\u001b[39m \u001b[32m's@example.com'\u001b[39m\u001b[33m,\u001b[39m user_metadata\u001b[33m:\u001b[39m { role\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m } } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mProgressGET\u001b[39m \u001b[36mas\u001b[39m any)(makeReq(\u001b[32m'http://localhost/api/progress?course_id=00000000-0000-0000-0000-000000000001&per_student=1'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 27 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 28 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 29 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 30 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.progress.errors.spec.ts:27:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.progress.errors.spec.ts","startTime":1756202417906,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtimeAuth clock skew tolerance"],"duration":6,"failureDetails":[{"matcherResult":{"actual":false,"expected":true,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: true\nReceived: false","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: true\nReceived: false\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.runtimeAuth.clockskew.spec.ts:14:20)"],"fullName":"runtimeAuth clock skew tolerance accepts tokens within tolerance window (dev HS256 path mocked)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"accepts tokens within tolerance window (dev HS256 path mocked)"}],"endTime":1756202418241,"message":"  ● runtimeAuth clock skew tolerance › accepts tokens within tolerance window (dev HS256 path mocked)\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: true\n    Received: false\n\n    \u001b[0m \u001b[90m 12 |\u001b[39m     \u001b[36mconst\u001b[39m req \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/runtime/progress'\u001b[39m\u001b[33m,\u001b[39m { headers\u001b[33m:\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m'Bearer X'\u001b[39m\u001b[33m,\u001b[39m origin\u001b[33m:\u001b[39m \u001b[32m'https://wcgyhwvugdnzhegwiiam.lovable.app'\u001b[39m } \u001b[36mas\u001b[39m any } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 13 |\u001b[39m     \u001b[36mconst\u001b[39m out\u001b[33m:\u001b[39m any \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (verifyRuntimeAuthorization \u001b[36mas\u001b[39m any)(req \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m [\u001b[32m'progress.write'\u001b[39m])\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 14 |\u001b[39m     expect(out\u001b[33m.\u001b[39mok)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                    \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 15 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 16 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 17 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/lib.runtimeAuth.clockskew.spec.ts:14:20)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.runtimeAuth.clockskew.spec.ts","startTime":1756202418114,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["files round-trip"],"duration":5,"failureDetails":[{"matcherResult":{"actual":429,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.roundtrip.spec.ts:26:24)"],"fullName":"files round-trip upload-url → PUT bytes → download-url","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"upload-url → PUT bytes → download-url"}],"endTime":1756202418365,"message":"  ● files round-trip › upload-url → PUT bytes → download-url\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 429\n\n    \u001b[0m \u001b[90m 24 |\u001b[39m     \u001b[36mconst\u001b[39m blob \u001b[33m=\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mBlob\u001b[39m([\u001b[36mnew\u001b[39m \u001b[33mTextEncoder\u001b[39m()\u001b[33m.\u001b[39mencode(\u001b[32m'hello'\u001b[39m)]\u001b[33m,\u001b[39m { type\u001b[33m:\u001b[39m \u001b[32m'text/plain'\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 25 |\u001b[39m     \u001b[36mconst\u001b[39m put \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mUploadPUT\u001b[39m \u001b[36mas\u001b[39m any)(makePut(\u001b[32m`http://localhost${url}`\u001b[39m\u001b[33m,\u001b[39m blob\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 26 |\u001b[39m     expect(put\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 27 |\u001b[39m     \u001b[36mconst\u001b[39m { id\u001b[33m,\u001b[39m url\u001b[33m:\u001b[39m publicUrl } \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m put\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n     \u001b[90m 28 |\u001b[39m     expect(id)\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m 29 |\u001b[39m     \u001b[36mconst\u001b[39m dl \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mDownloadGET\u001b[39m \u001b[36mas\u001b[39m any)(makeGet(\u001b[32m`http://localhost/api/files/download-url?id=${encodeURIComponent(id)}`\u001b[39m\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m }))\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.files.roundtrip.spec.ts:26:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.roundtrip.spec.ts","startTime":1756202418245,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime outcomes accepts runtime token when no jwks"],"duration":2,"failureDetails":[{"matcherResult":{"actual":400,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 400","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 400\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.outcomes.runtime-token.spec.ts:34:24)"],"fullName":"runtime outcomes accepts runtime token when no jwks 403 when missing attempts.write scope; 201 when scope present","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"403 when missing attempts.write scope; 201 when scope present"}],"endTime":1756202418524,"message":"  ● runtime outcomes accepts runtime token when no jwks › 403 when missing attempts.write scope; 201 when scope present\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 400\n\n    \u001b[0m \u001b[90m 32 |\u001b[39m     \u001b[36mlet\u001b[39m token \u001b[33m=\u001b[39m makeHsToken({ sub\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m courseId\u001b[33m:\u001b[39m \u001b[32m'c1'\u001b[39m\u001b[33m,\u001b[39m scopes\u001b[33m:\u001b[39m []\u001b[33m,\u001b[39m iat\u001b[33m:\u001b[39m now\u001b[33m,\u001b[39m exp\u001b[33m:\u001b[39m now \u001b[33m+\u001b[39m \u001b[35m60\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 33 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mOutcomesPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/outcomes'\u001b[39m\u001b[33m,\u001b[39m { courseId\u001b[33m:\u001b[39m \u001b[32m'c1'\u001b[39m\u001b[33m,\u001b[39m userId\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m event\u001b[33m:\u001b[39m { type\u001b[33m:\u001b[39m \u001b[32m'attempt.completed'\u001b[39m\u001b[33m,\u001b[39m score\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m max\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m passed\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m } }\u001b[33m,\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m`Bearer ${token}`\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 34 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 35 |\u001b[39m     \u001b[90m// With attempts.write scope\u001b[39m\n     \u001b[90m 36 |\u001b[39m     token \u001b[33m=\u001b[39m makeHsToken({ sub\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m courseId\u001b[33m:\u001b[39m \u001b[32m'c1'\u001b[39m\u001b[33m,\u001b[39m scopes\u001b[33m:\u001b[39m [\u001b[32m'attempts.write'\u001b[39m]\u001b[33m,\u001b[39m iat\u001b[33m:\u001b[39m now\u001b[33m,\u001b[39m exp\u001b[33m:\u001b[39m now \u001b[33m+\u001b[39m \u001b[35m60\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 37 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mOutcomesPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/outcomes'\u001b[39m\u001b[33m,\u001b[39m { courseId\u001b[33m:\u001b[39m \u001b[32m'c1'\u001b[39m\u001b[33m,\u001b[39m userId\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m event\u001b[33m:\u001b[39m { type\u001b[33m:\u001b[39m \u001b[32m'attempt.completed'\u001b[39m\u001b[33m,\u001b[39m score\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m max\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m passed\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m } }\u001b[33m,\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m`Bearer ${token}`\u001b[39m }))\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.outcomes.runtime-token.spec.ts:34:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.outcomes.runtime-token.spec.ts","startTime":1756202418372,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["files download-url dev namespace guard"],"duration":1,"failureDetails":[{"matcherResult":{"actual":401,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 401","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 401\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.download-url.dev-namespace.guard.spec.ts:18:24)"],"fullName":"files download-url dev namespace guard 403 when object_key missing DEV_ID prefix in dev with DEV_ID set","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"403 when object_key missing DEV_ID prefix in dev with DEV_ID set"}],"endTime":1756202418685,"message":"  ● files download-url dev namespace guard › 403 when object_key missing DEV_ID prefix in dev with DEV_ID set\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 401\n\n    \u001b[0m \u001b[90m 16 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m \u001b[32m'getRouteHandlerSupabase'\u001b[39m)\u001b[33m.\u001b[39mmockReturnValue(mock)\u001b[33m;\u001b[39m\n     \u001b[90m 17 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mDownloadGET\u001b[39m \u001b[36mas\u001b[39m any)(\u001b[36mget\u001b[39m(\u001b[32m'http://localhost/api/files/download-url?id=someone_else/file.txt'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 18 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 19 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 20 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 21 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.files.download-url.dev-namespace.guard.spec.ts:18:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.download-url.dev-namespace.guard.spec.ts","startTime":1756202418530,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime outcomes strict iss/aud enforcement"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [401, 403]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [401, 403]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.outcomes.iss-aud.strict.spec.ts:11:23)"],"fullName":"runtime outcomes strict iss/aud enforcement issuer/audience mismatch against provider domain yields 403 (path exercise)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"issuer/audience mismatch against provider domain yields 403 (path exercise)"}],"endTime":1756202418816,"message":"  ● runtime outcomes strict iss/aud enforcement › issuer/audience mismatch against provider domain yields 403 (path exercise)\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 400\n    Received array: [401, 403]\n\n    \u001b[0m \u001b[90m  9 |\u001b[39m     \u001b[36mconst\u001b[39m body \u001b[33m=\u001b[39m { courseId\u001b[33m:\u001b[39m \u001b[32m'c1'\u001b[39m\u001b[33m,\u001b[39m userId\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m event\u001b[33m:\u001b[39m { type\u001b[33m:\u001b[39m \u001b[32m'progress'\u001b[39m\u001b[33m,\u001b[39m pct\u001b[33m:\u001b[39m \u001b[35m10\u001b[39m } }\u001b[33m;\u001b[39m\n     \u001b[90m 10 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mOutcomesPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(body\u001b[33m,\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m'Bearer bad.token.value'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 11 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 12 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 13 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 14 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.outcomes.iss-aud.strict.spec.ts:11:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.outcomes.iss-aud.strict.spec.ts","startTime":1756202418689,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["api.files.upload-url"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"api.files.upload-url requires auth","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"requires auth"},{"ancestorTitles":["api.files.upload-url"],"duration":0,"failureDetails":[{"matcherResult":{"actual":429,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.upload-url.spec.ts:20:24)"],"fullName":"api.files.upload-url returns signed fields in test-mode","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"returns signed fields in test-mode"}],"endTime":1756202418963,"message":"  ● api.files.upload-url › returns signed fields in test-mode\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 429\n\n    \u001b[0m \u001b[90m 18 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m.\u001b[39mcookies\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 19 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mUploadPOST\u001b[39m \u001b[36mas\u001b[39m any)(makeReq({ owner_type\u001b[33m:\u001b[39m \u001b[32m'user'\u001b[39m\u001b[33m,\u001b[39m owner_id\u001b[33m:\u001b[39m \u001b[32m'test-student-id'\u001b[39m\u001b[33m,\u001b[39m content_type\u001b[33m:\u001b[39m \u001b[32m'text/plain'\u001b[39m }\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 20 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 21 |\u001b[39m     \u001b[36mconst\u001b[39m json \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m res\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n     \u001b[90m 22 |\u001b[39m     expect(json\u001b[33m.\u001b[39murl)\u001b[33m.\u001b[39mtoContain(\u001b[32m'/api/files/upload-url'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 23 |\u001b[39m     expect(json\u001b[33m.\u001b[39mfields)\u001b[33m.\u001b[39mtoBeDefined()\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.files.upload-url.spec.ts:20:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.upload-url.spec.ts","startTime":1756202418819,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["withRouteTiming runtime CSRF skip"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"withRouteTiming runtime CSRF skip does not enforce same-origin for /api/runtime paths","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"does not enforce same-origin for /api/runtime paths"},{"ancestorTitles":["withRouteTiming skips CSRF on /api/runtime/*"],"duration":1,"failureDetails":[{"matcherResult":{"actual":403,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 403","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 403\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\server.withRouteTiming.runtime-csrf-skip.spec.ts:25:24)"],"fullName":"withRouteTiming skips CSRF on /api/runtime/* cross-origin POST to runtime path passes without same-origin or double-submit","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"cross-origin POST to runtime path passes without same-origin or double-submit"}],"endTime":1756202419120,"message":"  ● withRouteTiming skips CSRF on /api/runtime/* › cross-origin POST to runtime path passes without same-origin or double-submit\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 403\n\n    \u001b[0m \u001b[90m 23 |\u001b[39m     \u001b[36mconst\u001b[39m handler \u001b[33m=\u001b[39m withRouteTiming(\u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mResponse\u001b[39m(\u001b[33mJSON\u001b[39m\u001b[33m.\u001b[39mstringify({ ok\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m })\u001b[33m,\u001b[39m { status\u001b[33m:\u001b[39m \u001b[35m200\u001b[39m }))\u001b[33m;\u001b[39m\n     \u001b[90m 24 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (handler \u001b[36mas\u001b[39m any)(mkReq(\u001b[32m'http://localhost/api/runtime/progress'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'POST'\u001b[39m\u001b[33m,\u001b[39m { origin\u001b[33m:\u001b[39m \u001b[32m'http://evil.example'\u001b[39m\u001b[33m,\u001b[39m referer\u001b[33m:\u001b[39m \u001b[32m'http://evil.example/p'\u001b[39m }) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 25 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 26 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'x-request-id'\u001b[39m))\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m 27 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 28 |\u001b[39m })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/server.withRouteTiming.runtime-csrf-skip.spec.ts:25:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\server.withRouteTiming.runtime-csrf-skip.spec.ts","startTime":1756202418967,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Epic E: Messaging (MVP)"],"duration":18,"failureDetails":[],"failureMessages":[],"fullName":"Epic E: Messaging (MVP) creates a thread with participants and returns 201","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"creates a thread with participants and returns 201"},{"ancestorTitles":["Epic E: Messaging (MVP)"],"duration":3,"failureDetails":[{"matcherResult":{"actual":false,"expected":true,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: true\nReceived: false","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: true\nReceived: false\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.messaging.spec.ts:34:66)"],"fullName":"Epic E: Messaging (MVP) lists only threads for the current user with unread counts","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"lists only threads for the current user with unread counts"},{"ancestorTitles":["Epic E: Messaging (MVP)"],"duration":2,"failureDetails":[{"matcherResult":{"actual":429,"expected":201,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 201\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 201\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.messaging.spec.ts:48:28)"],"fullName":"Epic E: Messaging (MVP) sends a message into a thread and fans out notifications to participants","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"sends a message into a thread and fans out notifications to participants"},{"ancestorTitles":["Epic E: Messaging (MVP)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Epic E: Messaging (MVP) GET /api/messages without thread_id returns 400","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"GET /api/messages without thread_id returns 400"},{"ancestorTitles":["Epic E: Messaging (MVP)"],"duration":2,"failureDetails":[{"matcherResult":{"actual":429,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.messaging.spec.ts:75:29)"],"fullName":"Epic E: Messaging (MVP) marks message as read for the current user and updates unread badge","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"marks message as read for the current user and updates unread badge"},{"ancestorTitles":["Epic E: Messaging (MVP)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Epic E: Messaging (MVP) enforces permissions: unauthenticated yields 401","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"enforces permissions: unauthenticated yields 401"},{"ancestorTitles":["Epic E: Messaging (MVP)"],"duration":20,"failureDetails":[{"matcherResult":{"actual":429,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.messaging.spec.ts:109:26)"],"fullName":"Epic E: Messaging (MVP) PATCH /api/messages/threads/[id]/read-all zeroes unread for current user","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"PATCH /api/messages/threads/[id]/read-all zeroes unread for current user"},{"ancestorTitles":["Epic E: Messaging (MVP)"],"duration":8,"failureDetails":[{}],"failureMessages":["TypeError: rows.map is not a function\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.messaging.spec.ts:136:17)"],"fullName":"Epic E: Messaging (MVP) messages list sorted by created_at and unread increments after new message","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"messages list sorted by created_at and unread increments after new message"},{"ancestorTitles":["Epic E: Messaging (MVP)"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":400,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.messaging.spec.ts:146:24)"],"fullName":"Epic E: Messaging (MVP) PATCH /api/messages without id returns 400 and unknown id returns 404","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"PATCH /api/messages without id returns 400 and unknown id returns 404"},{"ancestorTitles":["Epic E: Messaging (MVP)"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"Epic E: Messaging (MVP) rate limits message sending from a single user (basic)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"todo","title":"rate limits message sending from a single user (basic)"}],"endTime":1756202419322,"message":"  ● Epic E: Messaging (MVP) › lists only threads for the current user with unread counts\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: true\n    Received: false\n\n    \u001b[0m \u001b[90m 32 |\u001b[39m     \u001b[36mconst\u001b[39m rows \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m res\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n     \u001b[90m 33 |\u001b[39m     expect(\u001b[33mArray\u001b[39m\u001b[33m.\u001b[39misArray(rows))\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 34 |\u001b[39m     expect(rows\u001b[33m.\u001b[39mevery((r\u001b[33m:\u001b[39m any) \u001b[33m=>\u001b[39m \u001b[36mtypeof\u001b[39m r\u001b[33m.\u001b[39munread \u001b[33m===\u001b[39m \u001b[32m'number'\u001b[39m))\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                                                                  \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 35 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 36 |\u001b[39m\n     \u001b[90m 37 |\u001b[39m   test(\u001b[32m'sends a message into a thread and fans out notifications to participants'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/future.messaging.spec.ts:34:66)\n\n  ● Epic E: Messaging (MVP) › sends a message into a thread and fans out notifications to participants\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 201\n    Received: 429\n\n    \u001b[0m \u001b[90m 46 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m.\u001b[39mcookies\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 47 |\u001b[39m     \u001b[36mconst\u001b[39m postRes \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m messages\u001b[33m.\u001b[39m\u001b[33mPOST\u001b[39m(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/messages'\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'POST'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m { \u001b[32m'content-type'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'application/json'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m }\u001b[33m,\u001b[39m body\u001b[33m:\u001b[39m \u001b[33mJSON\u001b[39m\u001b[33m.\u001b[39mstringify({ thread_id\u001b[33m:\u001b[39m thread\u001b[33m.\u001b[39mid\u001b[33m,\u001b[39m body\u001b[33m:\u001b[39m \u001b[32m'hello'\u001b[39m }) }) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 48 |\u001b[39m     expect(postRes\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m201\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                            \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 49 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 50 |\u001b[39m\n     \u001b[90m 51 |\u001b[39m   test(\u001b[32m'GET /api/messages without thread_id returns 400'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/future.messaging.spec.ts:48:28)\n\n  ● Epic E: Messaging (MVP) › marks message as read for the current user and updates unread badge\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 429\n\n    \u001b[0m \u001b[90m 73 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m.\u001b[39mcookies\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 74 |\u001b[39m     \u001b[36mconst\u001b[39m patchRes \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m messages\u001b[33m.\u001b[39m\u001b[33mPATCH\u001b[39m(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m`http://localhost/api/messages?id=${msg.id}`\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'PATCH'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m } }) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 75 |\u001b[39m     expect(patchRes\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                             \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 76 |\u001b[39m     \u001b[90m// @ts-ignore\u001b[39m\n     \u001b[90m 77 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m.\u001b[39mcookies\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 78 |\u001b[39m     \u001b[36mconst\u001b[39m listRes \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m threads\u001b[33m.\u001b[39m\u001b[33mGET\u001b[39m(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/messages/threads'\u001b[39m\u001b[33m,\u001b[39m { headers\u001b[33m:\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m } }) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/future.messaging.spec.ts:75:29)\n\n  ● Epic E: Messaging (MVP) › PATCH /api/messages/threads/[id]/read-all zeroes unread for current user\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 429\n\n    \u001b[0m \u001b[90m 107 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m.\u001b[39mcookies\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 108 |\u001b[39m     \u001b[36mconst\u001b[39m patch \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m readAll\u001b[33m.\u001b[39m\u001b[33mPATCH\u001b[39m(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m`http://localhost/api/messages/threads/${thread.id}/read-all`\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'PATCH'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m } }) \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m { params\u001b[33m:\u001b[39m { id\u001b[33m:\u001b[39m thread\u001b[33m.\u001b[39mid } } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 109 |\u001b[39m     expect(patch\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                          \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 110 |\u001b[39m     \u001b[36mconst\u001b[39m listRes \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m threads\u001b[33m.\u001b[39m\u001b[33mGET\u001b[39m(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/messages/threads'\u001b[39m\u001b[33m,\u001b[39m { headers\u001b[33m:\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m } }) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 111 |\u001b[39m     \u001b[36mconst\u001b[39m list \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m listRes\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n     \u001b[90m 112 |\u001b[39m     expect(list[\u001b[35m0\u001b[39m]\u001b[33m.\u001b[39munread)\u001b[33m.\u001b[39mtoBe(\u001b[35m0\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/future.messaging.spec.ts:109:26)\n\n  ● Epic E: Messaging (MVP) › messages list sorted by created_at and unread increments after new message\n\n    TypeError: rows.map is not a function\n\n    \u001b[0m \u001b[90m 134 |\u001b[39m     \u001b[36mconst\u001b[39m list \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m route\u001b[33m.\u001b[39m\u001b[33mGET\u001b[39m(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m`http://localhost/api/messages?thread_id=${thread.id}`\u001b[39m\u001b[33m,\u001b[39m { headers\u001b[33m:\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m } }) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 135 |\u001b[39m     \u001b[36mconst\u001b[39m rows \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m list\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 136 |\u001b[39m     expect(rows\u001b[33m.\u001b[39mmap((m\u001b[33m:\u001b[39m any) \u001b[33m=>\u001b[39m m\u001b[33m.\u001b[39mbody))\u001b[33m.\u001b[39mtoEqual([\u001b[32m'first'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'second'\u001b[39m])\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 137 |\u001b[39m     \u001b[90m// unread should be > 0 for student\u001b[39m\n     \u001b[90m 138 |\u001b[39m     \u001b[36mconst\u001b[39m listThreads \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m threads\u001b[33m.\u001b[39m\u001b[33mGET\u001b[39m(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/messages/threads'\u001b[39m\u001b[33m,\u001b[39m { headers\u001b[33m:\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m } }) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 139 |\u001b[39m     \u001b[36mconst\u001b[39m ts \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m listThreads\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/future.messaging.spec.ts:136:17)\n\n  ● Epic E: Messaging (MVP) › PATCH /api/messages without id returns 400 and unknown id returns 404\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 400\n    Received: 429\n\n    \u001b[0m \u001b[90m 144 |\u001b[39m     \u001b[36mconst\u001b[39m route \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m \u001b[36mimport\u001b[39m(\u001b[32m'../../apps/web/src/app/api/messages/route'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 145 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m route\u001b[33m.\u001b[39m\u001b[33mPATCH\u001b[39m(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/messages'\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'PATCH'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m } }) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 146 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 147 |\u001b[39m     \u001b[90m// unknown id (valid uuid) may be 404; in some test orders, synthetic ids could exist\u001b[39m\n     \u001b[90m 148 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m route\u001b[33m.\u001b[39m\u001b[33mPATCH\u001b[39m(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/messages?id=00000000-0000-0000-0000-000000000001'\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'PATCH'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m } }) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 149 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m404\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m \u001b[90m// may be 200 if synthetic id exists in prior tests\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/future.messaging.spec.ts:146:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.messaging.spec.ts","startTime":1756202419125,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/quiz-choices (TEST_MODE)"],"duration":4,"failureDetails":[{"matcherResult":{"actual":429,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.quiz-choices.spec.ts:19:24)"],"fullName":"API /api/quiz-choices (TEST_MODE) POST: unauth 401; non-teacher 403; invalid payload 400","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"POST: unauth 401; non-teacher 403; invalid payload 400"},{"ancestorTitles":["API /api/quiz-choices (TEST_MODE)"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"API /api/quiz-choices (TEST_MODE) GET: unauth 401; missing question_id 400; ok 200","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"GET: unauth 401; missing question_id 400; ok 200"}],"endTime":1756202419506,"message":"  ● API /api/quiz-choices (TEST_MODE) › POST: unauth 401; non-teacher 403; invalid payload 400\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 429\n\n    \u001b[0m \u001b[90m 17 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 18 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mQCPost\u001b[39m \u001b[36mas\u001b[39m any)(post({ question_id\u001b[33m:\u001b[39m \u001b[32m'00000000-0000-0000-0000-000000000321'\u001b[39m\u001b[33m,\u001b[39m text\u001b[33m:\u001b[39m \u001b[32m''\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 19 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 20 |\u001b[39m     \u001b[90m// teacher invalid payload -> 400 (text min)\u001b[39m\n     \u001b[90m 21 |\u001b[39m     \u001b[90m// @ts-ignore\u001b[39m\n     \u001b[90m 22 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.quiz-choices.spec.ts:19:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.quiz-choices.spec.ts","startTime":1756202419326,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["notifications read-all respects CSRF double-submit for non-GET"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"notifications read-all respects CSRF double-submit for non-GET PATCH requires matching csrf_token and x-csrf-token","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"PATCH requires matching csrf_token and x-csrf-token"},{"ancestorTitles":["notifications read-all respects CSRF double-submit for non-GET"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [200, 401]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [200, 401]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.notifications.read-all.csrf.spec.ts:28:23)"],"fullName":"notifications read-all respects CSRF double-submit for non-GET POST (HTML form fallback) delegates and enforces CSRF similarly","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"POST (HTML form fallback) delegates and enforces CSRF similarly"}],"endTime":1756202419692,"message":"  ● notifications read-all respects CSRF double-submit for non-GET › POST (HTML form fallback) delegates and enforces CSRF similarly\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 429\n    Received array: [200, 401]\n\n    \u001b[0m \u001b[90m 26 |\u001b[39m     expect([\u001b[35m400\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m 27 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mReadAllPOST\u001b[39m \u001b[36mas\u001b[39m any)(req(\u001b[32m'POST'\u001b[39m\u001b[33m,\u001b[39m { origin\u001b[33m:\u001b[39m \u001b[32m'http://localhost'\u001b[39m\u001b[33m,\u001b[39m referer\u001b[33m:\u001b[39m \u001b[32m'http://localhost/x'\u001b[39m\u001b[33m,\u001b[39m cookie\u001b[33m:\u001b[39m \u001b[32m'csrf_token=t'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'x-csrf-token'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m't'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 28 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m401\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 29 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 30 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 31 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.notifications.read-all.csrf.spec.ts:28:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.notifications.read-all.csrf.spec.ts","startTime":1756202419516,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime teacher outcomes list"],"duration":3,"failureDetails":[{"matcherResult":{"actual":401,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 401","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 401\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.teacher.outcomes.spec.ts:15:24)"],"fullName":"runtime teacher outcomes list 401 unauthenticated; 403 non-teacher; 200 for teacher with x-total-count","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"401 unauthenticated; 403 non-teacher; 200 for teacher with x-total-count"}],"endTime":1756202419921,"message":"  ● runtime teacher outcomes list › 401 unauthenticated; 403 non-teacher; 200 for teacher with x-total-count\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 401\n\n    \u001b[0m \u001b[90m 13 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m \u001b[32m'getCurrentUserInRoute'\u001b[39m)\u001b[33m.\u001b[39mmockResolvedValue({ id\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m user_metadata\u001b[33m:\u001b[39m { role\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m } } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 14 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mTeacherOutcomesGET\u001b[39m \u001b[36mas\u001b[39m any)(\u001b[36mget\u001b[39m(\u001b[32m'http://localhost/api/runtime/teacher/outcomes'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 15 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 16 |\u001b[39m\n     \u001b[90m 17 |\u001b[39m     \u001b[36mconst\u001b[39m mock \u001b[33m=\u001b[39m (supa \u001b[36mas\u001b[39m any)\u001b[33m.\u001b[39mmakeSupabaseMock({ courses\u001b[33m:\u001b[39m () \u001b[33m=>\u001b[39m supa\u001b[33m.\u001b[39msupabaseOk([{ id\u001b[33m:\u001b[39m \u001b[32m'c1'\u001b[39m }])\u001b[33m,\u001b[39m interactive_attempts\u001b[33m:\u001b[39m () \u001b[33m=>\u001b[39m supa\u001b[33m.\u001b[39msupabaseOk([{ id\u001b[33m:\u001b[39m \u001b[32m'ia1'\u001b[39m\u001b[33m,\u001b[39m course_id\u001b[33m:\u001b[39m \u001b[32m'c1'\u001b[39m }]) } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 18 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m \u001b[32m'getRouteHandlerSupabase'\u001b[39m)\u001b[33m.\u001b[39mmockReturnValue(mock)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.teacher.outcomes.spec.ts:15:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.teacher.outcomes.spec.ts","startTime":1756202419699,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["notifications preferences PATCH respects CSRF double-submit"],"duration":5,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 401\nReceived array: [200]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 401\nReceived array: [200]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.notifications.patch.csrf.spec.ts:19:19)"],"fullName":"notifications preferences PATCH respects CSRF double-submit 403 when tokens missing or mismatched; 200 when matched","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"403 when tokens missing or mismatched; 200 when matched"}],"endTime":1756202420132,"message":"  ● notifications preferences PATCH respects CSRF double-submit › 403 when tokens missing or mismatched; 200 when matched\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 401\n    Received array: [200]\n\n    \u001b[0m \u001b[90m 17 |\u001b[39m     \u001b[90m// Match -> 200\u001b[39m\n     \u001b[90m 18 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mNotifPrefsPATCH\u001b[39m \u001b[36mas\u001b[39m any)(patch({ origin\u001b[33m:\u001b[39m \u001b[32m'http://localhost'\u001b[39m\u001b[33m,\u001b[39m referer\u001b[33m:\u001b[39m \u001b[32m'http://localhost/p'\u001b[39m\u001b[33m,\u001b[39m cookie\u001b[33m:\u001b[39m \u001b[32m'csrf_token=t'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'x-csrf-token'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m't'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'content-type'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'application/json'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 19 |\u001b[39m     expect([\u001b[35m200\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 20 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 21 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 22 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.notifications.patch.csrf.spec.ts:19:19)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.notifications.patch.csrf.spec.ts","startTime":1756202419925,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/courses/[id]"],"duration":5,"failureDetails":[{"matcherResult":{"actual":429,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.courses.id.spec.ts:22:22)"],"fullName":"API /api/courses/[id] PATCH missing body → 400; non-teacher → 403; unknown id → 404; echoes x-request-id","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"PATCH missing body → 400; non-teacher → 403; unknown id → 404; echoes x-request-id"},{"ancestorTitles":["API /api/courses/[id]"],"duration":2,"failureDetails":[{"matcherResult":{"actual":429,"expected":401,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.courses.id.spec.ts:33:22)"],"fullName":"API /api/courses/[id] DELETE requires teacher; returns 401/403 accordingly","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"DELETE requires teacher; returns 401/403 accordingly"}],"endTime":1756202420366,"message":"  ● API /api/courses/[id] › PATCH missing body → 400; non-teacher → 403; unknown id → 404; echoes x-request-id\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 429\n\n    \u001b[0m \u001b[90m 20 |\u001b[39m \t\t\u001b[90m// non-teacher forbidden\u001b[39m\n     \u001b[90m 21 |\u001b[39m \t\tres \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mCoursePATCH\u001b[39m \u001b[36mas\u001b[39m any)(makePatch(\u001b[32m'http://localhost/api/courses/cccccccc-cccc-cccc-cccc-cccccccccccc'\u001b[39m\u001b[33m,\u001b[39m { title\u001b[33m:\u001b[39m \u001b[32m'New'\u001b[39m }\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m }) \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m { params\u001b[33m:\u001b[39m { id\u001b[33m:\u001b[39m \u001b[32m'cccccccc-cccc-cccc-cccc-cccccccccccc'\u001b[39m } } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 22 |\u001b[39m \t\texpect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m \t\t                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 23 |\u001b[39m \t\t\u001b[90m// teacher but unknown id → 404\u001b[39m\n     \u001b[90m 24 |\u001b[39m \t\tres \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mCoursePATCH\u001b[39m \u001b[36mas\u001b[39m any)(makePatch(\u001b[32m'http://localhost/api/courses/cccccccc-cccc-cccc-cccc-cccccccccccc'\u001b[39m\u001b[33m,\u001b[39m { title\u001b[33m:\u001b[39m \u001b[32m'New'\u001b[39m }\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'x-request-id'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'rq-test'\u001b[39m }) \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m { params\u001b[33m:\u001b[39m { id\u001b[33m:\u001b[39m \u001b[32m'cccccccc-cccc-cccc-cccc-cccccccccccc'\u001b[39m } } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 25 |\u001b[39m \t\texpect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m404\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.courses.id.spec.ts:22:22)\n\n  ● API /api/courses/[id] › DELETE requires teacher; returns 401/403 accordingly\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 401\n    Received: 429\n\n    \u001b[0m \u001b[90m 31 |\u001b[39m \t\tglobalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mclear\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m()\u001b[33m;\u001b[39m\n     \u001b[90m 32 |\u001b[39m \t\t\u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mCourseDELETE\u001b[39m \u001b[36mas\u001b[39m any)(makeDelete(\u001b[32m'http://localhost/api/courses/cccccccc-cccc-cccc-cccc-cccccccccccc'\u001b[39m) \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m { params\u001b[33m:\u001b[39m { id\u001b[33m:\u001b[39m \u001b[32m'cccccccc-cccc-cccc-cccc-cccccccccccc'\u001b[39m } } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 33 |\u001b[39m \t\texpect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m \t\t                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 34 |\u001b[39m \t\tres \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mCourseDELETE\u001b[39m \u001b[36mas\u001b[39m any)(makeDelete(\u001b[32m'http://localhost/api/courses/cccccccc-cccc-cccc-cccc-cccccccccccc'\u001b[39m\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m }) \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m { params\u001b[33m:\u001b[39m { id\u001b[33m:\u001b[39m \u001b[32m'cccccccc-cccc-cccc-cccc-cccccccccccc'\u001b[39m } } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 35 |\u001b[39m \t\texpect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 36 |\u001b[39m \t})\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.courses.id.spec.ts:33:22)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.courses.id.spec.ts","startTime":1756202420136,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Epic F: Notifications (MVP)"],"duration":60,"failureDetails":[],"failureMessages":[],"fullName":"Epic F: Notifications (MVP) lists notifications for the current user ordered newest first","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"lists notifications for the current user ordered newest first"},{"ancestorTitles":["Epic F: Notifications (MVP)"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"Epic F: Notifications (MVP) marks a single notification as read","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"marks a single notification as read"},{"ancestorTitles":["Epic F: Notifications (MVP)"],"duration":6,"failureDetails":[{"matcherResult":{"actual":429,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.notifications.spec.ts:44:24)"],"fullName":"Epic F: Notifications (MVP) marks all notifications as read","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"marks all notifications as read"},{"ancestorTitles":["Epic F: Notifications (MVP)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Epic F: Notifications (MVP) produces notification on grading a submission","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"produces notification on grading a submission"},{"ancestorTitles":["Epic F: Notifications (MVP)"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"Epic F: Notifications (MVP) produces notification for upcoming assignment due date (scheduled job)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"todo","title":"produces notification for upcoming assignment due date (scheduled job)"}],"endTime":1756202420621,"message":"  ● Epic F: Notifications (MVP) › marks all notifications as read\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 429\n\n    \u001b[0m \u001b[90m 42 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m.\u001b[39mcookies\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 43 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m mod\u001b[33m.\u001b[39m\u001b[33mPATCH\u001b[39m(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/notifications/read-all'\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'PATCH'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m } }) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 44 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 45 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 46 |\u001b[39m\n     \u001b[90m 47 |\u001b[39m   test(\u001b[32m'produces notification on grading a submission'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/future.notifications.spec.ts:44:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.notifications.spec.ts","startTime":1756202420376,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["GET /api/submissions pagination headers"],"duration":3,"failureDetails":[{"matcherResult":{"actual":403,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 403","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 403\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.submissions.list.pagination.spec.ts:14:24)"],"fullName":"GET /api/submissions pagination headers returns x-total-count and clamps limit to 200","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"returns x-total-count and clamps limit to 200"}],"endTime":1756202420846,"message":"  ● GET /api/submissions pagination headers › returns x-total-count and clamps limit to 200\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 403\n\n    \u001b[0m \u001b[90m 12 |\u001b[39m     (globalThis \u001b[36mas\u001b[39m any)\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m.\u001b[39mcookies\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 13 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mSubmissionsGET\u001b[39m \u001b[36mas\u001b[39m any)(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/submissions?assignment_id=00000000-0000-0000-0000-000000000001&offset=0&limit=999'\u001b[39m) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 14 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 15 |\u001b[39m     \u001b[36mconst\u001b[39m total \u001b[33m=\u001b[39m res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'x-total-count'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 16 |\u001b[39m     expect(\u001b[33mNumber\u001b[39m(total))\u001b[33m.\u001b[39mtoBeGreaterThanOrEqual(\u001b[35m0\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 17 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.submissions.list.pagination.spec.ts:14:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.submissions.list.pagination.spec.ts","startTime":1756202420626,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/parent/progress (TEST_MODE)"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"API /api/parent/progress (TEST_MODE) unauth → 401","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"unauth → 401"},{"ancestorTitles":["API /api/parent/progress (TEST_MODE)"],"duration":3,"failureDetails":[{"matcherResult":{"actual":403,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 403","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 403\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.parent.progress.api.spec.ts:17:24)"],"fullName":"API /api/parent/progress (TEST_MODE) parent linked to student gets data","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"parent linked to student gets data"}],"endTime":1756202421071,"message":"  ● API /api/parent/progress (TEST_MODE) › parent linked to student gets data\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 403\n\n    \u001b[0m \u001b[90m 15 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'parent'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 16 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mParentProgressGET\u001b[39m \u001b[36mas\u001b[39m any)(makeGet(\u001b[32m'http://localhost/api/parent/progress?student_id=22222222-2222-2222-2222-222222222222'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 17 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 18 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 19 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 20 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.parent.progress.api.spec.ts:17:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.parent.progress.api.spec.ts","startTime":1756202420852,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["PATCH /api/messages negatives"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [400, 404]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [400, 404]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.patch-negatives.spec.ts:17:23)"],"fullName":"PATCH /api/messages negatives missing id → 400; unknown id → 404","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"missing id → 400; unknown id → 404"}],"endTime":1756202421336,"message":"  ● PATCH /api/messages negatives › missing id → 400; unknown id → 404\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 429\n    Received array: [400, 404]\n\n    \u001b[0m \u001b[90m 15 |\u001b[39m     \u001b[90m// unknown id (valid uuid; tolerate 400 or 404 depending on state)\u001b[39m\n     \u001b[90m 16 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mMessagesPATCH\u001b[39m \u001b[36mas\u001b[39m any)(req(\u001b[32m'http://localhost/api/messages?id=00000000-0000-0000-0000-000000000001'\u001b[39m\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 17 |\u001b[39m     expect([\u001b[35m400\u001b[39m\u001b[33m,\u001b[39m\u001b[35m404\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 18 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 19 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 20 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.messages.patch-negatives.spec.ts:17:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.patch-negatives.spec.ts","startTime":1756202421079,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["notifications rate-limit headers"],"duration":3,"failureDetails":[{"matcherResult":{"actual":200,"expected":429,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 429\nReceived: 200","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 429\nReceived: 200\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.notifications.rate-limit.spec.ts:20:24)"],"fullName":"notifications rate-limit headers GET list returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"GET list returns 429 with standard headers when limited"},{"ancestorTitles":["notifications rate-limit headers"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"notifications rate-limit headers PATCH mark read returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"PATCH mark read returns 429 with standard headers when limited"}],"endTime":1756202421496,"message":"  ● notifications rate-limit headers › GET list returns 429 with standard headers when limited\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 429\n    Received: 200\n\n    \u001b[0m \u001b[90m 18 |\u001b[39m   test(\u001b[32m'GET list returns 429 with standard headers when limited'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 19 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mNotifGET\u001b[39m \u001b[36mas\u001b[39m any)(\u001b[36mget\u001b[39m(\u001b[32m'http://localhost/api/notifications'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 20 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m429\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 21 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'retry-after'\u001b[39m))\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m 22 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'x-rate-limit-remaining'\u001b[39m))\u001b[33m.\u001b[39mtoBe(\u001b[32m'0'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 23 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'x-rate-limit-reset'\u001b[39m))\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.notifications.rate-limit.spec.ts:20:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.notifications.rate-limit.spec.ts","startTime":1756202421341,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Runtime v2 hardening (audience + scopes + allowlists)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Runtime v2 hardening (audience + scopes + allowlists) audience binding enforced when origin allowed (missing token yields 401)","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"audience binding enforced when origin allowed (missing token yields 401)"},{"ancestorTitles":["Runtime v2 hardening (audience + scopes + allowlists)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Runtime v2 hardening (audience + scopes + allowlists) scope files.write required for asset sign-url (missing token path)","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"scope files.write required for asset sign-url (missing token path)"},{"ancestorTitles":["Runtime v2 hardening (audience + scopes + allowlists)"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [401, 403]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [401, 403]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.v2.security.spec.ts:36:24)"],"fullName":"Runtime v2 hardening (audience + scopes + allowlists) checkpoint size limit enforced (missing token path)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"checkpoint size limit enforced (missing token path)"}],"endTime":1756202421672,"message":"  ● Runtime v2 hardening (audience + scopes + allowlists) › checkpoint size limit enforced (missing token path)\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 429\n    Received array: [401, 403]\n\n    \u001b[0m \u001b[90m 34 |\u001b[39m     \u001b[36mconst\u001b[39m big \u001b[33m=\u001b[39m { key\u001b[33m:\u001b[39m \u001b[32m'k'\u001b[39m\u001b[33m,\u001b[39m state\u001b[33m:\u001b[39m { data\u001b[33m:\u001b[39m \u001b[32m'x'\u001b[39m\u001b[33m.\u001b[39mrepeat(\u001b[35m1024\u001b[39m) } }\u001b[33m;\u001b[39m\n     \u001b[90m 35 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mCheckpointSavePOST\u001b[39m \u001b[36mas\u001b[39m any)(jsonReq(\u001b[32m'http://localhost/api/runtime/checkpoint/save'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'POST'\u001b[39m\u001b[33m,\u001b[39m big))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 36 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m \u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 37 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 38 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 39 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.v2.security.spec.ts:36:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.v2.security.spec.ts","startTime":1756202421502,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/messages/threads/[id]/read-all"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"API /api/messages/threads/[id]/read-all unauth → 401 with x-request-id","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"unauth → 401 with x-request-id"},{"ancestorTitles":["API /api/messages/threads/[id]/read-all"],"duration":10,"failureDetails":[{"matcherResult":{"actual":429,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.read-all.spec.ts:26:24)"],"fullName":"API /api/messages/threads/[id]/read-all marks all messages as read for participant; non-participant remains unaffected (TEST_MODE)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"marks all messages as read for participant; non-participant remains unaffected (TEST_MODE)"}],"endTime":1756202421835,"message":"  ● API /api/messages/threads/[id]/read-all › marks all messages as read for participant; non-participant remains unaffected (TEST_MODE)\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 429\n\n    \u001b[0m \u001b[90m 24 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 25 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mReadAllPATCH\u001b[39m \u001b[36mas\u001b[39m any)(makePatch(\u001b[32m`http://localhost/api/messages/threads/${th.id}/read-all`\u001b[39m)\u001b[33m,\u001b[39m { params\u001b[33m:\u001b[39m { id\u001b[33m:\u001b[39m th\u001b[33m.\u001b[39mid } } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 26 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 27 |\u001b[39m     \u001b[36mconst\u001b[39m json \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m res\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n     \u001b[90m 28 |\u001b[39m     expect(json\u001b[33m.\u001b[39mok)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 29 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.messages.read-all.spec.ts:26:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.read-all.spec.ts","startTime":1756202421677,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["files negative cases"],"duration":3,"failureDetails":[{"matcherResult":{"actual":429,"expected":401,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.negatives.spec.ts:20:24)"],"fullName":"files negative cases upload-url PUT without auth → 401","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"upload-url PUT without auth → 401"},{"ancestorTitles":["files negative cases"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"files negative cases download-url missing id → 400; unknown id → 404","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"download-url missing id → 400; unknown id → 404"}],"endTime":1756202422016,"message":"  ● files negative cases › upload-url PUT without auth → 401\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 401\n    Received: 429\n\n    \u001b[0m \u001b[90m 18 |\u001b[39m     \u001b[36mconst\u001b[39m { url } \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m up\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n     \u001b[90m 19 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mUploadPUT\u001b[39m \u001b[36mas\u001b[39m any)(putUrl(\u001b[32m`http://localhost${url}`\u001b[39m\u001b[33m,\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mBlob\u001b[39m([\u001b[36mnew\u001b[39m \u001b[33mUint8Array\u001b[39m([\u001b[35m1\u001b[39m\u001b[33m,\u001b[39m\u001b[35m2\u001b[39m\u001b[33m,\u001b[39m\u001b[35m3\u001b[39m])]\u001b[33m,\u001b[39m { type\u001b[33m:\u001b[39m \u001b[32m'application/octet-stream'\u001b[39m })))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 20 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 21 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 22 |\u001b[39m\n     \u001b[90m 23 |\u001b[39m   test(\u001b[32m'download-url missing id → 400; unknown id → 404'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/api.files.negatives.spec.ts:20:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.negatives.spec.ts","startTime":1756202421842,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Admin audit logs API"],"duration":5,"failureDetails":[{"matcherResult":{"actual":500,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 500","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 500\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.admin.audit-logs.spec.ts:22:24)"],"fullName":"Admin audit logs API 401 unauthenticated; 403 non-admin; 200 admin","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"401 unauthenticated; 403 non-admin; 200 admin"},{"ancestorTitles":["Admin audit logs API"],"duration":2,"failureDetails":[{"matcherResult":{"actual":500,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 500","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 500\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.admin.audit-logs.spec.ts:32:24)"],"fullName":"Admin audit logs API limit clamped and DB error -> 500","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"limit clamped and DB error -> 500"}],"endTime":1756202422251,"message":"  ● Admin audit logs API › 401 unauthenticated; 403 non-admin; 200 admin\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 500\n\n    \u001b[0m \u001b[90m 20 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa\u001b[33m,\u001b[39m \u001b[32m'getRouteHandlerSupabase'\u001b[39m)\u001b[33m.\u001b[39mmockReturnValue(mock \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 21 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAuditGET\u001b[39m \u001b[36mas\u001b[39m any)(\u001b[36mget\u001b[39m(\u001b[32m'http://localhost/api/admin/audit-logs?limit=10'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 22 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 23 |\u001b[39m     \u001b[36mconst\u001b[39m body \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m res\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n     \u001b[90m 24 |\u001b[39m     expect(\u001b[33mArray\u001b[39m\u001b[33m.\u001b[39misArray(body))\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 25 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.admin.audit-logs.spec.ts:22:24)\n\n  ● Admin audit logs API › limit clamped and DB error -> 500\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 500\n\n    \u001b[0m \u001b[90m 30 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa\u001b[33m,\u001b[39m \u001b[32m'getRouteHandlerSupabase'\u001b[39m)\u001b[33m.\u001b[39mmockReturnValue(ok \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 31 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAuditGET\u001b[39m \u001b[36mas\u001b[39m any)(\u001b[36mget\u001b[39m(\u001b[32m'http://localhost/api/admin/audit-logs?limit=999999'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 32 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 33 |\u001b[39m\n     \u001b[90m 34 |\u001b[39m     \u001b[36mconst\u001b[39m err \u001b[33m=\u001b[39m makeSupabaseMock({ audit_logs\u001b[33m:\u001b[39m () \u001b[33m=>\u001b[39m supabaseError(\u001b[32m'boom'\u001b[39m) } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 35 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa\u001b[33m,\u001b[39m \u001b[32m'getRouteHandlerSupabase'\u001b[39m)\u001b[33m.\u001b[39mmockReturnValue(err \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.admin.audit-logs.spec.ts:32:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.admin.audit-logs.spec.ts","startTime":1756202422021,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["observability logs (services)"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: Cannot set properties of undefined (setting 'length')\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.observability.logs.spec.ts:25:16)\n    at Promise.then.completed (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"observability logs (services) dash_teacher_widgets and dash_student_widgets include ms","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"dash_teacher_widgets and dash_student_widgets include ms"},{"ancestorTitles":["observability logs (services)"],"duration":0,"failureDetails":[{}],"failureMessages":["TypeError: Cannot set properties of undefined (setting 'length')\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.observability.logs.spec.ts:34:16)\n    at Promise.then.completed (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"observability logs (services) progress_marked counter emitted on completion","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"progress_marked counter emitted on completion"}],"endTime":1756202422508,"message":"  ● observability logs (services) › dash_teacher_widgets and dash_student_widgets include ms\n\n    TypeError: Cannot set properties of undefined (setting 'length')\n\n    \u001b[0m \u001b[90m 23 |\u001b[39m   test(\u001b[32m'dash_teacher_widgets and dash_student_widgets include ms'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 24 |\u001b[39m     \u001b[36mconst\u001b[39m logs\u001b[33m:\u001b[39m any[] \u001b[33m=\u001b[39m (loggerMod \u001b[36mas\u001b[39m any)\u001b[33m.\u001b[39m__TEST_LOGS__\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 25 |\u001b[39m     logs\u001b[33m.\u001b[39mlength \u001b[33m=\u001b[39m \u001b[35m0\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 26 |\u001b[39m     \u001b[36mawait\u001b[39m dashboardSvc\u001b[33m.\u001b[39mgetDashboardForUser(\u001b[32m'test-teacher-id'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 27 |\u001b[39m     \u001b[36mawait\u001b[39m dashboardSvc\u001b[33m.\u001b[39mgetDashboardForUser(\u001b[32m'test-student-id'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 28 |\u001b[39m     expect(logs\u001b[33m.\u001b[39msome(l \u001b[33m=>\u001b[39m l\u001b[33m.\u001b[39mmsg \u001b[33m===\u001b[39m \u001b[32m'dash_teacher_widgets'\u001b[39m \u001b[33m&&\u001b[39m \u001b[36mtypeof\u001b[39m l\u001b[33m.\u001b[39mobj\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mms \u001b[33m===\u001b[39m \u001b[32m'number'\u001b[39m))\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/future.observability.logs.spec.ts:25:16)\n\n  ● observability logs (services) › progress_marked counter emitted on completion\n\n    TypeError: Cannot set properties of undefined (setting 'length')\n\n    \u001b[0m \u001b[90m 32 |\u001b[39m   test(\u001b[32m'progress_marked counter emitted on completion'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 33 |\u001b[39m     \u001b[36mconst\u001b[39m logs\u001b[33m:\u001b[39m any[] \u001b[33m=\u001b[39m (loggerMod \u001b[36mas\u001b[39m any)\u001b[33m.\u001b[39m__TEST_LOGS__\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 34 |\u001b[39m     logs\u001b[33m.\u001b[39mlength \u001b[33m=\u001b[39m \u001b[35m0\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 35 |\u001b[39m     \u001b[36mconst\u001b[39m out \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m progressSvc\u001b[33m.\u001b[39mmarkLessonComplete(\u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'00000000-0000-0000-0000-000000000001'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 36 |\u001b[39m     expect(out\u001b[33m.\u001b[39mlessonId)\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m 37 |\u001b[39m     expect(logs\u001b[33m.\u001b[39msome(l \u001b[33m=>\u001b[39m l\u001b[33m.\u001b[39mmsg \u001b[33m===\u001b[39m \u001b[32m'progress_marked'\u001b[39m \u001b[33m&&\u001b[39m \u001b[36mtypeof\u001b[39m l\u001b[33m.\u001b[39mobj\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mms \u001b[33m===\u001b[39m \u001b[32m'number'\u001b[39m))\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/future.observability.logs.spec.ts:34:16)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.observability.logs.spec.ts","startTime":1756202422266,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["reports endpoints headers and DTO-like responses"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"reports endpoints headers and DTO-like responses GET /api/reports/engagement returns x-request-id and JSON","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"GET /api/reports/engagement returns x-request-id and JSON"},{"ancestorTitles":["reports endpoints headers and DTO-like responses"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toBeTruthy()\n\nReceived: false","pass":false}}],"failureMessages":["Error: expect(received).toBeTruthy()\n\nReceived: false\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.reports.dto.spec.ts:22:37)"],"fullName":"reports endpoints headers and DTO-like responses GET /api/reports/grade-distribution CSV includes header and x-request-id","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"GET /api/reports/grade-distribution CSV includes header and x-request-id"}],"endTime":1756202422727,"message":"  ● reports endpoints headers and DTO-like responses › GET /api/reports/grade-distribution CSV includes header and x-request-id\n\n    expect(received).toBeTruthy()\n\n    Received: false\n\n    \u001b[0m \u001b[90m 20 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'x-request-id'\u001b[39m))\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m 21 |\u001b[39m     \u001b[36mconst\u001b[39m ct \u001b[33m=\u001b[39m res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'content-type'\u001b[39m) \u001b[33m||\u001b[39m \u001b[32m''\u001b[39m\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 22 |\u001b[39m     expect(ct\u001b[33m.\u001b[39mincludes(\u001b[32m'text/csv'\u001b[39m))\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 23 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 24 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 25 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.reports.dto.spec.ts:22:37)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.reports.dto.spec.ts","startTime":1756202422512,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["providers endpoints DTO + ratelimit headers"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"providers endpoints DTO + ratelimit headers GET /api/providers/health returns x-request-id and content-type","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"GET /api/providers/health returns x-request-id and content-type"},{"ancestorTitles":["providers endpoints DTO + ratelimit headers"],"duration":9,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 500\nReceived array: [200, 401, 403, 400]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 500\nReceived array: [200, 401, 403, 400]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.providers.dto-and-ratelimit.spec.ts:24:31)"],"fullName":"providers endpoints DTO + ratelimit headers rate limit headers present when throttled on provider PATCH","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"rate limit headers present when throttled on provider PATCH"}],"endTime":1756202422957,"message":"  ● providers endpoints DTO + ratelimit headers › rate limit headers present when throttled on provider PATCH\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 500\n    Received array: [200, 401, 403, 400]\n\n    \u001b[0m \u001b[90m 22 |\u001b[39m     \u001b[36mconst\u001b[39m url \u001b[33m=\u001b[39m \u001b[32m'http://localhost/api/providers?id=00000000-0000-0000-0000-000000000001'\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 23 |\u001b[39m     \u001b[36mconst\u001b[39m r1 \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mProvidersPATCH\u001b[39m \u001b[36mas\u001b[39m any)(patch(url\u001b[33m,\u001b[39m { name\u001b[33m:\u001b[39m \u001b[32m'x'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 24 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m\u001b[33m,\u001b[39m\u001b[35m400\u001b[39m])\u001b[33m.\u001b[39mtoContain(r1\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                               \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 25 |\u001b[39m     \u001b[36mconst\u001b[39m r2 \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mProvidersPATCH\u001b[39m \u001b[36mas\u001b[39m any)(patch(url\u001b[33m,\u001b[39m { name\u001b[33m:\u001b[39m \u001b[32m'y'\u001b[39m }))\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m     \u001b[36mif\u001b[39m (r2\u001b[33m.\u001b[39mstatus \u001b[33m===\u001b[39m \u001b[35m429\u001b[39m) {\n     \u001b[90m 27 |\u001b[39m       expect(r2\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'retry-after'\u001b[39m))\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.providers.dto-and-ratelimit.spec.ts:24:31)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.providers.dto-and-ratelimit.spec.ts","startTime":1756202422732,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["api.health requiredEnvs snapshot"],"duration":13,"failureDetails":[{"matcherResult":{"expected":true,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: true\nReceived: undefined","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: true\nReceived: undefined\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.health.requiredEnvs.spec.ts:21:55)"],"fullName":"api.health requiredEnvs snapshot includes Supabase keys and runtime keys when RUNTIME_API_V2=1","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"failed","title":"includes Supabase keys and runtime keys when RUNTIME_API_V2=1"}],"endTime":1756202423144,"message":"  ● api.health requiredEnvs snapshot › includes Supabase keys and runtime keys when RUNTIME_API_V2=1\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: true\n    Received: undefined\n\n    \u001b[0m \u001b[90m 19 |\u001b[39m     expect(json\u001b[33m.\u001b[39mrequiredEnvs\u001b[33m.\u001b[39m\u001b[33mNEXT_PUBLIC_SUPABASE_URL\u001b[39m)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 20 |\u001b[39m     expect(json\u001b[33m.\u001b[39mrequiredEnvs\u001b[33m.\u001b[39m\u001b[33mNEXT_PUBLIC_SUPABASE_ANON_KEY\u001b[39m)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 21 |\u001b[39m     expect(json\u001b[33m.\u001b[39mrequiredEnvs\u001b[33m.\u001b[39m\u001b[33mNEXT_RUNTIME_PUBLIC_KEY\u001b[39m)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                                                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 22 |\u001b[39m     expect(json\u001b[33m.\u001b[39mrequiredEnvs\u001b[33m.\u001b[39m\u001b[33mNEXT_RUNTIME_PRIVATE_KEY\u001b[39m)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 23 |\u001b[39m     expect(json\u001b[33m.\u001b[39mrequiredEnvs\u001b[33m.\u001b[39m\u001b[33mNEXT_RUNTIME_KEY_ID\u001b[39m)\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 24 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.health.requiredEnvs.spec.ts:21:55)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.health.requiredEnvs.spec.ts","startTime":1756202422963,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["providers health rate-limit headers"],"duration":5,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 404\nReceived array: [200, 401, 403]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 404\nReceived array: [200, 401, 403]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.providers.health.ratelimit.spec.ts:18:27)"],"fullName":"providers health rate-limit headers 429 includes retry-after and x-rate-limit-* headers","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"429 includes retry-after and x-rate-limit-* headers"}],"endTime":1756202423326,"message":"  ● providers health rate-limit headers › 429 includes retry-after and x-rate-limit-* headers\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 404\n    Received array: [200, 401, 403]\n\n    \u001b[0m \u001b[90m 16 |\u001b[39m     \u001b[36mconst\u001b[39m url \u001b[33m=\u001b[39m \u001b[32m'http://localhost/api/providers/health?id=00000000-0000-0000-0000-000000000001'\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 17 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mProvidersHealthGET\u001b[39m \u001b[36mas\u001b[39m any)(\u001b[36mget\u001b[39m(url))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 18 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                           \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 19 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mProvidersHealthGET\u001b[39m \u001b[36mas\u001b[39m any)(\u001b[36mget\u001b[39m(url))\u001b[33m;\u001b[39m\n     \u001b[90m 20 |\u001b[39m     \u001b[36mif\u001b[39m (res\u001b[33m.\u001b[39mstatus \u001b[33m===\u001b[39m \u001b[35m429\u001b[39m) {\n     \u001b[90m 21 |\u001b[39m       expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'retry-after'\u001b[39m))\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.providers.health.ratelimit.spec.ts:18:27)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.providers.health.ratelimit.spec.ts","startTime":1756202423149,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["testMode"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"testMode isTestMode true when TEST_MODE=1","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"isTestMode true when TEST_MODE=1"},{"ancestorTitles":["testMode"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"testMode isTestMode true when PLAYWRIGHT is set","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"isTestMode true when PLAYWRIGHT is set"},{"ancestorTitles":["testMode"],"duration":2,"failureDetails":[{"matcherResult":{"actual":true,"expected":false,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: true","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: false\nReceived: true\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.testMode.spec.ts:24:26)\n    at Promise.then.completed (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"testMode isTestMode false otherwise","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"isTestMode false otherwise"}],"endTime":1756202423464,"message":"  ● testMode › isTestMode false otherwise\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: false\n    Received: true\n\n    \u001b[0m \u001b[90m 22 |\u001b[39m     \u001b[36mdelete\u001b[39m (process\u001b[33m.\u001b[39menv \u001b[36mas\u001b[39m any)\u001b[33m.\u001b[39m\u001b[33mTEST_MODE\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 23 |\u001b[39m     \u001b[36mdelete\u001b[39m (process\u001b[33m.\u001b[39menv \u001b[36mas\u001b[39m any)\u001b[33m.\u001b[39m\u001b[33mPLAYWRIGHT\u001b[39m\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 24 |\u001b[39m     expect(isTestMode())\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                          \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 25 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 27 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/lib.testMode.spec.ts:24:26)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.testMode.spec.ts","startTime":1756202423332,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Event producers (TEST_MODE)"],"duration":26,"failureDetails":[{"matcherResult":{"message":"expect(received).toBeTruthy()\n\nReceived: undefined","pass":false}}],"failureMessages":["Error: expect(received).toBeTruthy()\n\nReceived: undefined\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.events.producers.spec.ts:11:16)"],"fullName":"Event producers (TEST_MODE) lesson complete records event","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"lesson complete records event"},{"ancestorTitles":["Event producers (TEST_MODE)"],"duration":8,"failureDetails":[{"matcherResult":{"message":"expect(received).toBeTruthy()\n\nReceived: undefined","pass":false}}],"failureMessages":["Error: expect(received).toBeTruthy()\n\nReceived: undefined\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.events.producers.spec.ts:19:22)"],"fullName":"Event producers (TEST_MODE) submission create and grade records events","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"submission create and grade records events"}],"endTime":1756202423685,"message":"  ● Event producers (TEST_MODE) › lesson complete records event\n\n    expect(received).toBeTruthy()\n\n    Received: undefined\n\n    \u001b[0m \u001b[90m  9 |\u001b[39m     \u001b[36mawait\u001b[39m markLessonComplete(\u001b[32m'22222222-2222-2222-2222-222222222222'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'aaaaaaaa-aaaa-aaaa-aaaa-000000000111'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 10 |\u001b[39m     \u001b[36mconst\u001b[39m ev \u001b[33m=\u001b[39m getInMemoryEvents()\u001b[33m.\u001b[39mfind(e \u001b[33m=>\u001b[39m e\u001b[33m.\u001b[39mevent_type \u001b[33m===\u001b[39m \u001b[32m'lesson.complete'\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 11 |\u001b[39m     expect(ev)\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 12 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 13 |\u001b[39m\n     \u001b[90m 14 |\u001b[39m   test(\u001b[32m'submission create and grade records events'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/api.events.producers.spec.ts:11:16)\n\n  ● Event producers (TEST_MODE) › submission create and grade records events\n\n    expect(received).toBeTruthy()\n\n    Received: undefined\n\n    \u001b[0m \u001b[90m 17 |\u001b[39m     \u001b[36mconst\u001b[39m sub \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m createSubmissionApi({ assignment_id\u001b[33m:\u001b[39m \u001b[32m'aaaaaaaa-aaaa-aaaa-aaaa-000000000222'\u001b[39m\u001b[33m,\u001b[39m text\u001b[33m:\u001b[39m \u001b[32m''\u001b[39m } \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m \u001b[32m'22222222-2222-2222-2222-222222222222'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 18 |\u001b[39m     \u001b[36mconst\u001b[39m createEv \u001b[33m=\u001b[39m getInMemoryEvents()\u001b[33m.\u001b[39mfind(e \u001b[33m=>\u001b[39m e\u001b[33m.\u001b[39mevent_type \u001b[33m===\u001b[39m \u001b[32m'assignment.submit'\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 19 |\u001b[39m     expect(createEv)\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                      \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 20 |\u001b[39m     \u001b[36mawait\u001b[39m gradeSubmissionApi(sub\u001b[33m.\u001b[39mid\u001b[33m,\u001b[39m { score\u001b[33m:\u001b[39m \u001b[35m95\u001b[39m }\u001b[33m,\u001b[39m \u001b[32m'11111111-1111-1111-1111-111111111111'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 21 |\u001b[39m     \u001b[36mconst\u001b[39m gradeEv \u001b[33m=\u001b[39m getInMemoryEvents()\u001b[33m.\u001b[39mfind(e \u001b[33m=>\u001b[39m e\u001b[33m.\u001b[39mevent_type \u001b[33m===\u001b[39m \u001b[32m'assignment.graded'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 22 |\u001b[39m     expect(gradeEv)\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.events.producers.spec.ts:19:22)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.events.producers.spec.ts","startTime":1756202423470,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Events API behavior"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"Events API behavior GET returns [] in prod (TEST_MODE unset)","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"GET returns [] in prod (TEST_MODE unset)"},{"ancestorTitles":["Events API behavior"],"duration":3,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [201, 204]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [201, 204]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.events.behavior.spec.ts:24:23)"],"fullName":"Events API behavior test-mode: POST 201 and GET lists event; 401 unauth","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"test-mode: POST 201 and GET lists event; 401 unauth"}],"endTime":1756202423871,"message":"  ● Events API behavior › test-mode: POST 201 and GET lists event; 401 unauth\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 429\n    Received array: [201, 204]\n\n    \u001b[0m \u001b[90m 22 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa\u001b[33m,\u001b[39m \u001b[32m'getCurrentUserInRoute'\u001b[39m)\u001b[33m.\u001b[39mmockResolvedValue({ id\u001b[33m:\u001b[39m \u001b[32m'u'\u001b[39m\u001b[33m,\u001b[39m user_metadata\u001b[33m:\u001b[39m { role\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m } } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 23 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mEventsPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/events'\u001b[39m\u001b[33m,\u001b[39m { event_type\u001b[33m:\u001b[39m \u001b[32m'x'\u001b[39m\u001b[33m,\u001b[39m entity_type\u001b[33m:\u001b[39m \u001b[32m'y'\u001b[39m\u001b[33m,\u001b[39m entity_id\u001b[33m:\u001b[39m \u001b[32m'e1'\u001b[39m\u001b[33m,\u001b[39m meta\u001b[33m:\u001b[39m {} }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 24 |\u001b[39m     expect([\u001b[35m201\u001b[39m\u001b[33m,\u001b[39m\u001b[35m204\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m \u001b[90m// test-mode -> 201\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 25 |\u001b[39m     \u001b[36mconst\u001b[39m list \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mEventsGET\u001b[39m \u001b[36mas\u001b[39m any)(\u001b[36mget\u001b[39m(\u001b[32m'http://localhost/api/events'\u001b[39m))\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m     expect(list\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 27 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.events.behavior.spec.ts:24:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.events.behavior.spec.ts","startTime":1756202423690,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["metrics in-flight tracking"],"duration":2,"failureDetails":[{"matcherResult":{"actual":0,"expected":2,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 2\nReceived: 0","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 2\nReceived: 0\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.metrics.inflight.spec.ts:11:41)\n    at Promise.then.completed (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\utils.js:231:10)\n    at _callCircusTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:316:40)\n    at _runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:252:3)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:126:9)\n    at _runTestsForDescribeBlock (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:121:9)\n    at run (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\run.js:71:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapterInit.js:122:21)\n    at jestAdapter (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-circus\\build\\legacy-code-todo-rewrite\\jestAdapter.js:79:19)\n    at runTestInternal (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:367:16)\n    at runTest (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\jest-runner\\build\\runTest.js:444:34)"],"fullName":"metrics in-flight tracking increments and decrements per route","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"increments and decrements per route"}],"endTime":1756202424022,"message":"  ● metrics in-flight tracking › increments and decrements per route\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 2\n    Received: 0\n\n    \u001b[0m \u001b[90m  9 |\u001b[39m     incrInFlight(route)\u001b[33m;\u001b[39m\n     \u001b[90m 10 |\u001b[39m     \u001b[36mlet\u001b[39m s1 \u001b[33m=\u001b[39m snapshot()\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 11 |\u001b[39m     expect((s1[route]\u001b[33m?\u001b[39m\u001b[33m.\u001b[39min_flight \u001b[33m||\u001b[39m \u001b[35m0\u001b[39m))\u001b[33m.\u001b[39mtoBe(before \u001b[33m+\u001b[39m \u001b[35m2\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                                         \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 12 |\u001b[39m     decrInFlight(route)\u001b[33m;\u001b[39m\n     \u001b[90m 13 |\u001b[39m     decrInFlight(route)\u001b[33m;\u001b[39m\n     \u001b[90m 14 |\u001b[39m     s1 \u001b[33m=\u001b[39m snapshot()\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/lib.metrics.inflight.spec.ts:11:41)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.metrics.inflight.spec.ts","startTime":1756202423877,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime grade rate-limit headers"],"duration":6,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 201]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 201]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.grade.ratelimit.spec.ts:27:23)"],"fullName":"runtime grade rate-limit headers returns 201 first, then 429 with standard headers","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"returns 201 first, then 429 with standard headers"}],"endTime":1756202424180,"message":"  ● runtime grade rate-limit headers › returns 201 first, then 429 with standard headers\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 403\n    Received array: [200, 201]\n\n    \u001b[0m \u001b[90m 25 |\u001b[39m     \u001b[36mconst\u001b[39m h \u001b[33m=\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m`Bearer ${token}`\u001b[39m }\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mGradePOST\u001b[39m \u001b[36mas\u001b[39m any)(post({ runtimeAttemptId\u001b[33m:\u001b[39m \u001b[32m'ra1'\u001b[39m\u001b[33m,\u001b[39m score\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m max\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m passed\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m }\u001b[33m,\u001b[39m h))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 27 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m201\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 28 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mGradePOST\u001b[39m \u001b[36mas\u001b[39m any)(post({ runtimeAttemptId\u001b[33m:\u001b[39m \u001b[32m'ra2'\u001b[39m\u001b[33m,\u001b[39m score\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m max\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m passed\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m }\u001b[33m,\u001b[39m h))\u001b[33m;\u001b[39m\n     \u001b[90m 29 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m429\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 30 |\u001b[39m     expect(res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'retry-after'\u001b[39m))\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.grade.ratelimit.spec.ts:27:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.grade.ratelimit.spec.ts","startTime":1756202424026,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Epic H: Files and Media"],"duration":12,"failureDetails":[{"matcherResult":{"actual":500,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 500","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 500\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.files.spec.ts:8:24)"],"fullName":"Epic H: Files and Media issues an upload URL for a given owner and content type","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"issues an upload URL for a given owner and content type"},{"ancestorTitles":["Epic H: Files and Media"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.files.spec.ts:19:24)"],"fullName":"Epic H: Files and Media accepts PUT upload and returns a public download URL, then serves bytes","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"accepts PUT upload and returns a public download URL, then serves bytes"},{"ancestorTitles":["Epic H: Files and Media"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":401,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.files.spec.ts:36:33)"],"fullName":"Epic H: Files and Media enforces auth on upload and download routes","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"enforces auth on upload and download routes"},{"ancestorTitles":["Epic H: Files and Media"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"Epic H: Files and Media download-url requires id: returns 400 when missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"download-url requires id: returns 400 when missing"}],"endTime":1756202424309,"message":"  ● Epic H: Files and Media › issues an upload URL for a given owner and content type\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 500\n\n    \u001b[0m \u001b[90m  6 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m.\u001b[39mcookies\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m  7 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m mod\u001b[33m.\u001b[39m\u001b[33mPOST\u001b[39m(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/files/upload-url'\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'POST'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m { \u001b[32m'content-type'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'application/json'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m }\u001b[33m,\u001b[39m body\u001b[33m:\u001b[39m \u001b[33mJSON\u001b[39m\u001b[33m.\u001b[39mstringify({ owner_type\u001b[33m:\u001b[39m \u001b[32m'assignment'\u001b[39m\u001b[33m,\u001b[39m owner_id\u001b[33m:\u001b[39m \u001b[32m'a1'\u001b[39m\u001b[33m,\u001b[39m content_type\u001b[33m:\u001b[39m \u001b[32m'text/plain'\u001b[39m }) }) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m  8 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m  9 |\u001b[39m     \u001b[36mconst\u001b[39m json \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m res\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n     \u001b[90m 10 |\u001b[39m     expect(json\u001b[33m.\u001b[39murl)\u001b[33m.\u001b[39mtoContain(\u001b[32m'/api/files/upload-url'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 11 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/future.files.spec.ts:8:24)\n\n  ● Epic H: Files and Media › accepts PUT upload and returns a public download URL, then serves bytes\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 429\n\n    \u001b[0m \u001b[90m 17 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m.\u001b[39mcookies\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 18 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m mod\u001b[33m.\u001b[39m\u001b[33mPUT\u001b[39m(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/files/upload-url?owner_type=assignment&owner_id=a1&content_type=text/plain'\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'PUT'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m }\u001b[33m,\u001b[39m body\u001b[33m:\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mTextEncoder\u001b[39m()\u001b[33m.\u001b[39mencode(\u001b[32m'hello'\u001b[39m) }) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 19 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 20 |\u001b[39m     \u001b[36mconst\u001b[39m { id\u001b[33m,\u001b[39m url } \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m res\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n     \u001b[90m 21 |\u001b[39m     expect(id)\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m 22 |\u001b[39m     \u001b[36mconst\u001b[39m dl \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m \u001b[36mimport\u001b[39m(\u001b[32m'../../apps/web/src/app/api/files/download-url/route'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/future.files.spec.ts:19:24)\n\n  ● Epic H: Files and Media › enforces auth on upload and download routes\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 401\n    Received: 429\n\n    \u001b[0m \u001b[90m 34 |\u001b[39m     \u001b[36mconst\u001b[39m up \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m \u001b[36mimport\u001b[39m(\u001b[32m'../../apps/web/src/app/api/files/upload-url/route'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 35 |\u001b[39m     \u001b[36mconst\u001b[39m noAuthUpload \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m up\u001b[33m.\u001b[39m\u001b[33mPOST\u001b[39m(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/files/upload-url'\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'POST'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m { \u001b[32m'content-type'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'application/json'\u001b[39m }\u001b[33m,\u001b[39m body\u001b[33m:\u001b[39m \u001b[33mJSON\u001b[39m\u001b[33m.\u001b[39mstringify({ owner_type\u001b[33m:\u001b[39m \u001b[32m'assignment'\u001b[39m\u001b[33m,\u001b[39m owner_id\u001b[33m:\u001b[39m \u001b[32m'a1'\u001b[39m }) }) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 36 |\u001b[39m     expect(noAuthUpload\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 37 |\u001b[39m     \u001b[36mconst\u001b[39m dl \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m \u001b[36mimport\u001b[39m(\u001b[32m'../../apps/web/src/app/api/files/download-url/route'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 38 |\u001b[39m     \u001b[36mconst\u001b[39m noAuthDownload \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m dl\u001b[33m.\u001b[39m\u001b[33mGET\u001b[39m(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/files/download-url?id=x'\u001b[39m) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 39 |\u001b[39m     expect(noAuthDownload\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/future.files.spec.ts:36:33)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.files.spec.ts","startTime":1756202424186,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["messages read-all by thread id"],"duration":3,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 500\nReceived array: [200, 401]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 500\nReceived array: [200, 401]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.read-all-thread.spec.ts:12:23)"],"fullName":"messages read-all by thread id student marks thread as read in test-mode","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"student marks thread as read in test-mode"}],"endTime":1756202424459,"message":"  ● messages read-all by thread id › student marks thread as read in test-mode\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 500\n    Received array: [200, 401]\n\n    \u001b[0m \u001b[90m 10 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 11 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mReadAllThreadPATCH\u001b[39m \u001b[36mas\u001b[39m any)(patch(\u001b[32m'http://localhost/api/messages/threads/11111111-1111-1111-1111-111111111111/read-all'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 12 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m401\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 13 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 14 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 15 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.messages.read-all-thread.spec.ts:12:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.read-all-thread.spec.ts","startTime":1756202424312,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Lessons complete API"],"duration":34,"failureDetails":[{"matcherResult":{"actual":429,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.lessons-complete.spec.ts:12:24)"],"fullName":"Lessons complete API enforces student role and returns latest completion marker","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"enforces student role and returns latest completion marker"}],"endTime":1756202424636,"message":"  ● Lessons complete API › enforces student role and returns latest completion marker\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 429\n\n    \u001b[0m \u001b[90m 10 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m.\u001b[39mcookies\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 11 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m route\u001b[33m.\u001b[39m\u001b[33mPOST\u001b[39m(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/lessons/complete'\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'POST'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m:\u001b[39m { \u001b[32m'content-type'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'application/json'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m }\u001b[33m,\u001b[39m body\u001b[33m:\u001b[39m \u001b[33mJSON\u001b[39m\u001b[33m.\u001b[39mstringify({ lessonId\u001b[33m:\u001b[39m \u001b[32m'00000000-0000-0000-0000-000000000001'\u001b[39m }) }) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 12 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 13 |\u001b[39m     \u001b[90m// student -> ok\u001b[39m\n     \u001b[90m 14 |\u001b[39m     \u001b[90m// @ts-ignore\u001b[39m\n     \u001b[90m 15 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m.\u001b[39mcookies\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.lessons-complete.spec.ts:12:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.lessons-complete.spec.ts","startTime":1756202424462,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Files attachments API"],"duration":3,"failureDetails":[{"matcherResult":{"actual":429,"expected":401,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 401\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.attachments.spec.ts:15:24)"],"fullName":"Files attachments API 400 missing key; 401 unauth","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"400 missing key; 401 unauth"},{"ancestorTitles":["Files attachments API"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.attachments.spec.ts:29:24)"],"fullName":"Files attachments API owner can delete; POST _method=DELETE delegates","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"owner can delete; POST _method=DELETE delegates"}],"endTime":1756202424842,"message":"  ● Files attachments API › 400 missing key; 401 unauth\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 401\n    Received: 429\n\n    \u001b[0m \u001b[90m 13 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 14 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAttDelete\u001b[39m \u001b[36mas\u001b[39m any)(del(\u001b[32m'http://localhost/api/files/attachment?key=x'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 15 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m401\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 16 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 17 |\u001b[39m\n     \u001b[90m 18 |\u001b[39m   test(\u001b[32m'owner can delete; POST _method=DELETE delegates'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/api.files.attachments.spec.ts:15:24)\n\n  ● Files attachments API › owner can delete; POST _method=DELETE delegates\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 429\n\n    \u001b[0m \u001b[90m 27 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa\u001b[33m,\u001b[39m \u001b[32m'getRouteHandlerSupabase'\u001b[39m)\u001b[33m.\u001b[39mmockReturnValue(mock \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 28 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAttDelete\u001b[39m \u001b[36mas\u001b[39m any)(del(\u001b[32m'http://localhost/api/files/attachment?key=k1'\u001b[39m\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 29 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 30 |\u001b[39m     \u001b[90m// POST delegate without headers should 400 (CSRF and/or auth)\u001b[39m\n     \u001b[90m 31 |\u001b[39m     \u001b[36mconst\u001b[39m resBad \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAttPost\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/files/attachment?_method=DELETE&key=k2'\u001b[39m))\u001b[33m;\u001b[39m\n     \u001b[90m 32 |\u001b[39m     expect([\u001b[35m400\u001b[39m\u001b[33m,\u001b[39m\u001b[35m401\u001b[39m])\u001b[33m.\u001b[39mtoContain(resBad\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.files.attachments.spec.ts:29:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.attachments.spec.ts","startTime":1756202424641,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["middleware CSP connect-src allowlist propagation"],"duration":4,"failureDetails":[{"matcherResult":{"message":"expect(received).toMatch(expected)\n\nExpected pattern: /connect-src [^;]*https:\\/\\/api\\.provider1/\nReceived string:  \"\"","pass":false}}],"failureMessages":["Error: expect(received).toMatch(expected)\n\nExpected pattern: /connect-src [^;]*https:\\/\\/api\\.provider1/\nReceived string:  \"\"\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\middleware.cors.disallowed-origin.spec.ts:35:17)"],"fullName":"middleware CSP connect-src allowlist propagation includes origins from RUNTIME_CORS_ALLOW in CSP via guard path","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"includes origins from RUNTIME_CORS_ALLOW in CSP via guard path"},{"ancestorTitles":["middleware CORS disallowed origin"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"middleware CORS disallowed origin no allow-origin headers when origin disallowed","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"no allow-origin headers when origin disallowed"}],"endTime":1756202425033,"message":"  ● middleware CSP connect-src allowlist propagation › includes origins from RUNTIME_CORS_ALLOW in CSP via guard path\n\n    expect(received).toMatch(expected)\n\n    Expected pattern: /connect-src [^;]*https:\\/\\/api\\.provider1/\n    Received string:  \"\"\n\n    \u001b[0m \u001b[90m 33 |\u001b[39m     \u001b[36mconst\u001b[39m res\u001b[33m:\u001b[39m any \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (middleware \u001b[36mas\u001b[39m any)(makeReq(\u001b[32m'http://localhost/api/health'\u001b[39m))\u001b[33m;\u001b[39m\n     \u001b[90m 34 |\u001b[39m     \u001b[36mconst\u001b[39m csp \u001b[33m=\u001b[39m res\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'Content-Security-Policy'\u001b[39m) \u001b[33m||\u001b[39m \u001b[32m''\u001b[39m\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 35 |\u001b[39m     expect(csp)\u001b[33m.\u001b[39mtoMatch(\u001b[35m/connect-src [^;]*https:\\/\\/api\\.provider1/\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 36 |\u001b[39m     expect(csp)\u001b[33m.\u001b[39mtoMatch(\u001b[35m/connect-src [^;]*https:\\/\\/api\\.provider2/\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 37 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 38 |\u001b[39m })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/middleware.cors.disallowed-origin.spec.ts:35:17)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\middleware.cors.disallowed-origin.spec.ts","startTime":1756202424854,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/modules"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"API /api/modules GET requires course_id → 400","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"GET requires course_id → 400"},{"ancestorTitles":["API /api/modules"],"duration":4,"failureDetails":[{"matcherResult":{"actual":429,"expected":400,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.modules.spec.ts:21:30)"],"fullName":"API /api/modules PATCH missing id → 400; empty body → 400","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"PATCH missing id → 400; empty body → 400"},{"ancestorTitles":["API /api/modules"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":400,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.modules.spec.ts:28:28)"],"fullName":"API /api/modules DELETE missing id → 400; non-teacher → 403","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"DELETE missing id → 400; non-teacher → 403"}],"endTime":1756202425386,"message":"  ● API /api/modules › PATCH missing id → 400; empty body → 400\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 400\n    Received: 429\n\n    \u001b[0m \u001b[90m 19 |\u001b[39m     expect(missingId\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 20 |\u001b[39m     \u001b[36mconst\u001b[39m emptyBody \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mModulesPATCH\u001b[39m \u001b[36mas\u001b[39m any)(makePatch(\u001b[32m'http://localhost/api/modules?id=mm'\u001b[39m\u001b[33m,\u001b[39m {}))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 21 |\u001b[39m     expect(emptyBody\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                              \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 22 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 23 |\u001b[39m\n     \u001b[90m 24 |\u001b[39m   test(\u001b[32m'DELETE missing id → 400; non-teacher → 403'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/api.modules.spec.ts:21:30)\n\n  ● API /api/modules › DELETE missing id → 400; non-teacher → 403\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 400\n    Received: 429\n\n    \u001b[0m \u001b[90m 26 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 27 |\u001b[39m     \u001b[36mconst\u001b[39m missing \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mModulesDELETE\u001b[39m \u001b[36mas\u001b[39m any)(makeDelete(\u001b[32m'http://localhost/api/modules'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 28 |\u001b[39m     expect(missing\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                            \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 29 |\u001b[39m     \u001b[90m// @ts-ignore\u001b[39m\n     \u001b[90m 30 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 31 |\u001b[39m     \u001b[36mconst\u001b[39m forbidden \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mModulesDELETE\u001b[39m \u001b[36mas\u001b[39m any)(makeDelete(\u001b[32m'http://localhost/api/modules?id=mm'\u001b[39m))\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.modules.spec.ts:28:28)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.modules.spec.ts","startTime":1756202425037,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["assignments POST CSRF double-submit"],"duration":6,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [200, 201]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [200, 201]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.assignments.post.csrf.spec.ts:28:23)"],"fullName":"assignments POST CSRF double-submit 403 missing/mismatched tokens; 201 when matched","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"403 missing/mismatched tokens; 201 when matched"}],"endTime":1756202425636,"message":"  ● assignments POST CSRF double-submit › 403 missing/mismatched tokens; 201 when matched\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 400\n    Received array: [200, 201]\n\n    \u001b[0m \u001b[90m 26 |\u001b[39m     \u001b[90m// Match\u001b[39m\n     \u001b[90m 27 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAssignmentsPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(payload\u001b[33m,\u001b[39m { origin\u001b[33m:\u001b[39m \u001b[32m'http://localhost'\u001b[39m\u001b[33m,\u001b[39m referer\u001b[33m:\u001b[39m \u001b[32m'http://localhost/x'\u001b[39m\u001b[33m,\u001b[39m cookie\u001b[33m:\u001b[39m \u001b[32m'csrf_token=t'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'x-csrf-token'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m't'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 28 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m201\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 29 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 30 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 31 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.assignments.post.csrf.spec.ts:28:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.assignments.post.csrf.spec.ts","startTime":1756202425392,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["lessons complete idempotence (TEST_MODE)"],"duration":5,"failureDetails":[{"matcherResult":{"actual":429,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.lessons.complete.idempotent.spec.ts:19:23)"],"fullName":"lessons complete idempotence (TEST_MODE) double-complete returns 200 both times with consistent latest","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"double-complete returns 200 both times with consistent latest"}],"endTime":1756202425874,"message":"  ● lessons complete idempotence (TEST_MODE) › double-complete returns 200 both times with consistent latest\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 429\n\n    \u001b[0m \u001b[90m 17 |\u001b[39m     \u001b[36mconst\u001b[39m j2 \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m r2\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n     \u001b[90m 18 |\u001b[39m     expect(r1\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 19 |\u001b[39m     expect(r2\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 20 |\u001b[39m     expect(j1\u001b[33m.\u001b[39mlatest\u001b[33m.\u001b[39mlessonId)\u001b[33m.\u001b[39mtoBe(id)\u001b[33m;\u001b[39m\n     \u001b[90m 21 |\u001b[39m     expect(j2\u001b[33m.\u001b[39mlatest\u001b[33m.\u001b[39mlessonId)\u001b[33m.\u001b[39mtoBe(id)\u001b[33m;\u001b[39m\n     \u001b[90m 22 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.lessons.complete.idempotent.spec.ts:19:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.lessons.complete.idempotent.spec.ts","startTime":1756202425643,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Notification preferences API"],"duration":29,"failureDetails":[],"failureMessages":[],"fullName":"Notification preferences API GET returns defaults in test-mode and PATCH persists overrides","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"GET returns defaults in test-mode and PATCH persists overrides"},{"ancestorTitles":["Notification preferences API"],"duration":2,"failureDetails":[{"matcherResult":{"actual":429,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.notifications-preferences.spec.ts:32:24)"],"fullName":"Notification preferences API PUT merges prefs; unknown keys ignored/tolerated","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"PUT merges prefs; unknown keys ignored/tolerated"}],"endTime":1756202426106,"message":"  ● Notification preferences API › PUT merges prefs; unknown keys ignored/tolerated\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 429\n\n    \u001b[0m \u001b[90m 30 |\u001b[39m       body\u001b[33m:\u001b[39m \u001b[33mJSON\u001b[39m\u001b[33m.\u001b[39mstringify({ \u001b[32m'assignment:new'\u001b[39m\u001b[33m:\u001b[39m \u001b[36mfalse\u001b[39m\u001b[33m,\u001b[39m extra_key\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m })\n     \u001b[90m 31 |\u001b[39m     }) \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 32 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 33 |\u001b[39m     \u001b[36mconst\u001b[39m body \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m res\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n     \u001b[90m 34 |\u001b[39m     expect(body[\u001b[32m'assignment:new'\u001b[39m])\u001b[33m.\u001b[39mtoBe(\u001b[36mfalse\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 35 |\u001b[39m     expect(body[\u001b[32m'extra_key'\u001b[39m])\u001b[33m.\u001b[39mtoBe(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.notifications-preferences.spec.ts:32:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.notifications-preferences.spec.ts","startTime":1756202425880,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["middleware additional security headers"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"middleware additional security headers sets Referrer-Policy, X-Content-Type-Options, COOP, CORP, Permissions-Policy","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"sets Referrer-Policy, X-Content-Type-Options, COOP, CORP, Permissions-Policy"},{"ancestorTitles":["middleware additional security headers"],"duration":1,"failureDetails":[{"matcherResult":{"actual":null,"expected":"max-age=31536000; includeSubDomains; preload","message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: \"max-age=31536000; includeSubDomains; preload\"\nReceived: null","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: \"max-age=31536000; includeSubDomains; preload\"\nReceived: null\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\middleware.security-headers.more.spec.ts:40:62)"],"fullName":"middleware additional security headers sets HSTS only in production","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"sets HSTS only in production"}],"endTime":1756202426283,"message":"  ● middleware additional security headers › sets HSTS only in production\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"max-age=31536000; includeSubDomains; preload\"\n    Received: null\n\n    \u001b[0m \u001b[90m 38 |\u001b[39m     (process\u001b[33m.\u001b[39menv \u001b[36mas\u001b[39m any)\u001b[33m.\u001b[39m\u001b[33mNODE_ENV\u001b[39m \u001b[33m=\u001b[39m \u001b[32m'production'\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 39 |\u001b[39m     \u001b[36mconst\u001b[39m resProd\u001b[33m:\u001b[39m any \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (middleware \u001b[36mas\u001b[39m any)(req(\u001b[32m'http://localhost/api/health'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 40 |\u001b[39m     expect(resProd\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'Strict-Transport-Security'\u001b[39m))\u001b[33m.\u001b[39mtoBe(\u001b[32m'max-age=31536000; includeSubDomains; preload'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                                                              \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 41 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 42 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 43 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/middleware.security-headers.more.spec.ts:40:62)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\middleware.security-headers.more.spec.ts","startTime":1756202426121,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["files download-url ownership checks"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 401\nReceived array: [200, 404]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 401\nReceived array: [200, 404]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.download-url.permissions.spec.ts:19:23)"],"fullName":"files download-url ownership checks owner can download; non-owner teacher of course can download submission files; others 403","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"owner can download; non-owner teacher of course can download submission files; others 403"}],"endTime":1756202426429,"message":"  ● files download-url ownership checks › owner can download; non-owner teacher of course can download submission files; others 403\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 401\n    Received array: [200, 404]\n\n    \u001b[0m \u001b[90m 17 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m \u001b[32m'getRouteHandlerSupabase'\u001b[39m)\u001b[33m.\u001b[39mmockReturnValue(mock)\u001b[33m;\u001b[39m\n     \u001b[90m 18 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mDownloadGET\u001b[39m \u001b[36mas\u001b[39m any)(\u001b[36mget\u001b[39m(\u001b[32m'http://localhost/api/files/download-url?id=k1'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 19 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m404\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m \u001b[90m// presign may not exist in test env\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 20 |\u001b[39m\n     \u001b[90m 21 |\u001b[39m     \u001b[90m// Submission owned by student; teacher of the course allowed\u001b[39m\n     \u001b[90m 22 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m \u001b[32m'getCurrentUserInRoute'\u001b[39m)\u001b[33m.\u001b[39mmockResolvedValue({ id\u001b[33m:\u001b[39m \u001b[32m'teacher-1'\u001b[39m } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.files.download-url.permissions.spec.ts:19:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.download-url.permissions.spec.ts","startTime":1756202426294,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/quizzes"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"API /api/quizzes GET requires course_id → 400","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"GET requires course_id → 400"},{"ancestorTitles":["API /api/quizzes"],"duration":3,"failureDetails":[{"matcherResult":{"actual":429,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.quizzes.spec.ts:32:24)"],"fullName":"API /api/quizzes POST requires teacher: non-teacher → 403; unauth → 401","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"POST requires teacher: non-teacher → 403; unauth → 401"},{"ancestorTitles":["API /api/quizzes"],"duration":2,"failureDetails":[{"matcherResult":{"actual":429,"expected":400,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.quizzes.spec.ts:39:24)"],"fullName":"API /api/quizzes PATCH requires id and teacher","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"PATCH requires id and teacher"},{"ancestorTitles":["API /api/quizzes"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":400,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.quizzes.spec.ts:50:24)"],"fullName":"API /api/quizzes DELETE requires id and teacher","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"DELETE requires id and teacher"}],"endTime":1756202426596,"message":"  ● API /api/quizzes › POST requires teacher: non-teacher → 403; unauth → 401\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 429\n\n    \u001b[0m \u001b[90m 30 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 31 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mQuizzesPOST\u001b[39m \u001b[36mas\u001b[39m any)(\u001b[36mnew\u001b[39m \u001b[33mRequest\u001b[39m(\u001b[32m'http://localhost/api/quizzes'\u001b[39m\u001b[33m,\u001b[39m { method\u001b[33m:\u001b[39m \u001b[32m'POST'\u001b[39m\u001b[33m,\u001b[39m headers\u001b[33m,\u001b[39m body\u001b[33m:\u001b[39m \u001b[33mJSON\u001b[39m\u001b[33m.\u001b[39mstringify({ title\u001b[33m:\u001b[39m \u001b[32m'Quiz 1'\u001b[39m\u001b[33m,\u001b[39m course_id\u001b[33m:\u001b[39m \u001b[32m'00000000-0000-0000-0000-000000000001'\u001b[39m }) }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 32 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 33 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 34 |\u001b[39m\n     \u001b[90m 35 |\u001b[39m   test(\u001b[32m'PATCH requires id and teacher'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/api.quizzes.spec.ts:32:24)\n\n  ● API /api/quizzes › PATCH requires id and teacher\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 400\n    Received: 429\n\n    \u001b[0m \u001b[90m 37 |\u001b[39m     \u001b[36mconst\u001b[39m hdrs \u001b[33m=\u001b[39m { origin\u001b[33m:\u001b[39m \u001b[32m'http://localhost'\u001b[39m\u001b[33m,\u001b[39m referer\u001b[33m:\u001b[39m \u001b[32m'http://localhost/page'\u001b[39m } \u001b[36mas\u001b[39m any\u001b[33m;\u001b[39m\n     \u001b[90m 38 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mQuizzesPATCH\u001b[39m \u001b[36mas\u001b[39m any)(makePatch(\u001b[32m'http://localhost/api/quizzes'\u001b[39m\u001b[33m,\u001b[39m { title\u001b[33m:\u001b[39m \u001b[32m'New'\u001b[39m }\u001b[33m,\u001b[39m { \u001b[33m...\u001b[39mhdrs\u001b[33m,\u001b[39m \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 39 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 40 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mQuizzesPATCH\u001b[39m \u001b[36mas\u001b[39m any)(makePatch(\u001b[32m'http://localhost/api/quizzes?id=00000000-0000-0000-0000-000000000001'\u001b[39m\u001b[33m,\u001b[39m { title\u001b[33m:\u001b[39m \u001b[32m'New'\u001b[39m }\u001b[33m,\u001b[39m hdrs))\u001b[33m;\u001b[39m\n     \u001b[90m 41 |\u001b[39m     expect([\u001b[35m400\u001b[39m\u001b[33m,\u001b[39m\u001b[35m401\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m 42 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.quizzes.spec.ts:39:24)\n\n  ● API /api/quizzes › DELETE requires id and teacher\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 400\n    Received: 429\n\n    \u001b[0m \u001b[90m 48 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 49 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mQuizzesDELETE\u001b[39m \u001b[36mas\u001b[39m any)(makeDelete(\u001b[32m'http://localhost/api/quizzes'\u001b[39m\u001b[33m,\u001b[39m hdrs))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 50 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 51 |\u001b[39m     \u001b[90m// switch to student for forbidden check\u001b[39m\n     \u001b[90m 52 |\u001b[39m     \u001b[90m// @ts-ignore\u001b[39m\n     \u001b[90m 53 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.quizzes.spec.ts:50:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.quizzes.spec.ts","startTime":1756202426441,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/lessons/reorder (TEST_MODE)"],"duration":5,"failureDetails":[{"matcherResult":{"actual":429,"expected":403,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 403\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.lessons.reorder.spec.ts:19:25)"],"fullName":"API /api/lessons/reorder (TEST_MODE) unauth → 401; non-teacher → 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"unauth → 401; non-teacher → 403"},{"ancestorTitles":["API /api/lessons/reorder (TEST_MODE)"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":400,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.lessons.reorder.spec.ts:27:24)"],"fullName":"API /api/lessons/reorder (TEST_MODE) invalid payload → 400; valid reorder → 200 { ok: true }","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"invalid payload → 400; valid reorder → 200 { ok: true }"}],"endTime":1756202426761,"message":"  ● API /api/lessons/reorder (TEST_MODE) › unauth → 401; non-teacher → 403\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 403\n    Received: 429\n\n    \u001b[0m \u001b[90m 17 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'student'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 18 |\u001b[39m     \u001b[36mconst\u001b[39m res2 \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mReorderPOST\u001b[39m \u001b[36mas\u001b[39m any)(makePost({ course_id\u001b[33m:\u001b[39m \u001b[32m'00000000-0000-0000-0000-000000000001'\u001b[39m\u001b[33m,\u001b[39m items\u001b[33m:\u001b[39m [] }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 19 |\u001b[39m     expect(res2\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m403\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                         \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 20 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 21 |\u001b[39m\n     \u001b[90m 22 |\u001b[39m   test(\u001b[32m'invalid payload → 400; valid reorder → 200 { ok: true }'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/api.lessons.reorder.spec.ts:19:25)\n\n  ● API /api/lessons/reorder (TEST_MODE) › invalid payload → 400; valid reorder → 200 { ok: true }\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 400\n    Received: 429\n\n    \u001b[0m \u001b[90m 25 |\u001b[39m     globalThis\u001b[33m.\u001b[39m__TEST_HEADERS_STORE__\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mset\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'x-test-auth'\u001b[39m\u001b[33m,\u001b[39m \u001b[32m'teacher'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m     \u001b[36mlet\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mReorderPOST\u001b[39m \u001b[36mas\u001b[39m any)(makePost({}))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 27 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 28 |\u001b[39m     \u001b[36mconst\u001b[39m courseId \u001b[33m=\u001b[39m \u001b[32m'00000000-0000-0000-0000-000000000010'\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 29 |\u001b[39m     addTestLesson({ id\u001b[33m:\u001b[39m \u001b[32m'l1'\u001b[39m\u001b[33m,\u001b[39m course_id\u001b[33m:\u001b[39m courseId\u001b[33m,\u001b[39m title\u001b[33m:\u001b[39m \u001b[32m'A'\u001b[39m\u001b[33m,\u001b[39m content\u001b[33m:\u001b[39m \u001b[32m''\u001b[39m\u001b[33m,\u001b[39m order_index\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m created_at\u001b[33m:\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mDate\u001b[39m()\u001b[33m.\u001b[39mtoISOString() })\u001b[33m;\u001b[39m\n     \u001b[90m 30 |\u001b[39m     addTestLesson({ id\u001b[33m:\u001b[39m \u001b[32m'l2'\u001b[39m\u001b[33m,\u001b[39m course_id\u001b[33m:\u001b[39m courseId\u001b[33m,\u001b[39m title\u001b[33m:\u001b[39m \u001b[32m'B'\u001b[39m\u001b[33m,\u001b[39m content\u001b[33m:\u001b[39m \u001b[32m''\u001b[39m\u001b[33m,\u001b[39m order_index\u001b[33m:\u001b[39m \u001b[35m2\u001b[39m\u001b[33m,\u001b[39m created_at\u001b[33m:\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mDate\u001b[39m()\u001b[33m.\u001b[39mtoISOString() })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.lessons.reorder.spec.ts:27:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.lessons.reorder.spec.ts","startTime":1756202426603,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime outcomes provider JWT iss/aud negatives"],"duration":3,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [401, 403]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [401, 403]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.outcomes.iss-aud.negatives.spec.ts:12:23)"],"fullName":"runtime outcomes provider JWT iss/aud negatives invalid issuer/audience format yields 403 when present","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"invalid issuer/audience format yields 403 when present"}],"endTime":1756202426892,"message":"  ● runtime outcomes provider JWT iss/aud negatives › invalid issuer/audience format yields 403 when present\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 400\n    Received array: [401, 403]\n\n    \u001b[0m \u001b[90m 10 |\u001b[39m     \u001b[90m// Without a real JWT, this exercises the code path expectation only; actual 401/403 depends on signature verify\u001b[39m\n     \u001b[90m 11 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mOutcomesPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(body\u001b[33m,\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m'Bearer bad.token.value'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 12 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 13 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 14 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 15 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.outcomes.iss-aud.negatives.spec.ts:12:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.outcomes.iss-aud.negatives.spec.ts","startTime":1756202426764,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["middleware CSRF cookie issuance"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toBeTruthy()\n\nReceived: false","pass":false}}],"failureMessages":["Error: expect(received).toBeTruthy()\n\nReceived: false\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\middleware.csrf-cookie.spec.ts:41:23)"],"fullName":"middleware CSRF cookie issuance sets csrf_token cookie when missing","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"sets csrf_token cookie when missing"}],"endTime":1756202427016,"message":"  ● middleware CSRF cookie issuance › sets csrf_token cookie when missing\n\n    expect(received).toBeTruthy()\n\n    Received: false\n\n    \u001b[0m \u001b[90m 39 |\u001b[39m     \u001b[90m// Our mock NextResponse.next returns an object with cookies Map interface\u001b[39m\n     \u001b[90m 40 |\u001b[39m     \u001b[36mconst\u001b[39m hasCookie \u001b[33m=\u001b[39m \u001b[33m!\u001b[39m\u001b[33m!\u001b[39mres\u001b[33m?\u001b[39m\u001b[33m.\u001b[39mcookies\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m\u001b[33m?\u001b[39m\u001b[33m.\u001b[39m(\u001b[32m'csrf_token'\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 41 |\u001b[39m     expect(hasCookie)\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 42 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 43 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 44 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/middleware.csrf-cookie.spec.ts:41:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\middleware.csrf-cookie.spec.ts","startTime":1756202426896,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["files finalize updates quotas when enabled"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 401\nReceived array: [200]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 401\nReceived array: [200]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.quota.enforcement.spec.ts:21:19)"],"fullName":"files finalize updates quotas when enabled increases used_bytes by delta for user/submission owners","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"increases used_bytes by delta for user/submission owners"}],"endTime":1756202427151,"message":"  ● files finalize updates quotas when enabled › increases used_bytes by delta for user/submission owners\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 401\n    Received array: [200]\n\n    \u001b[0m \u001b[90m 19 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa \u001b[36mas\u001b[39m any\u001b[33m,\u001b[39m \u001b[32m'getRouteHandlerSupabase'\u001b[39m)\u001b[33m.\u001b[39mmockReturnValue(mock)\u001b[33m;\u001b[39m\n     \u001b[90m 20 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mFinalizePOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[35m250\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 21 |\u001b[39m     expect([\u001b[35m200\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 22 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 23 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 24 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.files.quota.enforcement.spec.ts:21:19)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.quota.enforcement.spec.ts","startTime":1756202427025,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime auth exchange edge cases"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"runtime auth exchange edge cases bad token → 400 or 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"bad token → 400 or 403"},{"ancestorTitles":["runtime auth exchange edge cases"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [400, 403]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 429\nReceived array: [400, 403]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.auth.exchange.edgecases.spec.ts:22:23)"],"fullName":"runtime auth exchange edge cases invalid claims → 400","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"invalid claims → 400"}],"endTime":1756202427285,"message":"  ● runtime auth exchange edge cases › invalid claims → 400\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 429\n    Received array: [400, 403]\n\n    \u001b[0m \u001b[90m 20 |\u001b[39m     \u001b[36mconst\u001b[39m token \u001b[33m=\u001b[39m \u001b[32m'x.'\u001b[39m\u001b[33m.\u001b[39mrepeat(\u001b[35m6\u001b[39m) \u001b[33m+\u001b[39m \u001b[32m'y'\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 21 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mExchangePOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/auth/exchange'\u001b[39m\u001b[33m,\u001b[39m { token }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 22 |\u001b[39m     expect([\u001b[35m400\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 23 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 24 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 25 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.auth.exchange.edgecases.spec.ts:22:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.auth.exchange.edgecases.spec.ts","startTime":1756202427154,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["attachments delete permissions (smoke)"],"duration":1,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 401, 404]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 401, 404]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.attachments.delete.permissions.spec.ts:20:27)"],"fullName":"attachments delete permissions (smoke) student can delete own attachment","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"student can delete own attachment"}],"endTime":1756202427418,"message":"  ● attachments delete permissions (smoke) › student can delete own attachment\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 403\n    Received array: [200, 401, 404]\n\n    \u001b[0m \u001b[90m 18 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa\u001b[33m,\u001b[39m \u001b[32m'getRouteHandlerSupabase'\u001b[39m)\u001b[33m.\u001b[39mmockReturnValue(supabase \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 19 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mAttachDELETE\u001b[39m \u001b[36mas\u001b[39m any)(del(\u001b[32m'http://localhost/api/files/attachment?key=k'\u001b[39m))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 20 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m404\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                           \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 21 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 22 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 23 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.attachments.delete.permissions.spec.ts:20:27)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.attachments.delete.permissions.spec.ts","startTime":1756202427290,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["API runtime"],"duration":2,"failureDetails":[{"matcherResult":{"actual":429,"expected":400,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 400\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.spec.ts:18:24)"],"fullName":"API runtime events: unauth 401; missing courseId 400","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"events: unauth 401; missing courseId 400"},{"ancestorTitles":["API runtime"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"API runtime export: unauth 401; missing course_id 400; csv headers; teacher-only enforcement","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"export: unauth 401; missing course_id 400; csv headers; teacher-only enforcement"},{"ancestorTitles":["API runtime"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"API runtime teacher outcomes: unauth 401; non-teacher 403; 200 with list","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"teacher outcomes: unauth 401; non-teacher 403; 200 with list"}],"endTime":1756202427594,"message":"  ● API runtime › events: unauth 401; missing courseId 400\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 400\n    Received: 429\n\n    \u001b[0m \u001b[90m 16 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supabaseServer\u001b[33m,\u001b[39m \u001b[32m'getCurrentUserInRoute'\u001b[39m)\u001b[33m.\u001b[39mmockResolvedValue({ id\u001b[33m:\u001b[39m \u001b[32m'u1'\u001b[39m\u001b[33m,\u001b[39m user_metadata\u001b[33m:\u001b[39m { role\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m } } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 17 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mEventsPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/events'\u001b[39m\u001b[33m,\u001b[39m {}))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 18 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 19 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 20 |\u001b[39m\n     \u001b[90m 21 |\u001b[39m   test(\u001b[32m'export: unauth 401; missing course_id 400; csv headers; teacher-only enforcement'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.spec.ts:18:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.spec.ts","startTime":1756202427422,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["api.messages guard (MVP_PROD_GUARD)"],"duration":5,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [401, 501]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 400\nReceived array: [401, 501]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.guard.spec.ts:13:24)"],"fullName":"api.messages guard (MVP_PROD_GUARD) guard enforced in production-like (non test-mode)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"guard enforced in production-like (non test-mode)"}],"endTime":1756202427789,"message":"  ● api.messages guard (MVP_PROD_GUARD) › guard enforced in production-like (non test-mode)\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 400\n    Received array: [401, 501]\n\n    \u001b[0m \u001b[90m 11 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mMessagesGET\u001b[39m \u001b[36mas\u001b[39m any)(makeReq(\u001b[32m'http://localhost/api/messages?thread_id=th1'\u001b[39m\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'student'\u001b[39m }))\u001b[33m;\u001b[39m\n     \u001b[90m 12 |\u001b[39m     \u001b[90m// In non test-mode, auth may fail or MVP guard may block; accept 401 or 501\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 13 |\u001b[39m     expect([\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m \u001b[35m501\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 14 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 15 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 16 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.messages.guard.spec.ts:13:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.guard.spec.ts","startTime":1756202427598,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["User profile PUT"],"duration":1,"failureDetails":[{"matcherResult":{"actual":429,"expected":200,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 200\nReceived: 429\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.user-profile.put.spec.ts:19:24)"],"fullName":"User profile PUT updates allowed fields; unauth 401; validation 400","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"updates allowed fields; unauth 401; validation 400"}],"endTime":1756202427987,"message":"  ● User profile PUT › updates allowed fields; unauth 401; validation 400\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 200\n    Received: 429\n\n    \u001b[0m \u001b[90m 17 |\u001b[39m\n     \u001b[90m 18 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mProfilePUT\u001b[39m \u001b[36mas\u001b[39m any)(put({ display_name\u001b[33m:\u001b[39m \u001b[32m'D'\u001b[39m\u001b[33m,\u001b[39m avatar_url\u001b[33m:\u001b[39m \u001b[32m'http://x'\u001b[39m\u001b[33m,\u001b[39m preferences\u001b[33m:\u001b[39m { a\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m } }\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 19 |\u001b[39m     expect(res\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m200\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                        \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 20 |\u001b[39m\n     \u001b[90m 21 |\u001b[39m     \u001b[36mconst\u001b[39m bad \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mProfilePUT\u001b[39m \u001b[36mas\u001b[39m any)(put({ display_name\u001b[33m:\u001b[39m \u001b[35m123\u001b[39m }\u001b[33m,\u001b[39m { \u001b[32m'x-test-auth'\u001b[39m\u001b[33m:\u001b[39m \u001b[32m'teacher'\u001b[39m }))\u001b[33m;\u001b[39m\n     \u001b[90m 22 |\u001b[39m     expect(bad\u001b[33m.\u001b[39mstatus)\u001b[33m.\u001b[39mtoBe(\u001b[35m400\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.user-profile.put.spec.ts:19:24)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.user-profile.put.spec.ts","startTime":1756202427796,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime events scopes"],"duration":14,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 201, 204]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 201, 204]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.events.scopes.spec.ts:33:27)"],"fullName":"runtime events scopes course.progress requires progress.write; course.attempt.completed requires attempts.write","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"course.progress requires progress.write; course.attempt.completed requires attempts.write"}],"endTime":1756202428238,"message":"  ● runtime events scopes › course.progress requires progress.write; course.attempt.completed requires attempts.write\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 403\n    Received array: [200, 201, 204]\n\n    \u001b[0m \u001b[90m 31 |\u001b[39m     token \u001b[33m=\u001b[39m makeJwt([\u001b[32m'progress.write'\u001b[39m])\u001b[33m;\u001b[39m\n     \u001b[90m 32 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mEventsPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/events'\u001b[39m\u001b[33m,\u001b[39m { type\u001b[33m:\u001b[39m \u001b[32m'course.progress'\u001b[39m\u001b[33m,\u001b[39m pct\u001b[33m:\u001b[39m \u001b[35m10\u001b[39m }\u001b[33m,\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m`Bearer ${token}`\u001b[39m }))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 33 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m201\u001b[39m\u001b[33m,\u001b[39m\u001b[35m204\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                           \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 34 |\u001b[39m     \u001b[90m// Missing attempts.write for attempt.completed -> 403\u001b[39m\n     \u001b[90m 35 |\u001b[39m     token \u001b[33m=\u001b[39m makeJwt([])\u001b[33m;\u001b[39m\n     \u001b[90m 36 |\u001b[39m     res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mEventsPOST\u001b[39m \u001b[36mas\u001b[39m any)(post(\u001b[32m'http://localhost/api/runtime/events'\u001b[39m\u001b[33m,\u001b[39m { type\u001b[33m:\u001b[39m \u001b[32m'course.attempt.completed'\u001b[39m\u001b[33m,\u001b[39m score\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m max\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m passed\u001b[33m:\u001b[39m \u001b[36mtrue\u001b[39m }\u001b[33m,\u001b[39m { authorization\u001b[33m:\u001b[39m \u001b[32m`Bearer ${token}`\u001b[39m }))\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.runtime.events.scopes.spec.ts:33:27)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.events.scopes.spec.ts","startTime":1756202427992,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["courses transfer-owner audit"],"duration":5,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 500\nReceived array: [200, 401, 403, 400]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 500\nReceived array: [200, 401, 403, 400]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.courses.transfer-owner.audit.spec.ts:27:31)"],"fullName":"courses transfer-owner audit writes audit log (happy path)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"writes audit log (happy path)"}],"endTime":1756202428506,"message":"  ● courses transfer-owner audit › writes audit log (happy path)\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 500\n    Received array: [200, 401, 403, 400]\n\n    \u001b[0m \u001b[90m 25 |\u001b[39m     jest\u001b[33m.\u001b[39mspyOn(supa\u001b[33m,\u001b[39m \u001b[32m'getRouteHandlerSupabase'\u001b[39m)\u001b[33m.\u001b[39mmockReturnValue(mock \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n     \u001b[90m 26 |\u001b[39m     \u001b[36mconst\u001b[39m res \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mTransferPATCH\u001b[39m \u001b[36mas\u001b[39m any)(req(\u001b[32m'http://localhost/api/courses/c1/transfer-owner'\u001b[39m\u001b[33m,\u001b[39m { teacher_id\u001b[33m:\u001b[39m \u001b[32m'00000000-0000-0000-0000-000000000999'\u001b[39m } \u001b[36mas\u001b[39m any)\u001b[33m,\u001b[39m { params\u001b[33m:\u001b[39m { id\u001b[33m:\u001b[39m \u001b[32m'c1'\u001b[39m } } \u001b[36mas\u001b[39m any)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 27 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m401\u001b[39m\u001b[33m,\u001b[39m\u001b[35m403\u001b[39m\u001b[33m,\u001b[39m\u001b[35m400\u001b[39m])\u001b[33m.\u001b[39mtoContain(res\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                               \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 28 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 29 |\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 30 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.courses.transfer-owner.audit.spec.ts:27:31)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.courses.transfer-owner.audit.spec.ts","startTime":1756202428244,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["quizzes rate-limit headers on PATCH/DELETE"],"duration":6,"failureDetails":[{"issues":[{"code":"too_small","minimum":3,"type":"string","inclusive":true,"exact":false,"message":"String must contain at least 3 character(s)","path":["title"]}],"name":"ZodError"}],"failureMessages":["ZodError: [\n  {\n    \"code\": \"too_small\",\n    \"minimum\": 3,\n    \"type\": \"string\",\n    \"inclusive\": true,\n    \"exact\": false,\n    \"message\": \"String must contain at least 3 character(s)\",\n    \"path\": [\n      \"title\"\n    ]\n  }\n]\n    at Object.get error [as error] (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\zod\\v3\\types.cjs:45:31)\n    at ZodEffects.parse (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\zod\\v3\\types.cjs:120:22)\n    at PATCH (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\app\\api\\quizzes\\route.ts:95:36)\n    at Object.PATCH (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\server\\withRouteTiming.ts:90:19)\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.quizzes.ratelimit.spec.ts:15:17)"],"fullName":"quizzes rate-limit headers on PATCH/DELETE PATCH returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"PATCH returns 429 with standard headers when limited"},{"ancestorTitles":["quizzes rate-limit headers on PATCH/DELETE"],"duration":10,"failureDetails":[],"failureMessages":[],"fullName":"quizzes rate-limit headers on PATCH/DELETE DELETE returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"DELETE returns 429 with standard headers when limited"}],"endTime":1756202428700,"message":"  ● quizzes rate-limit headers on PATCH/DELETE › PATCH returns 429 with standard headers when limited\n\n    ZodError: [\n      {\n        \"code\": \"too_small\",\n        \"minimum\": 3,\n        \"type\": \"string\",\n        \"inclusive\": true,\n        \"exact\": false,\n        \"message\": \"String must contain at least 3 character(s)\",\n        \"path\": [\n          \"title\"\n        ]\n      }\n    ]\n\n    \u001b[0m \u001b[90m 93 |\u001b[39m   } \u001b[36mcatch\u001b[39m {}\n     \u001b[90m 94 |\u001b[39m   \u001b[36mconst\u001b[39m body \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m req\u001b[33m.\u001b[39mjson()\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 95 |\u001b[39m   \u001b[36mconst\u001b[39m parsed \u001b[33m=\u001b[39m quizUpdateRequest\u001b[33m.\u001b[39mparse(body)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                                    \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 96 |\u001b[39m   \u001b[36mconst\u001b[39m out \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m updateQuizApi(q\u001b[33m.\u001b[39mid\u001b[33m,\u001b[39m parsed)\u001b[33m;\u001b[39m\n     \u001b[90m 97 |\u001b[39m   \u001b[36mtry\u001b[39m {\n     \u001b[90m 98 |\u001b[39m     \u001b[36mconst\u001b[39m dto \u001b[33m=\u001b[39m quizDto\u001b[33m.\u001b[39mparse(out)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.get error [as error] (../node_modules/zod/v3/types.cjs:45:31)\n      at ZodEffects.parse (../node_modules/zod/v3/types.cjs:120:22)\n      at PATCH (../apps/web/src/app/api/quizzes/route.ts:95:36)\n      at Object.PATCH (../apps/web/src/server/withRouteTiming.ts:90:19)\n      at Object.<anonymous> (unit/api.quizzes.ratelimit.spec.ts:15:17)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.quizzes.ratelimit.spec.ts","startTime":1756202428522,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["files upload-url rate limit headers"],"duration":3,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 401]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 403\nReceived array: [200, 401]\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.upload-url.ratelimit.spec.ts:17:23)"],"fullName":"files upload-url rate limit headers 429 includes rate limit headers","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"429 includes rate limit headers"}],"endTime":1756202428830,"message":"  ● files upload-url rate limit headers › 429 includes rate limit headers\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 403\n    Received array: [200, 401]\n\n    \u001b[0m \u001b[90m 15 |\u001b[39m     \u001b[36mconst\u001b[39m payload \u001b[33m=\u001b[39m { owner_type\u001b[33m:\u001b[39m \u001b[32m'user'\u001b[39m\u001b[33m,\u001b[39m owner_id\u001b[33m:\u001b[39m \u001b[32m'test-student-id'\u001b[39m\u001b[33m,\u001b[39m content_type\u001b[33m:\u001b[39m \u001b[32m'text/plain'\u001b[39m }\u001b[33m;\u001b[39m\n     \u001b[90m 16 |\u001b[39m     \u001b[36mconst\u001b[39m res1 \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mUploadPOST\u001b[39m \u001b[36mas\u001b[39m any)(req(payload))\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 17 |\u001b[39m     expect([\u001b[35m200\u001b[39m\u001b[33m,\u001b[39m\u001b[35m401\u001b[39m])\u001b[33m.\u001b[39mtoContain(res1\u001b[33m.\u001b[39mstatus)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 18 |\u001b[39m     \u001b[36mconst\u001b[39m res2 \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m (\u001b[33mUploadPOST\u001b[39m \u001b[36mas\u001b[39m any)(req(payload))\u001b[33m;\u001b[39m\n     \u001b[90m 19 |\u001b[39m     \u001b[36mif\u001b[39m (res2\u001b[33m.\u001b[39mstatus \u001b[33m===\u001b[39m \u001b[35m429\u001b[39m) {\n     \u001b[90m 20 |\u001b[39m       expect(res2\u001b[33m.\u001b[39mheaders\u001b[33m.\u001b[39m\u001b[36mget\u001b[39m(\u001b[32m'retry-after'\u001b[39m))\u001b[33m.\u001b[39mtoBeTruthy()\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/api.files.upload-url.ratelimit.spec.ts:17:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.upload-url.ratelimit.spec.ts","startTime":1756202428705,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["ReportsGateway"],"duration":1,"failureDetails":[{"matcherResult":{"actual":12,"expected":3,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 3\nReceived: 12","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 3\nReceived: 12\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\gateways\\reports.gateway.spec.ts:17:25)"],"fullName":"ReportsGateway engagement returns counters (course scoped)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"engagement returns counters (course scoped)"},{"ancestorTitles":["ReportsGateway"],"duration":0,"failureDetails":[{"matcherResult":{"actual":42,"expected":10,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 10\nReceived: 42","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 10\nReceived: 42\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\gateways\\reports.gateway.spec.ts:30:23)"],"fullName":"ReportsGateway gradeDistribution returns shape (admin/global)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"gradeDistribution returns shape (admin/global)"}],"endTime":1756202428941,"message":"  ● ReportsGateway › engagement returns counters (course scoped)\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 3\n    Received: 12\n\n    \u001b[0m \u001b[90m 15 |\u001b[39m     }))\u001b[33m;\u001b[39m\n     \u001b[90m 16 |\u001b[39m     \u001b[36mconst\u001b[39m out \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m createReportsGateway()\u001b[33m.\u001b[39mengagement(\u001b[32m'c-1'\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 17 |\u001b[39m     expect(out\u001b[33m.\u001b[39mlessons)\u001b[33m.\u001b[39mtoBe(\u001b[35m3\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                         \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 18 |\u001b[39m     expect(out\u001b[33m.\u001b[39massignments)\u001b[33m.\u001b[39mtoBe(\u001b[35m2\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 19 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 20 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/gateways/reports.gateway.spec.ts:17:25)\n\n  ● ReportsGateway › gradeDistribution returns shape (admin/global)\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 10\n    Received: 42\n\n    \u001b[0m \u001b[90m 28 |\u001b[39m     }))\u001b[33m;\u001b[39m\n     \u001b[90m 29 |\u001b[39m     \u001b[36mconst\u001b[39m out \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m createReportsGateway()\u001b[33m.\u001b[39mgradeDistribution()\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 30 |\u001b[39m     expect(out\u001b[33m.\u001b[39mtotal)\u001b[33m.\u001b[39mtoBe(\u001b[35m10\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 31 |\u001b[39m     expect(out\u001b[33m.\u001b[39mdist[\u001b[35m0\u001b[39m]\u001b[33m.\u001b[39mbucket)\u001b[33m.\u001b[39mtoBe(\u001b[32m'80-89'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 32 |\u001b[39m   })\u001b[33m;\u001b[39m\n     \u001b[90m 33 |\u001b[39m })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (unit/gateways/reports.gateway.spec.ts:30:23)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\gateways\\reports.gateway.spec.ts","startTime":1756202428834,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["EnrollmentsGateway.list"],"duration":3,"failureDetails":[{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":[0,"id"]},{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":[0,"course_id"]},{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":[1,"id"]},{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":[1,"course_id"]}],"name":"ZodError"}],"failureMessages":["ZodError: [\n  {\n    \"validation\": \"uuid\",\n    \"code\": \"invalid_string\",\n    \"message\": \"Invalid uuid\",\n    \"path\": [\n      0,\n      \"id\"\n    ]\n  },\n  {\n    \"validation\": \"uuid\",\n    \"code\": \"invalid_string\",\n    \"message\": \"Invalid uuid\",\n    \"path\": [\n      0,\n      \"course_id\"\n    ]\n  },\n  {\n    \"validation\": \"uuid\",\n    \"code\": \"invalid_string\",\n    \"message\": \"Invalid uuid\",\n    \"path\": [\n      1,\n      \"id\"\n    ]\n  },\n  {\n    \"validation\": \"uuid\",\n    \"code\": \"invalid_string\",\n    \"message\": \"Invalid uuid\",\n    \"path\": [\n      1,\n      \"course_id\"\n    ]\n  }\n]\n    at Object.get error [as error] (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\zod\\v3\\types.cjs:45:31)\n    at ZodArray.parse (C:\\Users\\agafn\\Desktop\\education system 5\\node_modules\\zod\\v3\\types.cjs:120:22)\n    at fetchJson (C:\\Users\\agafn\\Desktop\\education system 5\\apps\\web\\src\\lib\\serverFetch.ts:102:17)\n    at Object.<anonymous> (C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\gateways\\enrollments.gateway.spec.ts:27:18)"],"fullName":"EnrollmentsGateway.list returns enrollments array","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"returns enrollments array"}],"endTime":1756202429081,"message":"  ● EnrollmentsGateway.list › returns enrollments array\n\n    ZodError: [\n      {\n        \"validation\": \"uuid\",\n        \"code\": \"invalid_string\",\n        \"message\": \"Invalid uuid\",\n        \"path\": [\n          0,\n          \"id\"\n        ]\n      },\n      {\n        \"validation\": \"uuid\",\n        \"code\": \"invalid_string\",\n        \"message\": \"Invalid uuid\",\n        \"path\": [\n          0,\n          \"course_id\"\n        ]\n      },\n      {\n        \"validation\": \"uuid\",\n        \"code\": \"invalid_string\",\n        \"message\": \"Invalid uuid\",\n        \"path\": [\n          1,\n          \"id\"\n        ]\n      },\n      {\n        \"validation\": \"uuid\",\n        \"code\": \"invalid_string\",\n        \"message\": \"Invalid uuid\",\n        \"path\": [\n          1,\n          \"course_id\"\n        ]\n      }\n    ]\n\n    \u001b[0m \u001b[90m 100 |\u001b[39m     \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m`${code}: ${message}`\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 101 |\u001b[39m   }\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 102 |\u001b[39m   \u001b[36mreturn\u001b[39m schema\u001b[33m.\u001b[39mparse(json) \u001b[36mas\u001b[39m \u001b[33mT\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 103 |\u001b[39m }\n     \u001b[90m 104 |\u001b[39m\n     \u001b[90m 105 |\u001b[39m\u001b[0m\n\n      at Object.get error [as error] (../node_modules/zod/v3/types.cjs:45:31)\n      at ZodArray.parse (../node_modules/zod/v3/types.cjs:120:22)\n      at fetchJson (../apps/web/src/lib/serverFetch.ts:102:17)\n      at Object.<anonymous> (unit/gateways/enrollments.gateway.spec.ts:27:18)\n","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\gateways\\enrollments.gateway.spec.ts","startTime":1756202428945,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":[],"duration":295,"failureDetails":[],"failureMessages":[],"fullName":"GradeRowClient saves grade via API and shows success","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"GradeRowClient saves grade via API and shows success"}],"endTime":1756202429879,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\GradeRowClient.spec.tsx","startTime":1756202429102,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":54,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'admin/audit-logs',\n  url: 'http://localhost/api/admin/audit-logs',\n  handler: [AsyncFunction (anonymous)],\n  role: 'student'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'admin/audit-logs',\n  url: 'http://localhost/api/admin/audit-logs',\n  handler: [AsyncFunction (anonymous)],\n  role: 'student'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":37,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'admin/audit-logs',\n  url: 'http://localhost/api/admin/audit-logs',\n  handler: [AsyncFunction (anonymous)],\n  role: 'teacher'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'admin/audit-logs',\n  url: 'http://localhost/api/admin/audit-logs',\n  handler: [AsyncFunction (anonymous)],\n  role: 'teacher'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":32,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'admin/audit-logs',\n  url: 'http://localhost/api/admin/audit-logs',\n  handler: [AsyncFunction (anonymous)],\n  role: 'parent'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'admin/audit-logs',\n  url: 'http://localhost/api/admin/audit-logs',\n  handler: [AsyncFunction (anonymous)],\n  role: 'parent'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":34,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'admin/audit-logs',\n  url: 'http://localhost/api/admin/audit-logs',\n  handler: [AsyncFunction (anonymous)],\n  role: 'admin'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'admin/audit-logs',\n  url: 'http://localhost/api/admin/audit-logs',\n  handler: [AsyncFunction (anonymous)],\n  role: 'admin'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":26,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'admin/export',\n  url: 'http://localhost/api/admin/export',\n  handler: [AsyncFunction (anonymous)],\n  role: 'student'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'admin/export',\n  url: 'http://localhost/api/admin/export',\n  handler: [AsyncFunction (anonymous)],\n  role: 'student'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":30,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'admin/export',\n  url: 'http://localhost/api/admin/export',\n  handler: [AsyncFunction (anonymous)],\n  role: 'teacher'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'admin/export',\n  url: 'http://localhost/api/admin/export',\n  handler: [AsyncFunction (anonymous)],\n  role: 'teacher'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":61,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'admin/export',\n  url: 'http://localhost/api/admin/export',\n  handler: [AsyncFunction (anonymous)],\n  role: 'parent'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'admin/export',\n  url: 'http://localhost/api/admin/export',\n  handler: [AsyncFunction (anonymous)],\n  role: 'parent'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":45,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'admin/export',\n  url: 'http://localhost/api/admin/export',\n  handler: [AsyncFunction (anonymous)],\n  role: 'admin'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'admin/export',\n  url: 'http://localhost/api/admin/export',\n  handler: [AsyncFunction (anonymous)],\n  role: 'admin'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":37,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'admin/metrics',\n  url: 'http://localhost/api/admin/metrics',\n  handler: [AsyncFunction (anonymous)],\n  role: 'student'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'admin/metrics',\n  url: 'http://localhost/api/admin/metrics',\n  handler: [AsyncFunction (anonymous)],\n  role: 'student'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":21,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'admin/metrics',\n  url: 'http://localhost/api/admin/metrics',\n  handler: [AsyncFunction (anonymous)],\n  role: 'teacher'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'admin/metrics',\n  url: 'http://localhost/api/admin/metrics',\n  handler: [AsyncFunction (anonymous)],\n  role: 'teacher'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":39,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'admin/metrics',\n  url: 'http://localhost/api/admin/metrics',\n  handler: [AsyncFunction (anonymous)],\n  role: 'parent'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'admin/metrics',\n  url: 'http://localhost/api/admin/metrics',\n  handler: [AsyncFunction (anonymous)],\n  role: 'parent'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":19,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'admin/metrics',\n  url: 'http://localhost/api/admin/metrics',\n  handler: [AsyncFunction (anonymous)],\n  role: 'admin'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'admin/metrics',\n  url: 'http://localhost/api/admin/metrics',\n  handler: [AsyncFunction (anonymous)],\n  role: 'admin'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":34,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'admin/quotas',\n  url: 'http://localhost/api/admin/quotas',\n  handler: [AsyncFunction (anonymous)],\n  role: 'student'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'admin/quotas',\n  url: 'http://localhost/api/admin/quotas',\n  handler: [AsyncFunction (anonymous)],\n  role: 'student'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":35,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'admin/quotas',\n  url: 'http://localhost/api/admin/quotas',\n  handler: [AsyncFunction (anonymous)],\n  role: 'teacher'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'admin/quotas',\n  url: 'http://localhost/api/admin/quotas',\n  handler: [AsyncFunction (anonymous)],\n  role: 'teacher'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":33,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'admin/quotas',\n  url: 'http://localhost/api/admin/quotas',\n  handler: [AsyncFunction (anonymous)],\n  role: 'parent'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'admin/quotas',\n  url: 'http://localhost/api/admin/quotas',\n  handler: [AsyncFunction (anonymous)],\n  role: 'parent'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":29,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'admin/quotas',\n  url: 'http://localhost/api/admin/quotas',\n  handler: [AsyncFunction (anonymous)],\n  role: 'admin'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'admin/quotas',\n  url: 'http://localhost/api/admin/quotas',\n  handler: [AsyncFunction (anonymous)],\n  role: 'admin'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":44,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'users',\n  url: 'http://localhost/api/users',\n  handler: [AsyncFunction (anonymous)],\n  role: 'student'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'users',\n  url: 'http://localhost/api/users',\n  handler: [AsyncFunction (anonymous)],\n  role: 'student'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":37,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'users',\n  url: 'http://localhost/api/users',\n  handler: [AsyncFunction (anonymous)],\n  role: 'teacher'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'users',\n  url: 'http://localhost/api/users',\n  handler: [AsyncFunction (anonymous)],\n  role: 'teacher'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":24,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'users',\n  url: 'http://localhost/api/users',\n  handler: [AsyncFunction (anonymous)],\n  role: 'parent'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'users',\n  url: 'http://localhost/api/users',\n  handler: [AsyncFunction (anonymous)],\n  role: 'parent'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":47,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'users',\n  url: 'http://localhost/api/users',\n  handler: [AsyncFunction (anonymous)],\n  role: 'admin'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'users',\n  url: 'http://localhost/api/users',\n  handler: [AsyncFunction (anonymous)],\n  role: 'admin'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":38,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'providers/health',\n  url: 'http://localhost/api/providers/health',\n  handler: [AsyncFunction (anonymous)],\n  role: 'student'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'providers/health',\n  url: 'http://localhost/api/providers/health',\n  handler: [AsyncFunction (anonymous)],\n  role: 'student'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":32,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'providers/health',\n  url: 'http://localhost/api/providers/health',\n  handler: [AsyncFunction (anonymous)],\n  role: 'teacher'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'providers/health',\n  url: 'http://localhost/api/providers/health',\n  handler: [AsyncFunction (anonymous)],\n  role: 'teacher'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":36,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'providers/health',\n  url: 'http://localhost/api/providers/health',\n  handler: [AsyncFunction (anonymous)],\n  role: 'parent'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'providers/health',\n  url: 'http://localhost/api/providers/health',\n  handler: [AsyncFunction (anonymous)],\n  role: 'parent'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":32,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'providers/health',\n  url: 'http://localhost/api/providers/health',\n  handler: [AsyncFunction (anonymous)],\n  role: 'admin'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'providers/health',\n  url: 'http://localhost/api/providers/health',\n  handler: [AsyncFunction (anonymous)],\n  role: 'admin'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":30,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'registry/courses',\n  url: 'http://localhost/api/registry/courses',\n  handler: [AsyncFunction (anonymous)],\n  role: 'student'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'registry/courses',\n  url: 'http://localhost/api/registry/courses',\n  handler: [AsyncFunction (anonymous)],\n  role: 'student'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":35,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'registry/courses',\n  url: 'http://localhost/api/registry/courses',\n  handler: [AsyncFunction (anonymous)],\n  role: 'teacher'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'registry/courses',\n  url: 'http://localhost/api/registry/courses',\n  handler: [AsyncFunction (anonymous)],\n  role: 'teacher'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":52,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'registry/courses',\n  url: 'http://localhost/api/registry/courses',\n  handler: [AsyncFunction (anonymous)],\n  role: 'parent'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'registry/courses',\n  url: 'http://localhost/api/registry/courses',\n  handler: [AsyncFunction (anonymous)],\n  role: 'parent'\n} as %s"},{"ancestorTitles":["admin/registry/users role guard matrix"],"duration":30,"failureDetails":[],"failureMessages":[],"fullName":"admin/registry/users role guard matrix {\n  name: 'registry/courses',\n  url: 'http://localhost/api/registry/courses',\n  handler: [AsyncFunction (anonymous)],\n  role: 'admin'\n} as %s","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"{\n  name: 'registry/courses',\n  url: 'http://localhost/api/registry/courses',\n  handler: [AsyncFunction (anonymous)],\n  role: 'admin'\n} as %s"}],"endTime":1756202431113,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.role.guard.matrix.extended.spec.ts","startTime":1756202429884,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":[],"duration":133,"failureDetails":[],"failureMessages":[],"fullName":"DropdownMenu opens, item click calls handler and closes","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"DropdownMenu opens, item click calls handler and closes"}],"endTime":1756202431572,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\DropdownMenu.spec.tsx","startTime":1756202431134,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["System Diagnostics Suite (labs)"],"duration":71,"failureDetails":[],"failureMessages":[],"fullName":"System Diagnostics Suite (labs) renders batch cards and overall stats under jitter","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"renders batch cards and overall stats under jitter"}],"endTime":1756202431962,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemDiagnosticsSuite.spec.tsx","startTime":1756202431582,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":[],"duration":68,"failureDetails":[],"failureMessages":[],"fullName":"fires telemetry on primary click","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"fires telemetry on primary click"}],"endTime":1756202432337,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\telemetry.spec.tsx","startTime":1756202431973,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["System Health (labs)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"System Health (labs) stubs /api/health","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"stubs /api/health"}],"endTime":1756202432494,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemHealth.spec.tsx","startTime":1756202432342,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["System Observer (labs)"],"duration":83,"failureDetails":[],"failureMessages":[],"fullName":"System Observer (labs) renders sample count and percentiles with jitter","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"renders sample count and percentiles with jitter"}],"endTime":1756202432938,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemObserver.spec.tsx","startTime":1756202432511,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Student Planner (gateways)"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"Student Planner (gateways) stubs enrollments and lessons endpoints","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"stubs enrollments and lessons endpoints"}],"endTime":1756202433653,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\StudentPlanner.spec.tsx","startTime":1756202432955,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":[],"duration":61,"failureDetails":[],"failureMessages":[],"fullName":"DarkModeToggle toggles aria-pressed and document class","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"DarkModeToggle toggles aria-pressed and document class"}],"endTime":1756202434215,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\DarkModeToggle.spec.tsx","startTime":1756202433684,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["System Throughput Profiler (labs)"],"duration":93,"failureDetails":[],"failureMessages":[],"fullName":"System Throughput Profiler (labs) renders bursts with counts and metrics under variable latency","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"renders bursts with counts and metrics under variable latency"}],"endTime":1756202434688,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemThroughputProfiler.spec.tsx","startTime":1756202434233,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["System Percentile Trends (labs)"],"duration":44,"failureDetails":[],"failureMessages":[],"fullName":"System Percentile Trends (labs) renders windows and overall sample count under jitter","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"renders windows and overall sample count under jitter"}],"endTime":1756202435042,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemPercentileTrends.spec.tsx","startTime":1756202434708,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Parent Progress UI (labs)"],"duration":9,"failureDetails":[],"failureMessages":[],"fullName":"Parent Progress UI (labs) renders empty state when no links","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"renders empty state when no links"}],"endTime":1756202435400,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.parent.progress.ui.spec.tsx","startTime":1756202435053,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["System Latency Sampler (labs)"],"duration":52,"failureDetails":[],"failureMessages":[],"fullName":"System Latency Sampler (labs) renders min/avg/max and sample count under jitter","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"renders min/avg/max and sample count under jitter"}],"endTime":1756202435712,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SystemLatencySampler.spec.tsx","startTime":1756202435422,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Student Upcoming Lessons (labs)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Student Upcoming Lessons (labs) stubs enrollments and lessons endpoints","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"stubs enrollments and lessons endpoints"}],"endTime":1756202435985,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\StudentUpcomingLessons.spec.tsx","startTime":1756202435718,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["files routes guards and headers"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"files routes guards and headers prod guard 501 when not TEST_MODE on upload-url","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"prod guard 501 when not TEST_MODE on upload-url"},{"ancestorTitles":["files routes guards and headers"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"files routes guards and headers download-url echoes content-type and request-id","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"download-url echoes content-type and request-id"}],"endTime":1756202436303,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.guards-and-headers.spec.ts","startTime":1756202435994,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Runtime v2 flow (TEST_MODE)"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"Runtime v2 flow (TEST_MODE) exchange -> context -> progress/grade happy path (simulated)","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"exchange -> context -> progress/grade happy path (simulated)"}],"endTime":1756202436598,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.v2.spec.ts","startTime":1756202436308,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Problem responses echo x-request-id"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Problem responses echo x-request-id route http://localhost/api/progress","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"route http://localhost/api/progress"},{"ancestorTitles":["Problem responses echo x-request-id"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Problem responses echo x-request-id route http://localhost/api/progress?course_id=aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&per_student=1","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"route http://localhost/api/progress?course_id=aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa&per_student=1"}],"endTime":1756202436781,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.progress.request-id.spec.ts","startTime":1756202436604,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["GET /api/progress per_student=1 aggregates"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"GET /api/progress per_student=1 aggregates forbidden for non-teacher","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"forbidden for non-teacher"},{"ancestorTitles":["GET /api/progress per_student=1 aggregates"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"GET /api/progress per_student=1 aggregates teacher returns empty students in TEST_MODE","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"teacher returns empty students in TEST_MODE"}],"endTime":1756202436949,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.progress.per-student.spec.ts","startTime":1756202436785,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Notifications Inbox Page"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Notifications Inbox Page renders empty state","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"renders empty state"}],"endTime":1756202437222,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\NotificationsInboxPage.spec.tsx","startTime":1756202436954,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["common headers (x-request-id, content-type) on GETs"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"common headers (x-request-id, content-type) on GETs {\n  name: 'courses',\n  url: 'http://localhost/api/courses',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"{\n  name: 'courses',\n  url: 'http://localhost/api/courses',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id"},{"ancestorTitles":["common headers (x-request-id, content-type) on GETs"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"common headers (x-request-id, content-type) on GETs {\n  name: 'lessons',\n  url: 'http://localhost/api/lessons',\n  handler: [AsyncFunction: GET]\n} responds with x-request-id","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"{\n  name: 'lessons',\n  url: 'http://localhost/api/lessons',\n  handler: [AsyncFunction: GET]\n} responds with x-request-id"},{"ancestorTitles":["common headers (x-request-id, content-type) on GETs"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"common headers (x-request-id, content-type) on GETs {\n  name: 'modules',\n  url: 'http://localhost/api/modules',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"{\n  name: 'modules',\n  url: 'http://localhost/api/modules',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id"},{"ancestorTitles":["common headers (x-request-id, content-type) on GETs"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"common headers (x-request-id, content-type) on GETs {\n  name: 'assignments',\n  url: 'http://localhost/api/assignments?course_id=00000000-0000-0000-0000-000000000001',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"{\n  name: 'assignments',\n  url: 'http://localhost/api/assignments?course_id=00000000-0000-0000-0000-000000000001',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id"},{"ancestorTitles":["common headers (x-request-id, content-type) on GETs"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"common headers (x-request-id, content-type) on GETs {\n  name: 'quizzes',\n  url: 'http://localhost/api/quizzes?course_id=00000000-0000-0000-0000-000000000001',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"{\n  name: 'quizzes',\n  url: 'http://localhost/api/quizzes?course_id=00000000-0000-0000-0000-000000000001',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id"},{"ancestorTitles":["common headers (x-request-id, content-type) on GETs"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"common headers (x-request-id, content-type) on GETs {\n  name: 'quiz-questions',\n  url: 'http://localhost/api/quiz-questions?quiz_id=00000000-0000-0000-0000-000000000001',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"{\n  name: 'quiz-questions',\n  url: 'http://localhost/api/quiz-questions?quiz_id=00000000-0000-0000-0000-000000000001',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id"},{"ancestorTitles":["common headers (x-request-id, content-type) on GETs"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"common headers (x-request-id, content-type) on GETs {\n  name: 'threads',\n  url: 'http://localhost/api/messages/threads',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"{\n  name: 'threads',\n  url: 'http://localhost/api/messages/threads',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id"},{"ancestorTitles":["common headers (x-request-id, content-type) on GETs"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"common headers (x-request-id, content-type) on GETs {\n  name: 'dashboard',\n  url: 'http://localhost/api/dashboard',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"{\n  name: 'dashboard',\n  url: 'http://localhost/api/dashboard',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id"},{"ancestorTitles":["common headers (x-request-id, content-type) on GETs"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"common headers (x-request-id, content-type) on GETs {\n  name: 'notifications',\n  url: 'http://localhost/api/notifications',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"{\n  name: 'notifications',\n  url: 'http://localhost/api/notifications',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id"},{"ancestorTitles":["common headers (x-request-id, content-type) on GETs"],"duration":10,"failureDetails":[],"failureMessages":[],"fullName":"common headers (x-request-id, content-type) on GETs {\n  name: 'providers/health',\n  url: 'http://localhost/api/providers/health',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"{\n  name: 'providers/health',\n  url: 'http://localhost/api/providers/health',\n  handler: [AsyncFunction (anonymous)]\n} responds with x-request-id"}],"endTime":1756202437506,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.headers.common.matrix.spec.ts","startTime":1756202437225,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["courses transfer-owner rate-limit headers"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"courses transfer-owner rate-limit headers returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"returns 429 with standard headers when limited"}],"endTime":1756202437645,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.courses.transfer-owner.ratelimit.spec.ts","startTime":1756202437510,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["withRouteTiming observability"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"withRouteTiming observability route_success logs and echoes requestId","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"route_success logs and echoes requestId"},{"ancestorTitles":["withRouteTiming observability"],"duration":10,"failureDetails":[],"failureMessages":[],"fullName":"withRouteTiming observability route_error logs includes requestId when thrown","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"route_error logs includes requestId when thrown"}],"endTime":1756202437777,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.routeTiming.spec.ts","startTime":1756202437659,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["progress RLS/ownership negatives"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"progress RLS/ownership negatives teacher cannot view per-student for another teacher course","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"teacher cannot view per-student for another teacher course"},{"ancestorTitles":["progress RLS/ownership negatives"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"progress RLS/ownership negatives student cannot view others progress (for_teacher=1 denied)","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"student cannot view others progress (for_teacher=1 denied)"}],"endTime":1756202437906,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.progress.rls.negatives.spec.ts","startTime":1756202437790,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["registry versions rate limit headers"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"registry versions rate limit headers tight limit returns 429 with standard headers","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"tight limit returns 429 with standard headers"}],"endTime":1756202438041,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.registry.versions.rate-limit.spec.ts","startTime":1756202437919,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["quiz-choices DTO + headers"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"quiz-choices DTO + headers POST returns x-request-id or guard status","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"POST returns x-request-id or guard status"},{"ancestorTitles":["quiz-choices DTO + headers"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"quiz-choices DTO + headers GET returns x-request-id and JSON or guards","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"GET returns x-request-id and JSON or guards"}],"endTime":1756202438205,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.quiz-choices.dto.spec.ts","startTime":1756202438053,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["PATCH /api/assignments missing id"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"PATCH /api/assignments missing id returns 400 and echoes x-request-id","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"returns 400 and echoes x-request-id"}],"endTime":1756202438323,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.assignments.patch-missing-id.spec.ts","startTime":1756202438216,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["scheduler ensureJobsStarted"],"duration":111,"failureDetails":[],"failureMessages":[],"fullName":"scheduler ensureJobsStarted does not schedule when DUE_SOON_JOB != 1","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"does not schedule when DUE_SOON_JOB != 1"},{"ancestorTitles":["scheduler ensureJobsStarted"],"duration":22,"failureDetails":[],"failureMessages":[],"fullName":"scheduler ensureJobsStarted schedules when env set","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"schedules when env set"}],"endTime":1756202438614,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\server.scheduler.spec.ts","startTime":1756202438335,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime asset sign-url rate-limit headers"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"runtime asset sign-url rate-limit headers returns 200 first, then 429 with standard headers","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"returns 200 first, then 429 with standard headers"}],"endTime":1756202438812,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.asset.sign-url.ratelimit.spec.ts","startTime":1756202438619,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["grade distribution empty course (TEST_MODE)"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"grade distribution empty course (TEST_MODE) returns zero metrics; csv has only header","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"returns zero metrics; csv has only header"}],"endTime":1756202438991,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.reports.grade-distribution.empty.spec.ts","startTime":1756202438815,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Settings Page (gateways)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Settings Page (gateways) stubs profile and preferences endpoints","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"stubs profile and preferences endpoints"}],"endTime":1756202439303,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\SettingsPage.spec.tsx","startTime":1756202438997,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["messages list pagination params"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"messages list pagination params non-numeric values clamp to defaults, 200 includes x-total-count","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"non-numeric values clamp to defaults, 200 includes x-total-count"}],"endTime":1756202439505,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.list.pagination.params.spec.ts","startTime":1756202439316,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["services.submissions queue (test-mode)"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"services.submissions queue (test-mode) filters by course/assignment, paginates, sorts by submitted_at desc","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"filters by course/assignment, paginates, sorts by submitted_at desc"},{"ancestorTitles":["services.submissions queue (test-mode)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"services.submissions queue (test-mode) empty-state when no courses","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"empty-state when no courses"}],"endTime":1756202439681,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.submissions.queue.spec.ts","startTime":1756202439524,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["messages GET rate-limit headers"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"messages GET rate-limit headers 429 includes retry-after and x-rate-limit-* headers","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"429 includes retry-after and x-rate-limit-* headers"}],"endTime":1756202439872,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.ratelimit.headers.spec.ts","startTime":1756202439699,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["quiz-questions DTO + headers"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"quiz-questions DTO + headers POST returns x-request-id or guard status","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"POST returns x-request-id or guard status"},{"ancestorTitles":["quiz-questions DTO + headers"],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"quiz-questions DTO + headers GET returns x-request-id and JSON or guards","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"GET returns x-request-id and JSON or guards"}],"endTime":1756202440048,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.quiz-questions.dto.spec.ts","startTime":1756202439892,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Problem envelope invariants"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"Problem envelope invariants 401 responses include error envelope and x-request-id","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"401 responses include error envelope and x-request-id"},{"ancestorTitles":["Problem envelope invariants"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Problem envelope invariants 400 bad request includes envelope","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"400 bad request includes envelope"}],"endTime":1756202440256,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.problem-envelope.matrix.spec.ts","startTime":1756202440064,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["reports engagement headers"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"reports engagement headers csv format sets content-type (or returns 400/401 when invalid)","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"csv format sets content-type (or returns 400/401 when invalid)"}],"endTime":1756202440412,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.reports.engagement.headers.spec.ts","startTime":1756202440269,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["User profile API"],"duration":22,"failureDetails":[],"failureMessages":[],"fullName":"User profile API GET returns test profile in test-mode; PUT validates bad payload","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"GET returns test profile in test-mode; PUT validates bad payload"}],"endTime":1756202440548,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.user-profile.spec.ts","startTime":1756202440424,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["GET /api/submissions requires assignment_id and auth"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"GET /api/submissions requires assignment_id and auth 401 when unauth; 400 when missing assignment_id","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"401 when unauth; 400 when missing assignment_id"}],"endTime":1756202440713,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.submissions.get-required.spec.ts","startTime":1756202440562,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Messages read-all RLS negatives"],"duration":23,"failureDetails":[],"failureMessages":[],"fullName":"Messages read-all RLS negatives unauthenticated cannot mark read-all","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"unauthenticated cannot mark read-all"}],"endTime":1756202440868,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\db.rls.messages.readall.negative.spec.ts","startTime":1756202440725,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime auth: audience and scopes"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"runtime auth: audience and scopes when origin is allowed, audience mismatch yields 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"when origin is allowed, audience mismatch yields 403"},{"ancestorTitles":["runtime auth: audience and scopes"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"runtime auth: audience and scopes missing required scope yields 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"missing required scope yields 403"}],"endTime":1756202441001,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.auth.aud-and-scopes.spec.ts","startTime":1756202440879,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["providers create/update/delete rate-limit headers"],"duration":8,"failureDetails":[],"failureMessages":[],"fullName":"providers create/update/delete rate-limit headers POST returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"POST returns 429 with standard headers when limited"},{"ancestorTitles":["providers create/update/delete rate-limit headers"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"providers create/update/delete rate-limit headers PATCH returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"PATCH returns 429 with standard headers when limited"},{"ancestorTitles":["providers create/update/delete rate-limit headers"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"providers create/update/delete rate-limit headers DELETE returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"DELETE returns 429 with standard headers when limited"}],"endTime":1756202441195,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.providers.ratelimit.spec.ts","startTime":1756202441013,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["listing endpoints include x-total-count when 200"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"listing endpoints include x-total-count when 200 assignments","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"assignments"},{"ancestorTitles":["listing endpoints include x-total-count when 200"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"listing endpoints include x-total-count when 200 submissions","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"submissions"},{"ancestorTitles":["listing endpoints include x-total-count when 200"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"listing endpoints include x-total-count when 200 messages","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"messages"},{"ancestorTitles":["listing endpoints include x-total-count when 200"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"listing endpoints include x-total-count when 200 threads","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"threads"},{"ancestorTitles":["listing endpoints include x-total-count when 200"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"listing endpoints include x-total-count when 200 quizzes","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"quizzes"}],"endTime":1756202441409,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.listing.headers.matrix.spec.ts","startTime":1756202441213,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":[],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"createLessonApi creates and lists for course in test-mode","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"createLessonApi creates and lists for course in test-mode"},{"ancestorTitles":[],"duration":36,"failureDetails":[],"failureMessages":[],"fullName":"reorder lessons route applies new order","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"reorder lessons route applies new order"}],"endTime":1756202441630,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.lessons.spec.ts","startTime":1756202441414,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["serverFetch extended"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"serverFetch extended absolute URL passes through unchanged","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"absolute URL passes through unchanged"},{"ancestorTitles":["serverFetch extended"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"serverFetch extended caller x-request-id overrides upstream header","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"caller x-request-id overrides upstream header"}],"endTime":1756202441792,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.serverFetch.extend.spec.ts","startTime":1756202441635,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["user role PATCH headers"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"user role PATCH headers x-request-id present on 2xx or guard response","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"x-request-id present on 2xx or guard response"}],"endTime":1756202442009,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.user.role.headers.spec.ts","startTime":1756202441800,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["assignments DELETE rate-limit headers"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"assignments DELETE rate-limit headers returns 429 with standard headers when rate-limited","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"returns 429 with standard headers when rate-limited"}],"endTime":1756202442196,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.assignments.delete.ratelimit.spec.ts","startTime":1756202442014,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["files download-url DEV_ID guard"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"files download-url DEV_ID guard when DEV_ID set and key lacks prefix -> 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"when DEV_ID set and key lacks prefix -> 403"}],"endTime":1756202442574,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.download-url.dev-namespace.spec.ts","startTime":1756202442212,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["PATCH /api/assignments empty body validation"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"PATCH /api/assignments empty body validation returns 400 when body has no fields","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"returns 400 when body has no fields"}],"endTime":1756202442747,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.assignments.patch-empty-body.spec.ts","startTime":1756202442580,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["withRouteTiming CSRF and double-submit token"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"withRouteTiming CSRF and double-submit token rejects cross-origin POST with 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"rejects cross-origin POST with 403"},{"ancestorTitles":["withRouteTiming CSRF and double-submit token"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"withRouteTiming CSRF and double-submit token double-submit token enforced when enabled","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"double-submit token enforced when enabled"}],"endTime":1756202442942,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\server.withRouteTiming.csrf.spec.ts","startTime":1756202442752,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["announcement schemas"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"announcement schemas announcementCreateRequest valid","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"announcementCreateRequest valid"},{"ancestorTitles":["announcement schemas"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"announcement schemas announcementCreateRequest invalid when missing fields","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"announcementCreateRequest invalid when missing fields"},{"ancestorTitles":["announcement schemas"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"announcement schemas announcement schema shape","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"announcement schema shape"},{"ancestorTitles":["announcement schemas"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"announcement schemas announcementDeleteRequest validates id","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"announcementDeleteRequest validates id"}],"endTime":1756202443087,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.announcement.spec.ts","startTime":1756202442947,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["api.providers GET"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"api.providers GET requires auth","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"requires auth"},{"ancestorTitles":["api.providers GET"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"api.providers GET returns list for authenticated user","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"returns list for authenticated user"}],"endTime":1756202443227,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.providers.get.spec.ts","startTime":1756202443090,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["messages threads rate-limit headers"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"messages threads rate-limit headers POST returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"POST returns 429 with standard headers when limited"},{"ancestorTitles":["messages threads rate-limit headers"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"messages threads rate-limit headers GET returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"GET returns 429 with standard headers when limited"}],"endTime":1756202443372,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.threads.ratelimit.spec.ts","startTime":1756202443231,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["threads rate-limit headers"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"threads rate-limit headers GET rate-limit returns headers on 429","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"GET rate-limit returns headers on 429"},{"ancestorTitles":["threads rate-limit headers"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"threads rate-limit headers POST rate-limit returns headers on 429","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"POST rate-limit returns headers on 429"}],"endTime":1756202443512,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.threads.ratelimit.headers.spec.ts","startTime":1756202443375,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["GET /api/assignments query validation"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"GET /api/assignments query validation rejects unknown query keys (strict)","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"rejects unknown query keys (strict)"}],"endTime":1756202443734,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.assignments.query-strict.spec.ts","startTime":1756202443515,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Labs/Teacher Course Insights pages"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Labs/Teacher Course Insights pages stubs /api/courses and /api/lessons for insights and pro pages","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"stubs /api/courses and /api/lessons for insights and pro pages"}],"endTime":1756202443868,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\TeacherCourseInsights.spec.tsx","startTime":1756202443747,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":[],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"createApiHandler validates input and returns 400 on invalid","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"createApiHandler validates input and returns 400 on invalid"},{"ancestorTitles":[],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"createApiHandler passes validated input","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"createApiHandler passes validated input"},{"ancestorTitles":[],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"createApiHandler returns 400 on invalid JSON body when schema present","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"createApiHandler returns 400 on invalid JSON body when schema present"}],"endTime":1756202444030,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\apiHandler.spec.ts","startTime":1756202443873,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime context roles and auth"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"runtime context roles and auth missing token → 401","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"missing token → 401"},{"ancestorTitles":["runtime context roles and auth"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"runtime context roles and auth bad audience when origin allowed → 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"bad audience when origin allowed → 403"}],"endTime":1756202444311,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.context.roles.spec.ts","startTime":1756202444035,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime v2 checkpoint endpoints (spec)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"runtime v2 checkpoint endpoints (spec) POST /api/runtime/checkpoint/save validates size and shape (doc spec)","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"POST /api/runtime/checkpoint/save validates size and shape (doc spec)"},{"ancestorTitles":["runtime v2 checkpoint endpoints (spec)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"runtime v2 checkpoint endpoints (spec) GET /api/runtime/checkpoint/load returns { key, state } or 404 (doc spec)","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"GET /api/runtime/checkpoint/load returns { key, state } or 404 (doc spec)"}],"endTime":1756202444479,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.checkpoint.spec.ts","startTime":1756202444318,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["pagination params clamping"],"duration":10,"failureDetails":[],"failureMessages":[],"fullName":"pagination params clamping assignments clamps negative offset and large limit, returns x-total-count","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"assignments clamps negative offset and large limit, returns x-total-count"}],"endTime":1756202444805,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.pagination.params.spec.ts","startTime":1756202444485,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime grade CORS preflight"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"runtime grade CORS preflight OPTIONS returns 204 and access-control-allow-origin for allowed origin","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"OPTIONS returns 204 and access-control-allow-origin for allowed origin"}],"endTime":1756202445102,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.grade.cors.preflight.spec.ts","startTime":1756202444815,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["CSRF double-submit enforcement (when enabled)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"CSRF double-submit enforcement (when enabled) messages POST: missing tokens → 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"messages POST: missing tokens → 403"},{"ancestorTitles":["CSRF double-submit enforcement (when enabled)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"CSRF double-submit enforcement (when enabled) messages POST: mismatched tokens → 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"messages POST: mismatched tokens → 403"},{"ancestorTitles":["CSRF double-submit enforcement (when enabled)"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"CSRF double-submit enforcement (when enabled) files finalize POST: missing tokens → 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"files finalize POST: missing tokens → 403"}],"endTime":1756202445463,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.csrf.double-submit.spec.ts","startTime":1756202445107,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["withRouteTiming metrics"],"duration":22,"failureDetails":[],"failureMessages":[],"fullName":"withRouteTiming metrics records timing on success and error","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"records timing on success and error"}],"endTime":1756202445607,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\server.withRouteTiming.metrics.spec.ts","startTime":1756202445468,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime context returns x-request-id and DTO-like shape"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"runtime context returns x-request-id and DTO-like shape x-request-id header present and json has required fields or error envelope","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"x-request-id header present and json has required fields or error envelope"}],"endTime":1756202445751,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.context.dto-requestid.spec.ts","startTime":1756202445611,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["notifications read-all"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"notifications read-all marks all read in test-mode","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"marks all read in test-mode"}],"endTime":1756202445895,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.notifications.read-all.spec.ts","startTime":1756202445756,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["messages GET missing thread_id"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"messages GET missing thread_id returns 400 with Problem and echoes request id","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"returns 400 with Problem and echoes request id"}],"endTime":1756202446033,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.missing-thread.spec.ts","startTime":1756202445901,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["middleware headers behavior"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"middleware headers behavior adds x-request-id if missing via a guard response path","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"adds x-request-id if missing via a guard response path"},{"ancestorTitles":["middleware headers behavior"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"middleware headers behavior echoes upstream x-request-id on forbidden x-test-auth path","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"echoes upstream x-request-id on forbidden x-test-auth path"},{"ancestorTitles":["middleware headers behavior"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"middleware headers behavior in production: RUNTIME_API_V2=1 without RS256 keys yields 500","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"in production: RUNTIME_API_V2=1 without RS256 keys yields 500"},{"ancestorTitles":["middleware headers behavior"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"middleware headers behavior in production: missing NEXT_PUBLIC_SUPABASE_* yields 500 with request-id","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"in production: missing NEXT_PUBLIC_SUPABASE_* yields 500 with request-id"},{"ancestorTitles":["middleware headers behavior"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"middleware headers behavior in production: http Supabase URL yields 500 with request-id","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"in production: http Supabase URL yields 500 with request-id"}],"endTime":1756202446139,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\middleware.headers-and-guards.spec.ts","startTime":1756202446037,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["interactive_attempts RLS negatives"],"duration":27,"failureDetails":[],"failureMessages":[],"fullName":"interactive_attempts RLS negatives student cannot access teacher outcomes","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"student cannot access teacher outcomes"}],"endTime":1756202446304,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\db.rls.interactive_attempts.negative.spec.ts","startTime":1756202446143,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["x-request-id present on 200 responses"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"x-request-id present on 200 responses courses GET emits x-request-id","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"courses GET emits x-request-id"}],"endTime":1756202446424,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.request-id.on.success.spec.ts","startTime":1756202446308,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["dashboard DTO validation"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"dashboard DTO validation teacher returns validated DTO","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"teacher returns validated DTO"}],"endTime":1756202446562,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.dashboard.dto.spec.ts","startTime":1756202446427,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Labs/Teacher Analytics page"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Labs/Teacher Analytics page stubs /api/courses and /api/lessons","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"stubs /api/courses and /api/lessons"}],"endTime":1756202446679,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\TeacherAnalyticsLab.spec.tsx","startTime":1756202446572,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["submissions rate limits and headers"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"submissions rate limits and headers POST student create returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"POST student create returns 429 with standard headers when limited"},{"ancestorTitles":["submissions rate limits and headers"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"submissions rate limits and headers PATCH teacher grade returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"PATCH teacher grade returns 429 with standard headers when limited"}],"endTime":1756202446821,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.submissions.rate-limit.spec.ts","startTime":1756202446682,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["CSRF double-submit negatives (when enabled)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"CSRF double-submit negatives (when enabled) missing csrf headers → 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"missing csrf headers → 403"},{"ancestorTitles":["CSRF double-submit negatives (when enabled)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"CSRF double-submit negatives (when enabled) mismatch cookie/header → 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"mismatch cookie/header → 403"}],"endTime":1756202446974,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.csrf.double-submit.negatives.spec.ts","startTime":1756202446825,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["announcements rate-limit headers"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"announcements rate-limit headers POST returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"POST returns 429 with standard headers when limited"},{"ancestorTitles":["announcements rate-limit headers"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"announcements rate-limit headers DELETE returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"DELETE returns 429 with standard headers when limited"}],"endTime":1756202447186,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.announcements.ratelimit.spec.ts","startTime":1756202446979,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/reports/* (TEST_MODE)"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"API /api/reports/* (TEST_MODE) engagement: unauth → 401; missing course_id → 400","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"engagement: unauth → 401; missing course_id → 400"},{"ancestorTitles":["API /api/reports/* (TEST_MODE)"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"API /api/reports/* (TEST_MODE) grade-distribution: unauth → 401; missing course_id → 400; csv content-type","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"grade-distribution: unauth → 401; missing course_id → 400; csv content-type"},{"ancestorTitles":["Reports APIs"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Reports APIs engagement report returns counts for lessons/assignments/submissions","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"engagement report returns counts for lessons/assignments/submissions"},{"ancestorTitles":["Reports APIs"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Reports APIs grade-distribution returns JSON and CSV","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"grade-distribution returns JSON and CSV"}],"endTime":1756202447405,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.reports.spec.ts","startTime":1756202447192,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["GET /api/assignments list"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"GET /api/assignments list requires course_id and auth","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"requires course_id and auth"}],"endTime":1756202447599,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.assignments.list.spec.ts","startTime":1756202447411,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Labs/TeacherCourseCardsWithCounts page"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Labs/TeacherCourseCardsWithCounts page stubs /api/courses and /api/lessons","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"stubs /api/courses and /api/lessons"}],"endTime":1756202447753,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\TeacherCourseCardsWithCounts.spec.tsx","startTime":1756202447610,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["course schemas"],"duration":10,"failureDetails":[],"failureMessages":[],"fullName":"course schemas courseCreateRequest validates fields","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"courseCreateRequest validates fields"},{"ancestorTitles":["course schemas"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"course schemas courseUpdateRequest requires at least one field","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"courseUpdateRequest requires at least one field"}],"endTime":1756202447910,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.course.spec.ts","startTime":1756202447758,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["createApiHandler global mutation rate limit headers"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"createApiHandler global mutation rate limit headers second request from same IP returns 429 with standard headers","invocations":1,"location":null,"numPassingAsserts":6,"retryReasons":[],"status":"passed","title":"second request from same IP returns 429 with standard headers"}],"endTime":1756202448057,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\apiHandler.ratelimit.spec.ts","startTime":1756202447913,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["internal metrics auth"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"internal metrics auth rejects without token; accepts with correct token","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"rejects without token; accepts with correct token"}],"endTime":1756202448255,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.internal.metrics.auth.spec.ts","startTime":1756202448060,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Admin export API"],"duration":10,"failureDetails":[],"failureMessages":[],"fullName":"Admin export API 401/403/400","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"401/403/400"},{"ancestorTitles":["Admin export API"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Admin export API json and csv formats","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"json and csv formats"},{"ancestorTitles":["Admin export API"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Admin export API DB error -> 500 (covers select call path)","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"DB error -> 500 (covers select call path)"}],"endTime":1756202448468,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.admin.export.spec.ts","startTime":1756202448259,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["api.dashboard teacher KPIs"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"api.dashboard teacher KPIs needsGrading scoped to teacher courses; zero-state; request-id echo","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"needsGrading scoped to teacher courses; zero-state; request-id echo"}],"endTime":1756202448671,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.dashboard.teacher-kpis.spec.ts","startTime":1756202448473,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["quiz schemas"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"quiz schemas quizCreateRequest valid","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"quizCreateRequest valid"},{"ancestorTitles":["quiz schemas"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"quiz schemas quizUpdateRequest requires at least one field","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"quizUpdateRequest requires at least one field"},{"ancestorTitles":["quiz schemas"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"quiz schemas question and choice valid","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"question and choice valid"},{"ancestorTitles":["quiz schemas"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"quiz schemas attempt schemas valid","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"attempt schemas valid"}],"endTime":1756202448810,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.quiz.spec.ts","startTime":1756202448674,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Events API (future)"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"Events API (future) POST /api/events accepts valid payload and returns 204","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"todo","title":"POST /api/events accepts valid payload and returns 204"}],"endTime":1756202448929,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.events.spec.ts","startTime":1756202448814,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["role-based access matrix (dashboard, users)"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"role-based access matrix (dashboard, users) dashboard GET as student","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"dashboard GET as student"},{"ancestorTitles":["role-based access matrix (dashboard, users)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"role-based access matrix (dashboard, users) dashboard GET as teacher","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"dashboard GET as teacher"},{"ancestorTitles":["role-based access matrix (dashboard, users)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"role-based access matrix (dashboard, users) dashboard GET as parent","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"dashboard GET as parent"},{"ancestorTitles":["role-based access matrix (dashboard, users)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"role-based access matrix (dashboard, users) dashboard GET as admin","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"dashboard GET as admin"},{"ancestorTitles":["role-based access matrix (dashboard, users)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"role-based access matrix (dashboard, users) users GET as student","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"users GET as student"},{"ancestorTitles":["role-based access matrix (dashboard, users)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"role-based access matrix (dashboard, users) users GET as teacher","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"users GET as teacher"},{"ancestorTitles":["role-based access matrix (dashboard, users)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"role-based access matrix (dashboard, users) users GET as parent","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"users GET as parent"},{"ancestorTitles":["role-based access matrix (dashboard, users)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"role-based access matrix (dashboard, users) users GET as admin","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"users GET as admin"}],"endTime":1756202449056,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.role.access.matrix.spec.ts","startTime":1756202448933,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["providers list DTO + headers"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"providers list DTO + headers GET /api/providers returns x-request-id and JSON array or 401/403","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"GET /api/providers returns x-request-id and JSON array or 401/403"}],"endTime":1756202449186,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.providers.list.dto.spec.ts","startTime":1756202449061,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["messages threads scoping"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"messages threads scoping threads list is scoped to current user (sanity check)","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"threads list is scoped to current user (sanity check)"}],"endTime":1756202449327,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.scoping.spec.ts","startTime":1756202449190,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["serverFetch headers and fetchJson"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"serverFetch headers and fetchJson propagates x-request-id and x-test-auth and builds absolute URL","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"propagates x-request-id and x-test-auth and builds absolute URL"},{"ancestorTitles":["serverFetch headers and fetchJson"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"serverFetch headers and fetchJson does not attach x-csrf-token on GET even when cookie present","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"does not attach x-csrf-token on GET even when cookie present"},{"ancestorTitles":["serverFetch headers and fetchJson"],"duration":9,"failureDetails":[],"failureMessages":[],"fullName":"serverFetch headers and fetchJson fetchJson throws with server error code and message","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"fetchJson throws with server error code and message"}],"endTime":1756202449501,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.serverFetch.headers.spec.ts","startTime":1756202449331,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["providers POST happy path"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"providers POST happy path https jwks and domain -> 201","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"https jwks and domain -> 201"}],"endTime":1756202449699,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.providers.create.happy-path.spec.ts","startTime":1756202449509,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["idempotency TTL behavior (in-memory fallback)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"idempotency TTL behavior (in-memory fallback) returns false first time, true within TTL, false after expiration","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"returns false first time, true within TTL, false after expiration"}],"endTime":1756202449893,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.idempotency.ttl.spec.ts","startTime":1756202449709,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["GET /api/progress student map"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"GET /api/progress student map requires auth (401 Problem)","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"requires auth (401 Problem)"},{"ancestorTitles":["GET /api/progress student map"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"GET /api/progress student map returns student map (empty in TEST_MODE) and echoes request-id","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"returns student map (empty in TEST_MODE) and echoes request-id"},{"ancestorTitles":["GET /api/progress student map"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"GET /api/progress student map 400 when course_id missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"400 when course_id missing"}],"endTime":1756202450107,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.progress.student-map.spec.ts","startTime":1756202449896,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["notifications preferences DTO + headers"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"notifications preferences DTO + headers GET returns x-request-id and JSON map","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"GET returns x-request-id and JSON map"},{"ancestorTitles":["notifications preferences DTO + headers"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"notifications preferences DTO + headers PATCH returns x-request-id and JSON map","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"PATCH returns x-request-id and JSON map"}],"endTime":1756202450318,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.notifications.prefs.dto.spec.ts","startTime":1756202450113,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["registry courses GET rate-limit headers"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"registry courses GET rate-limit headers returns 429 with rate-limit headers when limited","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"returns 429 with rate-limit headers when limited"}],"endTime":1756202450505,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.registry.courses.rate-limit.spec.ts","startTime":1756202450322,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["internal metrics endpoint content-type"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"internal metrics endpoint content-type returns Prometheus text format with correct content-type","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"returns Prometheus text format with correct content-type"}],"endTime":1756202450680,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.internal.metrics.content-type.spec.ts","startTime":1756202450510,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["assignments DELETE rate-limit headers"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"assignments DELETE rate-limit headers when throttled, includes retry-after and x-rate-limit-*","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"when throttled, includes retry-after and x-rate-limit-*"}],"endTime":1756202450840,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.assignments.delete.ratelimit.headers.spec.ts","startTime":1756202450685,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["api.teacher.grading-queue"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"api.teacher.grading-queue rejects unauth requests","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"rejects unauth requests"},{"ancestorTitles":["api.teacher.grading-queue"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"api.teacher.grading-queue rejects non-teacher","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"rejects non-teacher"},{"ancestorTitles":["api.teacher.grading-queue"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"api.teacher.grading-queue validates query and paginates","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"validates query and paginates"}],"endTime":1756202451013,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.teacher.grading-queue.spec.ts","startTime":1756202450843,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["modules DELETE rate-limit headers"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"modules DELETE rate-limit headers returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"returns 429 with standard headers when limited"}],"endTime":1756202451171,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.modules.delete.ratelimit.spec.ts","startTime":1756202451019,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Notifications preferences RLS negatives"],"duration":25,"failureDetails":[],"failureMessages":[],"fullName":"Notifications preferences RLS negatives unauthenticated cannot update preferences","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"unauthenticated cannot update preferences"}],"endTime":1756202451319,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\db.rls.notifications.negative.spec.ts","startTime":1756202451174,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["GET /api/progress for_teacher=1"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"GET /api/progress for_teacher=1 teacher counts path returns 200 with counts object","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"teacher counts path returns 200 with counts object"}],"endTime":1756202451449,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.progress.teacher-counts.spec.ts","startTime":1756202451324,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["parent-links headers & guards"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"parent-links headers & guards POST returns x-request-id or 401/403 with header","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"POST returns x-request-id or 401/403 with header"},{"ancestorTitles":["parent-links headers & guards"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"parent-links headers & guards GET returns x-request-id","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"GET returns x-request-id"}],"endTime":1756202451572,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.parent-links.headers.spec.ts","startTime":1756202451453,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime v2 gating"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"runtime v2 gating returns 403 when RUNTIME_API_V2 is disabled","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"returns 403 when RUNTIME_API_V2 is disabled"}],"endTime":1756202451672,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.gating.spec.ts","startTime":1756202451577,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["api.files.download-url"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"api.files.download-url requires auth","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"requires auth"},{"ancestorTitles":["api.files.download-url"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"api.files.download-url returns 400 when id missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"returns 400 when id missing"}],"endTime":1756202451817,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.download-url.spec.ts","startTime":1756202451675,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Messages/Threads RLS negatives"],"duration":38,"failureDetails":[],"failureMessages":[],"fullName":"Messages/Threads RLS negatives unauthenticated cannot list threads","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"unauthenticated cannot list threads"},{"ancestorTitles":["Messages/Threads RLS negatives"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"Messages/Threads RLS negatives non-participant cannot create thread for others only (route enforces inclusion)","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"non-participant cannot create thread for others only (route enforces inclusion)"}],"endTime":1756202451965,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\db.rls.messages.negative.spec.ts","startTime":1756202451821,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["registry mutations rate-limit headers"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"registry mutations rate-limit headers courses POST returns 429 headers when limited","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"courses POST returns 429 headers when limited"},{"ancestorTitles":["registry mutations rate-limit headers"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"registry mutations rate-limit headers courses PATCH returns 429 headers when limited","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"courses PATCH returns 429 headers when limited"},{"ancestorTitles":["registry mutations rate-limit headers"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"registry mutations rate-limit headers courses DELETE returns 429 headers when limited","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"courses DELETE returns 429 headers when limited"},{"ancestorTitles":["registry mutations rate-limit headers"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"registry mutations rate-limit headers versions POST returns 429 headers when limited","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"versions POST returns 429 headers when limited"},{"ancestorTitles":["registry mutations rate-limit headers"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"registry mutations rate-limit headers versions PATCH returns 429 headers when limited","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"versions PATCH returns 429 headers when limited"}],"endTime":1756202452175,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.registry.mutations.ratelimit.spec.ts","startTime":1756202451971,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime v2 per-endpoint rate limiting"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"runtime v2 per-endpoint rate limiting progress POST returns 429 with headers after exceeding limit (env-driven)","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"progress POST returns 429 with headers after exceeding limit (env-driven)"}],"endTime":1756202452417,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.rate-limit.spec.ts","startTime":1756202452181,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Labs/Parent Announcements page"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Labs/Parent Announcements page stubs parent-links and announcements","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"stubs parent-links and announcements"}],"endTime":1756202452579,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\ParentAnnouncementsLab.spec.tsx","startTime":1756202452445,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":[],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"createCourseApi creates and lists for teacher in test-mode","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"createCourseApi creates and lists for teacher in test-mode"}],"endTime":1756202452756,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.courses.spec.ts","startTime":1756202452586,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["assignments service (test-mode)"],"duration":13,"failureDetails":[],"failureMessages":[],"fullName":"assignments service (test-mode) create, list order by created_at desc","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"create, list order by created_at desc"},{"ancestorTitles":["assignments service (test-mode)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"assignments service (test-mode) update and delete assignment","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"update and delete assignment"}],"endTime":1756202452953,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.assignments.spec.ts","startTime":1756202452761,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["progress schemas"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"progress schemas MarkLessonCompleteRequest completed defaults to true","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"MarkLessonCompleteRequest completed defaults to true"},{"ancestorTitles":["progress schemas"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"progress schemas per-student aggregate shape via courseProgress and response","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"per-student aggregate shape via courseProgress and response"}],"endTime":1756202453103,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.progress.spec.ts","startTime":1756202452958,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["server env runtime keys (production fail-fast)"],"duration":11,"failureDetails":[],"failureMessages":[],"fullName":"server env runtime keys (production fail-fast) throws in production when RUNTIME_API_V2=1 and RS256 keys missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"throws in production when RUNTIME_API_V2=1 and RS256 keys missing"},{"ancestorTitles":["server env runtime keys (production fail-fast)"],"duration":12,"failureDetails":[],"failureMessages":[],"fullName":"server env runtime keys (production fail-fast) succeeds in production when RS256 keys are present","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"succeeds in production when RS256 keys are present"}],"endTime":1756202453253,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.env.runtime-keys.required.spec.ts","startTime":1756202453107,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["CSP frame-src extension via RUNTIME_FRAME_SRC_ALLOW"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"CSP frame-src extension via RUNTIME_FRAME_SRC_ALLOW extends frame-src when NEXT_PUBLIC_CSP unset (guard path)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"extends frame-src when NEXT_PUBLIC_CSP unset (guard path)"}],"endTime":1756202453361,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.csp.frame-src-allow.spec.ts","startTime":1756202453259,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Admin metrics API"],"duration":10,"failureDetails":[],"failureMessages":[],"fullName":"Admin metrics API 401/403 and 200 snapshot","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"401/403 and 200 snapshot"}],"endTime":1756202453658,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.admin.metrics.spec.ts","startTime":1756202453373,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["testStore edge cases"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"testStore edge cases messages create, list ordered, mark read and compute unread counts","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"messages create, list ordered, mark read and compute unread counts"},{"ancestorTitles":["testStore edge cases"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"testStore edge cases notifications add, list, and mark all read","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"notifications add, list, and mark all read"},{"ancestorTitles":["testStore edge cases"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"testStore edge cases files add and get","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"files add and get"},{"ancestorTitles":["testStore edge cases"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"testStore edge cases quizzes: deleting a quiz cascades its questions","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"quizzes: deleting a quiz cascades its questions"}],"endTime":1756202453989,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\testStore.edgecases.spec.ts","startTime":1756202453699,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["notification schemas"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"notification schemas notification valid","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"notification valid"},{"ancestorTitles":["notification schemas"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"notification schemas notificationMarkReadRequest default true","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"notificationMarkReadRequest default true"}],"endTime":1756202454114,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.notification.spec.ts","startTime":1756202454003,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["registry versions DTO + headers"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"registry versions DTO + headers GET /api/registry/versions returns x-request-id and optionally x-total-count","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"GET /api/registry/versions returns x-request-id and optionally x-total-count"}],"endTime":1756202454248,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.registry.versions.dto.spec.ts","startTime":1756202454118,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["zodQuery.parseQuery"],"duration":8,"failureDetails":[],"failureMessages":[],"fullName":"zodQuery.parseQuery parses from string and enforces strict schema","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"parses from string and enforces strict schema"},{"ancestorTitles":["zodQuery.parseQuery"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"zodQuery.parseQuery when multiple values for same key, last wins","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"when multiple values for same key, last wins"}],"endTime":1756202454405,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.zodQuery.spec.ts","startTime":1756202454252,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/messages/threads (TEST_MODE)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"API /api/messages/threads (TEST_MODE) unauth list → 401","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"unauth list → 401"},{"ancestorTitles":["API /api/messages/threads (TEST_MODE)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"API /api/messages/threads (TEST_MODE) create thread and list with unread count","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"create thread and list with unread count"}],"endTime":1756202454555,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.threads.spec.ts","startTime":1756202454411,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Response DTO validation on 2xx"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"Response DTO validation on 2xx dashboard GET returns 2xx with x-request-id","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"dashboard GET returns 2xx with x-request-id"},{"ancestorTitles":["Response DTO validation on 2xx"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"Response DTO validation on 2xx lessons/complete POST returns 200 with x-request-id when valid","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"lessons/complete POST returns 200 with x-request-id when valid"}],"endTime":1756202454739,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.dto.enforced.on.success.spec.ts","startTime":1756202454559,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["SubmissionsGateway contract"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"SubmissionsGateway contract create validates response shape","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"create validates response shape"},{"ancestorTitles":["SubmissionsGateway contract"],"duration":15,"failureDetails":[],"failureMessages":[],"fullName":"SubmissionsGateway contract invalid response shape throws","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"invalid response shape throws"}],"endTime":1756202454924,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\gateways\\SubmissionsGateway.contract.spec.ts","startTime":1756202454744,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["submissions queue pagination"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"submissions queue pagination pages are consistent and ordered desc by submitted_at","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"pages are consistent and ordered desc by submitted_at"}],"endTime":1756202455140,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.submissions.queue.pagination.spec.ts","startTime":1756202454931,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["services.messaging (test-store)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"services.messaging (test-store) thread create, participants list, send message, read receipts, unread counts","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"thread create, participants list, send message, read receipts, unread counts"}],"endTime":1756202455341,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.messaging.spec.ts","startTime":1756202455148,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Observability & Ops"],"duration":29,"failureDetails":[],"failureMessages":[],"fullName":"Observability & Ops withRouteTiming sets x-request-id header for success","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"withRouteTiming sets x-request-id header for success"},{"ancestorTitles":["Observability & Ops"],"duration":8,"failureDetails":[],"failureMessages":[],"fullName":"Observability & Ops withRouteTiming rethrows and logs on error but still generates request id","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"withRouteTiming rethrows and logs on error but still generates request id"},{"ancestorTitles":["Observability & Ops"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"Observability & Ops serverFetch forwards x-request-id and x-test-auth headers","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"serverFetch forwards x-request-id and x-test-auth headers"}],"endTime":1756202455550,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.observability.spec.ts","startTime":1756202455345,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":[],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"validates role","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"validates role"}],"endTime":1756202455722,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\example.spec.ts","startTime":1756202455555,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime JWKS rotation positive (scaffold)"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"runtime JWKS rotation positive (scaffold) verifies that after cache clear, a token with new kid succeeds","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"todo","title":"verifies that after cache clear, a token with new kid succeeds"}],"endTime":1756202455879,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.jwks.rotation.positive.spec.ts","startTime":1756202455726,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["messages PATCH rate-limit headers"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"messages PATCH rate-limit headers returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"returns 429 with standard headers when limited"}],"endTime":1756202456034,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.patch.ratelimit.spec.ts","startTime":1756202455882,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["GET /api/dashboard"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"GET /api/dashboard unauthenticated returns 401 with request-id header","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"unauthenticated returns 401 with request-id header"},{"ancestorTitles":["GET /api/dashboard"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"GET /api/dashboard teacher returns 200","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"teacher returns 200"}],"endTime":1756202456208,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.dashboard.spec.ts","startTime":1756202456039,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["enrollment schemas"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"enrollment schemas enrollment schema","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"enrollment schema"},{"ancestorTitles":["enrollment schemas"],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"enrollment schemas enrollmentCreateRequest validates","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"enrollmentCreateRequest validates"}],"endTime":1756202456391,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.enrollment.spec.ts","startTime":1756202456212,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["modules test-mode update"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"modules test-mode update returns the updated row with new title and order_index","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"returns the updated row with new title and order_index"}],"endTime":1756202456554,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\modules.update.spec.ts","startTime":1756202456395,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["grade distribution export headers"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"grade distribution export headers csv format returns text/csv content-type","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"csv format returns text/csv content-type"}],"endTime":1756202456693,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.reports.grade-distribution.headers.spec.ts","startTime":1756202456570,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["serverFetch forwards x-csrf-token when cookie present"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"serverFetch forwards x-csrf-token when cookie present adds x-csrf-token header for unsafe method","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"adds x-csrf-token header for unsafe method"}],"endTime":1756202456810,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.serverFetch.csrf-header.spec.ts","startTime":1756202456706,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["admin quotas PATCH rate-limit headers"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"admin quotas PATCH rate-limit headers returns 429 and retry-after header when limited","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"returns 429 and retry-after header when limited"}],"endTime":1756202456945,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.admin.quotas.ratelimit.spec.ts","startTime":1756202456823,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["dashboard service (test-mode)"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"dashboard service (test-mode) teacher dashboard lists recent courses and KPIs","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"teacher dashboard lists recent courses and KPIs"},{"ancestorTitles":["dashboard service (test-mode)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"dashboard service (test-mode) student dashboard computes continueLearning and progress","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"student dashboard computes continueLearning and progress"},{"ancestorTitles":["dashboard service (test-mode)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"dashboard service (test-mode) admin dashboard returns KPI placeholders","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"admin dashboard returns KPI placeholders"}],"endTime":1756202457074,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.dashboard.spec.ts","startTime":1756202456959,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["serverFetch base URL"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"serverFetch base URL prefers PLAYWRIGHT_BASE_URL over NEXT_PUBLIC_BASE_URL and PORT","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"prefers PLAYWRIGHT_BASE_URL over NEXT_PUBLIC_BASE_URL and PORT"},{"ancestorTitles":["serverFetch base URL"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"serverFetch base URL falls back to NEXT_PUBLIC_BASE_URL, else http://localhost:PORT","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"falls back to NEXT_PUBLIC_BASE_URL, else http://localhost:PORT"}],"endTime":1756202457181,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.serverFetch.baseurl.spec.ts","startTime":1756202457090,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["user profile headers and DTO"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"user profile headers and DTO GET /api/user/profile returns x-request-id and JSON","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"GET /api/user/profile returns x-request-id and JSON"}],"endTime":1756202457315,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.user.profile.headers.spec.ts","startTime":1756202457194,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Labs/Student Learning Overview page"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Labs/Student Learning Overview page stubs /api/enrollments and /api/lessons","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"stubs /api/enrollments and /api/lessons"}],"endTime":1756202457500,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\StudentLearningOverview.spec.tsx","startTime":1756202457340,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["services.dashboard needsGrading (test-mode)"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"services.dashboard needsGrading (test-mode) ungraded count across teacher's courses; pagination independent; empty-state","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"ungraded count across teacher's courses; pagination independent; empty-state"}],"endTime":1756202457664,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.dashboard.needsGrading.spec.ts","startTime":1756202457514,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["files upload-url content-type allowlist"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"files upload-url content-type allowlist unsupported content type -> 400","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"unsupported content type -> 400"}],"endTime":1756202457874,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.upload-url.content-type.spec.ts","startTime":1756202457688,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/courses"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"API /api/courses GET unauthorized returns 401 Problem with x-request-id","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"GET unauthorized returns 401 Problem with x-request-id"},{"ancestorTitles":["API /api/courses"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"API /api/courses POST requires teacher role: non-teacher gets 403","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"POST requires teacher role: non-teacher gets 403"},{"ancestorTitles":["API /api/courses"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"API /api/courses GET echoes upstream x-request-id","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"GET echoes upstream x-request-id"}],"endTime":1756202458081,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.courses.spec.ts","startTime":1756202457889,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["parentLinks service (test-mode)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"parentLinks service (test-mode) create, list and delete link","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"create, list and delete link"}],"endTime":1756202458240,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.parentLinks.spec.ts","startTime":1756202458097,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["withRouteTiming CSRF double-submit"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"withRouteTiming CSRF double-submit enforces csrf cookie/header match when enabled","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"enforces csrf cookie/header match when enabled"}],"endTime":1756202458435,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\server.withRouteTiming.csrf-double-submit.spec.ts","startTime":1756202458255,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["assignment schemas"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"assignment schemas assignmentCreateRequest valid","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"assignmentCreateRequest valid"},{"ancestorTitles":["assignment schemas"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"assignment schemas assignmentUpdateRequest requires at least one field","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"assignmentUpdateRequest requires at least one field"},{"ancestorTitles":["assignment schemas"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"assignment schemas assignment schema shape","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"assignment schema shape"}],"endTime":1756202458639,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.assignment.spec.ts","startTime":1756202458455,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Runtime endpoints set Vary: Origin"],"duration":24,"failureDetails":[],"failureMessages":[],"fullName":"Runtime endpoints set Vary: Origin progress preflight","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"progress preflight"}],"endTime":1756202458790,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\runtime.headers.vary.origin.spec.ts","startTime":1756202458652,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["parent-links rate limit signals"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"parent-links rate limit signals returns 429 headers when over limit (window small)","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"returns 429 headers when over limit (window small)"}],"endTime":1756202458915,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.parent-links.ratelimit.spec.ts","startTime":1756202458804,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["serverFetch utils"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"serverFetch utils getBaseUrl prefers PLAYWRIGHT_BASE_URL then NEXT_PUBLIC_BASE_URL then localhost","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"getBaseUrl prefers PLAYWRIGHT_BASE_URL then NEXT_PUBLIC_BASE_URL then localhost"},{"ancestorTitles":["serverFetch utils"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"serverFetch utils PLAYWRIGHT_BASE_URL takes precedence when both set","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"PLAYWRIGHT_BASE_URL takes precedence when both set"},{"ancestorTitles":["serverFetch utils"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"serverFetch utils serverFetch builds absolute URL and propagates headers when given path","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"serverFetch builds absolute URL and propagates headers when given path"},{"ancestorTitles":["serverFetch utils"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"serverFetch utils serverFetch injects x-test-auth from cookies when header missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"serverFetch injects x-test-auth from cookies when header missing"},{"ancestorTitles":["serverFetch utils"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"serverFetch utils serverFetch forwards upstream x-request-id from Next headers when not provided","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"serverFetch forwards upstream x-request-id from Next headers when not provided"}],"endTime":1756202459023,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.serverFetch.spec.ts","startTime":1756202458929,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["jwksCache TTL behavior"],"duration":11,"failureDetails":[],"failureMessages":[],"fullName":"jwksCache TTL behavior returns cached instance within TTL and refreshes after expiry","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"returns cached instance within TTL and refreshes after expiry"}],"endTime":1756202459196,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.jwksCache.ttl.spec.ts","startTime":1756202459041,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime outcomes CORS preflight"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"runtime outcomes CORS preflight OPTIONS returns 204, Vary: Origin and ACAO for allowed origin","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"OPTIONS returns 204, Vary: Origin and ACAO for allowed origin"}],"endTime":1756202459337,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.outcomes.preflight.spec.ts","startTime":1756202459209,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["x-total-count headers on list endpoints (smoke)"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"x-total-count headers on list endpoints (smoke) assignments list sets x-total-count","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"assignments list sets x-total-count"},{"ancestorTitles":["x-total-count headers on list endpoints (smoke)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"x-total-count headers on list endpoints (smoke) submissions list sets x-total-count","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"submissions list sets x-total-count"},{"ancestorTitles":["x-total-count headers on list endpoints (smoke)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"x-total-count headers on list endpoints (smoke) quizzes list sets x-total-count","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"quizzes list sets x-total-count"},{"ancestorTitles":["x-total-count headers on list endpoints (smoke)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"x-total-count headers on list endpoints (smoke) messages threads list sets x-total-count","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"messages threads list sets x-total-count"},{"ancestorTitles":["x-total-count headers on list endpoints (smoke)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"x-total-count headers on list endpoints (smoke) messages list sets x-total-count","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"messages list sets x-total-count"},{"ancestorTitles":["x-total-count headers on list endpoints (smoke)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"x-total-count headers on list endpoints (smoke) notifications list sets x-total-count (prod path)","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"notifications list sets x-total-count (prod path)"},{"ancestorTitles":["x-total-count headers on list endpoints (smoke)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"x-total-count headers on list endpoints (smoke) enrollments list sets x-total-count","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"enrollments list sets x-total-count"},{"ancestorTitles":["x-total-count headers on list endpoints (smoke)"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"x-total-count headers on list endpoints (smoke) runtime outcomes list sets x-total-count","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"pending","title":"runtime outcomes list sets x-total-count"}],"endTime":1756202459509,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.pagination.headers.spec.ts","startTime":1756202459348,"status":"focused","summary":""},{"assertionResults":[{"ancestorTitles":["createApiHandler CSRF"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"createApiHandler CSRF blocks cross-origin POST with 403 Problem","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"blocks cross-origin POST with 403 Problem"},{"ancestorTitles":["createApiHandler CSRF"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"createApiHandler CSRF enforces double-submit CSRF when enabled","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"enforces double-submit CSRF when enabled"},{"ancestorTitles":["createApiHandler CSRF"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"createApiHandler CSRF skips Origin/Referer and double-submit checks for /api/runtime/*","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"skips Origin/Referer and double-submit checks for /api/runtime/*"}],"endTime":1756202459625,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\apiHandler.csrf.spec.ts","startTime":1756202459514,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime outcomes export CSV headers"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"runtime outcomes export CSV headers content headers present or auth errors","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"content headers present or auth errors"}],"endTime":1756202459741,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.reports.export.headers.spec.ts","startTime":1756202459629,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["event schemas"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"event schemas event schema","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"event schema"},{"ancestorTitles":["event schemas"],"duration":15,"failureDetails":[],"failureMessages":[],"fullName":"event schemas eventCreateRequest validates","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"eventCreateRequest validates"}],"endTime":1756202459865,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.event.spec.ts","startTime":1756202459745,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Epic G: Analytics and Reporting (MVP)"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"Epic G: Analytics and Reporting (MVP) emits an event on key user actions (course created, assignment graded)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"todo","title":"emits an event on key user actions (course created, assignment graded)"},{"ancestorTitles":["Epic G: Analytics and Reporting (MVP)"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"Epic G: Analytics and Reporting (MVP) GET /api/reports/course-engagement returns aggregated stats","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"todo","title":"GET /api/reports/course-engagement returns aggregated stats"},{"ancestorTitles":["Epic G: Analytics and Reporting (MVP)"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"Epic G: Analytics and Reporting (MVP) GET /api/reports/grade-distribution returns histogram/percentiles","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"todo","title":"GET /api/reports/grade-distribution returns histogram/percentiles"},{"ancestorTitles":["Epic G: Analytics and Reporting (MVP)"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"Epic G: Analytics and Reporting (MVP) report endpoints support CSV download","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"todo","title":"report endpoints support CSV download"}],"endTime":1756202459945,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.analytics.spec.ts","startTime":1756202459870,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime checkpoint save size limit"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"runtime checkpoint save size limit payload exceeding max bytes returns 400","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"payload exceeding max bytes returns 400"}],"endTime":1756202460153,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.checkpoint.size-limit.spec.ts","startTime":1756202459958,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":[],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"testStore courses add/list/reset","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"testStore courses add/list/reset"},{"ancestorTitles":[],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"testStore lessons add/list/reset","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"testStore lessons add/list/reset"},{"ancestorTitles":[],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"testStore enrollments add/list/reset","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"testStore enrollments add/list/reset"}],"endTime":1756202460297,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\testStore.spec.ts","startTime":1756202460169,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["lib.runtimeAuth verifyRuntimeAuthorization"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"lib.runtimeAuth verifyRuntimeAuthorization bad signature → 403","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"bad signature → 403"},{"ancestorTitles":["lib.runtimeAuth verifyRuntimeAuthorization"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"lib.runtimeAuth verifyRuntimeAuthorization wrong aud when origin allowed → 403","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"wrong aud when origin allowed → 403"},{"ancestorTitles":["lib.runtimeAuth verifyRuntimeAuthorization"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"lib.runtimeAuth verifyRuntimeAuthorization missing scope → 403","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"missing scope → 403"},{"ancestorTitles":["lib.runtimeAuth verifyRuntimeAuthorization"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"lib.runtimeAuth verifyRuntimeAuthorization valid token and scope → ok with claims","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"valid token and scope → ok with claims"}],"endTime":1756202460528,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.runtimeAuth.spec.ts","startTime":1756202460322,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/reports/activity & /api/reports/retention (TEST_MODE)"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"API /api/reports/activity & /api/reports/retention (TEST_MODE) activity: unauth → 401","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"activity: unauth → 401"},{"ancestorTitles":["API /api/reports/activity & /api/reports/retention (TEST_MODE)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"API /api/reports/activity & /api/reports/retention (TEST_MODE) retention: unauth → 401","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"retention: unauth → 401"},{"ancestorTitles":["API /api/reports/activity & /api/reports/retention (TEST_MODE)"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"API /api/reports/activity & /api/reports/retention (TEST_MODE) retention returns array of { day, dau } when authed","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"retention returns array of { day, dau } when authed"}],"endTime":1756202460749,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.reports.activity-retention.spec.ts","startTime":1756202460542,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["providers health API"],"duration":24,"failureDetails":[],"failureMessages":[],"fullName":"providers health API GET requires auth and admin","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"GET requires auth and admin"},{"ancestorTitles":["providers health API"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"providers health API GET returns ok in test-mode and echoes request-id","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"GET returns ok in test-mode and echoes request-id"}],"endTime":1756202460948,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.providers.health.spec.ts","startTime":1756202460754,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["problem envelope invariants across codes"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"problem envelope invariants across codes unauthenticated → 401 with error and x-request-id","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"unauthenticated → 401 with error and x-request-id"},{"ancestorTitles":["problem envelope invariants across codes"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"problem envelope invariants across codes health is 200 with x-request-id","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"health is 200 with x-request-id"}],"endTime":1756202461132,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.problem.envelope.codes.spec.ts","startTime":1756202460952,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["AnnouncementsGateway"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"AnnouncementsGateway listAll returns rows","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"listAll returns rows"}],"endTime":1756202461263,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\gateways\\announcements.gateway.spec.ts","startTime":1756202461136,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["quizAttempts service (test-mode)"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"quizAttempts service (test-mode) start, answer, submit computes score and lists attempts","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"start, answer, submit computes score and lists attempts"},{"ancestorTitles":["quizAttempts service (test-mode)"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"quizAttempts service (test-mode) submit with zero answers yields score 0","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"submit with zero answers yields score 0"}],"endTime":1756202461412,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.quizAttempts.spec.ts","startTime":1756202461268,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["quiz schema boundary values"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"quiz schema boundary values time_limit_sec boundaries and null","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"time_limit_sec boundaries and null"}],"endTime":1756202461532,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.quiz.extend2.spec.ts","startTime":1756202461415,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["metrics label cardinality guard"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"metrics label cardinality guard UUID segments are collapsed to :id","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"UUID segments are collapsed to :id"}],"endTime":1756202461631,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.metrics.cardinality.spec.ts","startTime":1756202461537,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["submissions POST CSRF double-submit negatives"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"submissions POST CSRF double-submit negatives missing CSRF cookie/header yields 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"missing CSRF cookie/header yields 403"},{"ancestorTitles":["submissions POST CSRF double-submit negatives"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"submissions POST CSRF double-submit negatives mismatch CSRF cookie/header yields 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"mismatch CSRF cookie/header yields 403"}],"endTime":1756202461780,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.submissions.csrf.negatives.spec.ts","startTime":1756202461646,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Labs/TeacherCoursesGrid page"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Labs/TeacherCoursesGrid page stubs /api/courses to provide rows","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"stubs /api/courses to provide rows"}],"endTime":1756202461908,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\TeacherCoursesGrid.spec.tsx","startTime":1756202461800,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime checkpoint CORS preflight"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"runtime checkpoint CORS preflight save OPTIONS returns 204 and allow-origin","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"save OPTIONS returns 204 and allow-origin"},{"ancestorTitles":["runtime checkpoint CORS preflight"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"runtime checkpoint CORS preflight load OPTIONS returns 204 and allow-origin","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"load OPTIONS returns 204 and allow-origin"}],"endTime":1756202462063,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.checkpoint.preflight.spec.ts","startTime":1756202461924,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime asset sign-url CORS preflight"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"runtime asset sign-url CORS preflight OPTIONS returns 204 and access-control-allow-origin for allowed origin","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"OPTIONS returns 204 and access-control-allow-origin for allowed origin"}],"endTime":1756202462213,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.asset.sign-url.preflight.spec.ts","startTime":1756202462078,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["UsersGateway"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"UsersGateway updateRole sends PATCH and returns ok","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"updateRole sends PATCH and returns ok"}],"endTime":1756202462343,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\gateways\\users.gateway.spec.ts","startTime":1756202462228,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["rateLimit redis fallback"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"rateLimit redis fallback async falls back to in-memory when redis returns falsy","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"async falls back to in-memory when redis returns falsy"},{"ancestorTitles":["rateLimit redis fallback"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"rateLimit redis fallback sync increments and blocks after limit","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"sync increments and blocks after limit"}],"endTime":1756202462453,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.rateLimit.redis-fallback.spec.ts","startTime":1756202462360,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["files download-url content headers"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"files download-url content headers json includes filename/content_type; in prod path ensures content type present","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"json includes filename/content_type; in prod path ensures content type present"}],"endTime":1756202462592,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.download-url.disposition.spec.ts","startTime":1756202462469,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/enrollments/[id]/launch-token"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"API /api/enrollments/[id]/launch-token unauth → 401; unknown id → 404; non-owner non-teacher → 403","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"unauth → 401; unknown id → 404; non-owner non-teacher → 403"}],"endTime":1756202462791,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.enrollments.launch-token.spec.ts","startTime":1756202462608,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["quizzes service (test-mode)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"quizzes service (test-mode) quiz create/list/update/delete","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"quiz create/list/update/delete"},{"ancestorTitles":["quizzes service (test-mode)"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"quizzes service (test-mode) question and choice flows","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"question and choice flows"}],"endTime":1756202462969,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.quizzes.spec.ts","startTime":1756202462805,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["announcements service (test-mode)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"announcements service (test-mode) create and list announcements with publish filtering","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"create and list announcements with publish filtering"},{"ancestorTitles":["announcements service (test-mode)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"announcements service (test-mode) delete announcement returns ok","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"delete announcement returns ok"}],"endTime":1756202463125,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.announcements.spec.ts","startTime":1756202462986,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["assignment schema defaults/bounds"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"assignment schema defaults/bounds points allows omission","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"points allows omission"}],"endTime":1756202463262,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.assignment.extend.spec.ts","startTime":1756202463140,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["notifications/preferences rate-limit headers"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"notifications/preferences rate-limit headers PATCH returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"PATCH returns 429 with standard headers when limited"}],"endTime":1756202463447,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.notifications-preferences.rate-limit.spec.ts","startTime":1756202463267,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":[],"duration":12,"failureDetails":[],"failureMessages":[],"fullName":"loginRequest validates email and password","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"loginRequest validates email and password"},{"ancestorTitles":[],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"profileResponse schema","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"profileResponse schema"}],"endTime":1756202463640,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.auth.spec.ts","startTime":1756202463451,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["dashboard parent variant"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"dashboard parent variant children defaults to [] and allows unknown keys in parent shape","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"children defaults to [] and allows unknown keys in parent shape"}],"endTime":1756202463806,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.dashboard.parent.spec.ts","startTime":1756202463646,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime v2 asset sign-url endpoint (spec)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"runtime v2 asset sign-url endpoint (spec) POST /api/runtime/asset/sign-url requires files.write and allowed content_type (doc spec)","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"POST /api/runtime/asset/sign-url requires files.write and allowed content_type (doc spec)"}],"endTime":1756202463910,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.asset-sign-url.spec.ts","startTime":1756202463810,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["logger redaction config"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"logger redaction config includes PII fields in redact list","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"includes PII fields in redact list"}],"endTime":1756202464026,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.logger.redaction.spec.ts","startTime":1756202463914,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["progress service"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"progress service markLessonComplete returns latest item","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"markLessonComplete returns latest item"}],"endTime":1756202464155,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.progress.spec.ts","startTime":1756202464030,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["modules service (test-mode)"],"duration":19,"failureDetails":[],"failureMessages":[],"fullName":"modules service (test-mode) create, list ordered by order_index, and delete","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"create, list ordered by order_index, and delete"}],"endTime":1756202464328,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.modules.spec.ts","startTime":1756202464160,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["api.health"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"api.health returns ok true and detects role via header","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"returns ok true and detects role via header"},{"ancestorTitles":["api.health"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"api.health returns ok true without auth","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"returns ok true without auth"},{"ancestorTitles":["Health API"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Health API returns ok and reflects testMode and role from header/cookie","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"returns ok and reflects testMode and role from header/cookie"}],"endTime":1756202464466,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.health.spec.ts","startTime":1756202464332,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["files access scope (TEST_MODE)"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"files access scope (TEST_MODE) upload/download should be scoped by owner_type/owner_id - negative placeholder","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"upload/download should be scoped by owner_type/owner_id - negative placeholder"}],"endTime":1756202464612,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.files.access.spec.ts","startTime":1756202464470,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["messages list GET rate-limit headers"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"messages list GET rate-limit headers returns 429 with standard headers when limited","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"returns 429 with standard headers when limited"}],"endTime":1756202464745,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.list.ratelimit.spec.ts","startTime":1756202464615,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["messages threads pagination params"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"messages threads pagination params non-numeric values clamp to defaults, 200 includes x-total-count","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"non-numeric values clamp to defaults, 200 includes x-total-count"}],"endTime":1756202464897,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.threads.pagination.params.spec.ts","startTime":1756202464749,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Labs/Teacher Print pages"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Labs/Teacher Print pages stubs lessons for course print routes","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"stubs lessons for course print routes"}],"endTime":1756202465047,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\TeacherPrintPages.spec.tsx","startTime":1756202464908,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["quiz schema bounds and fields"],"duration":67,"failureDetails":[],"failureMessages":[],"fullName":"quiz schema bounds and fields time_limit_sec bounds respected","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"time_limit_sec bounds respected"}],"endTime":1756202465360,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.quiz.extend.spec.ts","startTime":1756202465053,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["dashboard schemas"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"dashboard schemas student continueLearning supports nextLessonId","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"student continueLearning supports nextLessonId"},{"ancestorTitles":["dashboard schemas"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"dashboard schemas teacher/admin KPIs required shape","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"teacher/admin KPIs required shape"},{"ancestorTitles":["dashboard schemas"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"dashboard schemas dashboardResponse discriminated union guards by role","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"dashboardResponse discriminated union guards by role"}],"endTime":1756202465635,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.dashboard.spec.ts","startTime":1756202465373,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["logger redaction extended fields"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"logger redaction extended fields redact list contains email, message.body, attachments.object_key","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"redact list contains email, message.body, attachments.object_key"}],"endTime":1756202465812,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.logger.redaction.extended.spec.ts","startTime":1756202465664,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["lib rateLimit"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"lib rateLimit allows within limit then blocks with headers info semantics","invocations":1,"location":null,"numPassingAsserts":7,"retryReasons":[],"status":"passed","title":"allows within limit then blocks with headers info semantics"}],"endTime":1756202465980,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.rateLimit.spec.ts","startTime":1756202465832,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["createApiHandler request id behavior"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"createApiHandler request id behavior reuses upstream x-request-id and echoes it back","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"reuses upstream x-request-id and echoes it back"},{"ancestorTitles":["createApiHandler request id behavior"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"createApiHandler request id behavior generates a request id when missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"generates a request id when missing"}],"endTime":1756202466145,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\apiHandler.requestId.spec.ts","startTime":1756202465994,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["services.notifications (test-store producers/prefs)"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"services.notifications (test-store producers/prefs) producers called on submission graded; preferences gating simulated","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"producers called on submission graded; preferences gating simulated"}],"endTime":1756202466327,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.notifications.spec.ts","startTime":1756202466161,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["withRouteTiming global mutation rate limit"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"withRouteTiming global mutation rate limit limit 1 per window -> 200 then 429 with same IP","invocations":1,"location":null,"numPassingAsserts":6,"retryReasons":[],"status":"passed","title":"limit 1 per window -> 200 then 429 with same IP"}],"endTime":1756202466576,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\server.withRouteTiming.ratelimit.spec.ts","startTime":1756202466331,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["lesson schemas"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"lesson schemas validates lessonCreateRequest","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"validates lessonCreateRequest"},{"ancestorTitles":["lesson schemas"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"lesson schemas rejects short title","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"rejects short title"},{"ancestorTitles":["lesson schemas"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"lesson schemas validates lessonReorderRequest","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"validates lessonReorderRequest"}],"endTime":1756202466720,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.lesson.spec.ts","startTime":1756202466580,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["FlagsGateway"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"FlagsGateway list returns flags map","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"list returns flags map"}],"endTime":1756202466834,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\gateways\\flags.gateway.spec.ts","startTime":1756202466724,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Problem envelope schema"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Problem envelope schema validates shape with optional details","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"validates shape with optional details"},{"ancestorTitles":["Problem envelope schema"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"Problem envelope schema unknown keys are tolerated (not strict)","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"unknown keys are tolerated (not strict)"}],"endTime":1756202466962,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.problem.spec.ts","startTime":1756202466840,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["message schemas"],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"message schemas thread and thread create request","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"thread and thread create request"},{"ancestorTitles":["message schemas"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"message schemas message and create request","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"message and create request"}],"endTime":1756202467110,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.message.spec.ts","startTime":1756202466965,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["API /api/lessons"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"API /api/lessons GET without course_id → 400 Problem","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"GET without course_id → 400 Problem"},{"ancestorTitles":["API /api/lessons"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"API /api/lessons POST validate title min length (<3) → 400","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"POST validate title min length (<3) → 400"}],"endTime":1756202467248,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.lessons.spec.ts","startTime":1756202467114,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["middleware COEP flag"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"middleware COEP flag sets Cross-Origin-Embedder-Policy when COEP=1","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"sets Cross-Origin-Embedder-Policy when COEP=1"}],"endTime":1756202467341,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\middleware.coep.flag.spec.ts","startTime":1756202467252,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["notifications guard (prod path)"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"notifications guard (prod path) MVP guard returns [] (or Problem if not allowed) and echoes x-request-id","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"MVP guard returns [] (or Problem if not allowed) and echoes x-request-id"}],"endTime":1756202467493,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.notifications.guard.spec.ts","startTime":1756202467344,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["submissions queue edges"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"submissions queue edges page <= 0 clamps to first page; very large page returns empty","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"page <= 0 clamps to first page; very large page returns empty"}],"endTime":1756202467583,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.submissions.queue.edges.spec.ts","startTime":1756202467498,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Epic I: Access Control & Permissions"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"Epic I: Access Control & Permissions admin can update role via PATCH /api/user/role","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"todo","title":"admin can update role via PATCH /api/user/role"},{"ancestorTitles":["Epic I: Access Control & Permissions"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"Epic I: Access Control & Permissions course ownership transfer endpoint enforces teacher/admin role","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"todo","title":"course ownership transfer endpoint enforces teacher/admin role"},{"ancestorTitles":["Epic I: Access Control & Permissions"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"Epic I: Access Control & Permissions parent links CRUD restricted to admin","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"todo","title":"parent links CRUD restricted to admin"},{"ancestorTitles":["Epic I: Access Control & Permissions"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"Epic I: Access Control & Permissions role gating applied to dashboards and course pages (SSR)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"todo","title":"role gating applied to dashboards and course pages (SSR)"}],"endTime":1756202467681,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.access-control.spec.ts","startTime":1756202467586,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime checkpoint save/load"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"runtime checkpoint save/load oversize payload rejected","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"oversize payload rejected"}],"endTime":1756202467806,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.checkpoint.roundtrip.spec.ts","startTime":1756202467696,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["api.notifications (test-mode)"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"api.notifications (test-mode) GET returns notifications array for logged-in user","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"GET returns notifications array for logged-in user"},{"ancestorTitles":["api.notifications (test-mode)"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"api.notifications (test-mode) PATCH marks read and returns row","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"PATCH marks read and returns row"}],"endTime":1756202467957,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.notifications.spec.ts","startTime":1756202467821,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Labs/Student Enrollments Grid page"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Labs/Student Enrollments Grid page stubs /api/enrollments","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"stubs /api/enrollments"}],"endTime":1756202468102,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\ui\\StudentEnrollmentsGrid.spec.tsx","startTime":1756202467990,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["runtime events CORS preflight"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"runtime events CORS preflight OPTIONS returns 204 and access-control-allow-origin for allowed origin","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"OPTIONS returns 204 and access-control-allow-origin for allowed origin"}],"endTime":1756202468302,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.runtime.events.preflight.spec.ts","startTime":1756202468120,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["GET /api/progress per_student access control (non-test mode)"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"GET /api/progress per_student access control (non-test mode) teacher cannot read per-student aggregates for non-owned course -> 403","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"teacher cannot read per-student aggregates for non-owned course -> 403"}],"endTime":1756202468564,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.progress.access.spec.ts","startTime":1756202468320,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["api.messages CSRF double-submit enforcement"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"api.messages CSRF double-submit enforcement 403 when CSRF tokens missing or mismatched; 201 when matched","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"403 when CSRF tokens missing or mismatched; 201 when matched"}],"endTime":1756202468715,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.messages.csrf-double-submit.spec.ts","startTime":1756202468580,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["parentLink schemas"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"parentLink schemas parentLink schema shape","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"parentLink schema shape"},{"ancestorTitles":["parentLink schemas"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"parentLink schemas create and delete requests validate","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"create and delete requests validate"}],"endTime":1756202468876,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.parentLink.spec.ts","startTime":1756202468735,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["paginate helpers edge cases"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"paginate helpers edge cases toQuery clamps defaults for undefined","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"toQuery clamps defaults for undefined"},{"ancestorTitles":["paginate helpers edge cases"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"paginate helpers edge cases parseTotalCount returns undefined for invalid values","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"parseTotalCount returns undefined for invalid values"}],"endTime":1756202469026,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.paginate.edgecases.spec.ts","startTime":1756202468891,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["CORS preflight and allow headers"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"CORS preflight and allow headers OPTIONS echoes allow headers for allowed origin","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"OPTIONS echoes allow headers for allowed origin"},{"ancestorTitles":["CORS preflight and allow headers"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"CORS preflight and allow headers GET sets vary and allow-origin when origin allowed (no token path)","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"GET sets vary and allow-origin when origin allowed (no token path)"}],"endTime":1756202469185,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.cors.preflight.spec.ts","startTime":1756202469043,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["env loader"],"duration":11,"failureDetails":[],"failureMessages":[],"fullName":"env loader throws when missing required env","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"throws when missing required env"},{"ancestorTitles":["env loader"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"env loader succeeds with valid env","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"succeeds with valid env"}],"endTime":1756202469306,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.env.spec.ts","startTime":1756202469199,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["HealthGateway"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"HealthGateway get() returns ok, ts shape","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"get() returns ok, ts shape"}],"endTime":1756202469429,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\gateways\\health.gateway.spec.ts","startTime":1756202469325,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["submissions service (test-mode)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"submissions service (test-mode) create, list and grade submission triggers notification","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"create, list and grade submission triggers notification"}],"endTime":1756202469575,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.submissions.spec.ts","startTime":1756202469451,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["files schema contracts (route IO shapes)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"files schema contracts (route IO shapes) upload-url request accepts default content_type","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"upload-url request accepts default content_type"},{"ancestorTitles":["files schema contracts (route IO shapes)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"files schema contracts (route IO shapes) upload-url response contains signed url and fields object","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"upload-url response contains signed url and fields object"}],"endTime":1756202469690,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.files.spec.ts","startTime":1756202469593,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["fetchJson"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"fetchJson throws on non-OK with error payload","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"throws on non-OK with error payload"},{"ancestorTitles":["fetchJson"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"fetchJson validates ok JSON against schema","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"validates ok JSON against schema"}],"endTime":1756202469811,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\sdk.fetchJson.spec.ts","startTime":1756202469694,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["services.assignments producer (test-mode)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"services.assignments producer (test-mode) createAssignmentApi enqueues notification to enrolled students","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"createAssignmentApi enqueues notification to enrolled students"}],"endTime":1756202469944,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.assignments.producer.spec.ts","startTime":1756202469814,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["env numeric bounds validation"],"duration":9,"failureDetails":[],"failureMessages":[],"fullName":"env numeric bounds validation negative GLOBAL_MUTATION_RATE_LIMIT throws","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"negative GLOBAL_MUTATION_RATE_LIMIT throws"},{"ancestorTitles":["env numeric bounds validation"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"env numeric bounds validation non-numeric WINDOW throws","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"non-numeric WINDOW throws"}],"endTime":1756202470066,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.env.numeric-bounds.spec.ts","startTime":1756202469947,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Profile avatar upload (future)"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"Profile avatar upload (future) PUT /api/user/profile accepts avatar_url and returns 200","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"todo","title":"PUT /api/user/profile accepts avatar_url and returns 200"},{"ancestorTitles":["Profile avatar upload (future)"],"duration":null,"failureDetails":[],"failureMessages":[],"fullName":"Profile avatar upload (future) avatar upload via signed URL (files API) updates profile avatar_url","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"todo","title":"avatar upload via signed URL (files API) updates profile avatar_url"}],"endTime":1756202470171,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\future.profile-avatar.spec.ts","startTime":1756202470069,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["services.files signing (test store)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"services.files signing (test store) upload/download signing uses correct bucket/key, content types (simulated)","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"upload/download signing uses correct bucket/key, content types (simulated)"}],"endTime":1756202470303,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.files.signing.spec.ts","startTime":1756202470175,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["middleware security headers"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"middleware security headers sets X-Frame-Options: DENY and CSP frame-ancestors none","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"sets X-Frame-Options: DENY and CSP frame-ancestors none"}],"endTime":1756202470464,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\middleware.security-headers.spec.ts","startTime":1756202470306,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["schema strictness"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"schema strictness assignmentCreateRequest rejects unknown keys","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"assignmentCreateRequest rejects unknown keys"},{"ancestorTitles":["schema strictness"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"schema strictness assignmentUpdateRequest rejects empty and unknown keys","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"assignmentUpdateRequest rejects empty and unknown keys"},{"ancestorTitles":["schema strictness"],"duration":0,"failureDetails":[],"failureMessages":[],"fullName":"schema strictness courseCreateRequest rejects unknown keys","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"courseCreateRequest rejects unknown keys"}],"endTime":1756202470615,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.strictness.spec.ts","startTime":1756202470469,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["security headers (CSP frame-ancestors + X-Frame-Options)"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"security headers (CSP frame-ancestors + X-Frame-Options) middleware sets CSP frame-ancestors none and X-Frame-Options DENY","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"middleware sets CSP frame-ancestors none and X-Frame-Options DENY"}],"endTime":1756202470766,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.headers.security.spec.ts","startTime":1756202470620,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["submission schemas"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"submission schemas submission schema","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"submission schema"},{"ancestorTitles":["submission schemas"],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"submission schemas submissionCreateRequest validates","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"submissionCreateRequest validates"},{"ancestorTitles":["submission schemas"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"submission schemas submissionGradeRequest validates range","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"submissionGradeRequest validates range"}],"endTime":1756202470961,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\schemas.submission.spec.ts","startTime":1756202470792,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["production guards (middleware)"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"production guards (middleware) rejects x-test-auth when not in test mode","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"rejects x-test-auth when not in test mode"},{"ancestorTitles":["production guards (middleware)"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"production guards (middleware) errors when TEST_MODE is set in production","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"errors when TEST_MODE is set in production"}],"endTime":1756202471127,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\api.modes.prod-guards.spec.ts","startTime":1756202470988,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["CSP builder"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"CSP builder includes nonce and allowed connect-src","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"includes nonce and allowed connect-src"}],"endTime":1756202471289,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\lib.csp.headers.spec.ts","startTime":1756202471142,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["users service (test-mode)"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"users service (test-mode) updateUserRole stores role in test profile","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"updateUserRole stores role in test profile"}],"endTime":1756202471444,"message":"","name":"C:\\Users\\agafn\\Desktop\\education system 5\\tests\\unit\\services.users.spec.ts","startTime":1756202471305,"status":"passed","summary":""}],"wasInterrupted":false}
