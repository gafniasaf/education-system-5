FAIL tests/unit/ui/NotificationsDropdownClient.spec.tsx
  ‚óè Load more appends items

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: 20

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<div[39m
            [33mdata-testid[39m=[32m"notif-list"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center justify-between mb-2"[39m
            [36m>[39m
              [36m<span[39m
                [33mclass[39m=[32m"font-medium"[39m
              [36m>[39m
                [0mNotifications[0m
              [36m</span>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Mark all notifications as read"[39m
                [33mclass[39m=[32m"underline text-xs"[39m
                [33mdata-testid[39m=[32m"notif-mark-all"[39m
                [33mtitle[39m=[32m"Mark all read"[39m
              [36m>[39m
                [0mMark all[0m
              [36m</button>[39m
            [36m</div>[39m
            [36m<ul[39m
              [33mclass[39m=[32m"space-y-2"[39m
            [36m>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m""[39m
                [36m>[39m
                  [36m<span>[39m
                    [0msubmission:graded[0m
                  [36m</span>[39m
                  [36m<span[39m
                    [33mclass[39m=[32m"ml-2"[39m
                  [36m>[39m
                    [0mScore: [0m
                    [0m80[0m
                  [36m</span>[39m
                [36m</div>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Mark notification no-0000 as read"[39m
                  [33mclass[39m=[32m"underline text-xs"[39m
                  [33mdata-testid[39m=[32m"notif-read-btn"[39m
                [36m>[39m
                  [0mRead[0m
                [36m</button>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-gray-500"[39m
                [36m>[39m
                  [36m<span>[39m
                    [0mmessage:new[0m
                  [36m</span>[39m
                  [36m<a[39m
                    [33mclass[39m=[32m"ml-2 underline"[39m
                    [33mhref[39m=[32m"/labs/system/inbox?thread=th-1"[39m
                  [36m>[39m
                    [0mOpen thread[0m
                  [36m</a>[39m
                [36m</div>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-gray-500"[39m
                [36m>[39m
                  [36m<span>[39m
                    [0mannouncement:published[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-gray-500"[39m
                [36m>[39m
                  [36m<span>[39m
                    [0msubmission:graded[0m
                  [36m</span>[39m
                  [36m<span[39m
                    [33mclass[39m=[32m"ml-2"[39m
                  [36m>[39m
                    [0mScore: [0m
                    [0m83[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-gray-500"[39m
                [36m>[39m
                  [36m<span>[39m
                    [0mmessage:new[0m
                  [36m</span>[39m
                  [36m<a[39m
                    [33mclass[39m=[32m"ml-2 underline"[39m
                    [33mhref[39m=[32m"/labs/system/inbox?thread=th-4"[39m
                  [36m>[39m
                    [0mOpen thread[0m
                  [36m</a>[39m
                [36m</div>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m""[39m
                [36m>[39m
                  [36m<span>[39m
                    [0mannouncement:published[0m
                  [36m</span>[39m
                [36m</div>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Mark notification no-0005 as read"[39m
                  [33mclass[39m=[32m"underline text-xs"[39m
                  [33mdata-testid[39m=[32m"notif-read-btn"[39m
                [36m>[39m
                  [0mRead[0m
                [36m</button>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-gray-500"[39m
                [36m>[39m
                  [36m<span>[39m
                    [0msubmission:graded[0m
                  [36m</span>[39m
                  [36m<span[39m
                    [33mclass[39m=[32m"ml-2"[39m
                  [36m>[39m
                    [0mScore: [0m
                    [0m86[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-gray-500"[39m
                [36m>[39m
                  [36m<span>[39m
                    [0mmessage:new[0m
                  [36m</span>[39m
                  [36m<a[39m
                    [33mclass[39m=[32m"ml-2 underline"[39m
                    [33mhref[39m=[32m"/labs/system/inbox?thread=th-7"[39m
                  [36m>[39m
                    [0mOpen thread[0m
                  [36m</a>[39m
                [36m</div>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-gray-500"[39m
                [36m>[39m
                  [36m<span>[39m
                    [0mannouncement:published[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-gray-500"[39m
                [36m>[39m
                  [36m<span>[39m
                    [0msubmission:graded[0m
                  [36m</span>[39m
                  [36m<span[39m
                    [33mclass[39m=[32m"ml-2"[39m
                  [36m>[39m
                    [0mScore: [0m
                    [0m89[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m""[39m
                [36m>[39m
                  [36m<span>[39m
                    [0mmessage:new[0m
                  [36m</span>[39m
                  [36m<a[39m
                    [33mclass[39m=[32m"ml-2 underline"[39m
                    [33mhref[39m=[32m"/labs/system/inbox?thread=th-10"[39m
                  [36m>[39m
                    [0mOpen thread[0m
                  [36m</a>[39m
                [36m</div>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Mark notification no-0010 as read"[39m
                  [33mclass[39m=[32m"underline text-xs"[39m
                  [33mdata-testid[39m=[32m"notif-read-btn"[39m
                [36m>[39m
                  [0mRead[0m
                [36m</button>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-gray-500"[39m
                [36m>[39m
                  [36m<span>[39m
                    [0mannouncement:published[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-gray-500"[39m
                [36m>[39m
                  [36m<span>[39m
                    [0msubmission:graded[0m
                  [36m</span>[39m
                  [36m<span[39m
                    [33mclass[39m=[32m"ml-2"[39m
                  [36m>[39m
                    [0mScore: [0m
                    [0m92[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-gray-500"[39m
                [36m>[39m
                  [36m<span>[39m
                    [0mmessage:new[0m
                  [36m</span>[39m
                  [36m<a[39m
                    [33mclass[39m=[32m"ml-2 underline"[39m
                    [33mhref[39m=[32m"/labs/system/inbox?thread=th-13"[39m
                  [36m>[39m
                    [0mOpen thread[0m
                  [36m</a>[39m
                [36m</div>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-gray-500"[39m
                [36m>[39m
                  [36m<span>[39m
                    [0mannouncement:published[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m""[39m
                [36m>[39m
                  [36m<span>[39m
                    [0msubmission:graded[0m
                  [36m</span>[39m
                  [36m<span[39m
                    [33mclass[39m=[32m"ml-2"[39m
                  [36m>[39m
                    [0mScore: [0m
                    [0m95[0m
                  [36m</span>[39m
                [36m</div>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Mark notification no-0015 as read"[39m
                  [33mclass[39m=[32m"underline text-xs"[39m
                  [33mdata-testid[39m=[32m"notif-read-btn"[39m
                [36m>[39m
                  [0mRead[0m
                [36m</button>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-gray-500"[39m
                [36m>[39m
                  [36m<span>[39m
                    [0mmessage:new[0m
                  [36m</span>[39m
                  [36m<a[39m
                    [33mclass[39m=[32m"ml-2 underline"[39m
                    [33mhref[39m=[32m"/labs/system/inbox?thread=th-16"[39m
                  [36m>[39m
                    [0mOpen thread[0m
                  [36m</a>[39m
                [36m</div>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-gray-500"[39m
                [36m>[39m
                  [36m<span>[39m
                    [0mannouncement:published[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-gray-500"[39m
                [36m>[39m
                  [36m<span>[39m
                    [0msubmission:graded[0m
                  [36m</span>[39m
                  [36m<span[39m
                    [33mclass[39m=[32m"ml-2"[39m
                  [36m>[39m
                    [0mScore: [0m
                    [0m98[0m
                  [36m</span>[39m
                [36m</div>[39m
              [36m</li>[39m
              [36m<li[39m
                [33mclass[39m=[32m"flex items-center justify-between gap-2"[39m
                [33mdata-testid[39m=[32m"notif-item"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-gray-500"[39m
                [36m>[39m
                  [36m<span>[39m
                    [0mmessage:new[0m
                  [36m</span>[39m
                  [36m<a[39m
                    [33mclass[39m=[32m"ml-2 underline"[39m
                    [33mhref[39m=[32m"/labs/system/inbox?thread=th-19"[39m
                  [36m>[39m
                    [0mOpen thread[0m
                  [36m</a>[39m
                [36m</div>[39m
              [36m</li>[39m
            [36m</ul>[39m
            [36m<div[39m
              [33mclass[39m=[32m"mt-2 flex justify-end"[39m
            [36m>[39m
              [36m<button[39m
                [33mclass[39m=[32m"underline text-xs"[39m
                [33mdata-testid[39m=[32m"notif-load-more"[39m
              [36m>[39m
                [0mLoad more[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</body>[39m
    [36m</html>[39m

      55 |   render(<NotificationsDropdownClient initial={[]} />);
      56 |   await user.click(screen.getByTestId('notif-load-more'));
    > 57 |   await waitFor(() => expect(screen.getAllByTestId('notif-item').length).toBe(2));
         |                                                                          ^
      58 |   restore();
      59 | });
      60 |

      at unit/ui/NotificationsDropdownClient.spec.tsx:57:74
      at runWithExpensiveErrorDiagnosticsDisabled (../node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (../node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (../node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (../node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

PASS tests/unit/ui/AdminReports.spec.tsx
FAIL tests/unit/ui/SystemHealthHistory.spec.tsx
  ‚óè System Health History (labs) ‚Ä∫ renders delta stats and timestamps with jitter

    ReferenceError: Response is not defined

      23 |     } catch {}
      24 |     if (typeof originalFetch === 'function') return originalFetch(input as any, init);
    > 25 |     return new Response(JSON.stringify({ ok: false }), { status: 404, headers: { 'content-type': 'application/json' } });
         |     ^
      26 |   };
      27 | }
      28 |

      at g.fetch (shims/msw-node.ts:25:5)
      at g.fetch (shims/msw-node.ts:24:53)
      at serverFetch (../apps/web/src/lib/serverFetch.ts:74:21)
      at fetchJson (../apps/web/src/lib/serverFetch.ts:88:21)
      at Object.get (../apps/web/src/lib/data/health.ts:14:23)
      at takeSamples (../apps/web/src/app/labs/system/health-history/page.tsx:11:47)
      at HealthHistoryPage (../apps/web/src/app/labs/system/health-history/page.tsx:34:25)
      at Object.<anonymous> (unit/ui/SystemHealthHistory.spec.tsx:15:39)

FAIL tests/unit/ui/SystemUptimeTile.spec.tsx
  ‚óè System Uptime Tile (labs) ‚Ä∫ renders ok and ts fields under jitter

    Unable to find an element by: [data-testid="uptime-ok"]

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<main[39m
          [33mclass[39m=[32m"p-6"[39m
        [36m>[39m
          [36m<h1[39m
            [33mclass[39m=[32m"text-xl font-semibold"[39m
          [36m>[39m
            [0mSystem uptime[0m
          [36m</h1>[39m
          [36m<p[39m
            [33mclass[39m=[32m"text-gray-700"[39m
          [36m>[39m
            [0mUnable to load uptime.[0m
          [36m</p>[39m
        [36m</main>[39m
      [36m</div>[39m
    [36m</body>[39m

      16 |     const ui = await UptimeTilePage();
      17 |     render(ui);
    > 18 |     await screen.findByTestId('uptime-ok');
         |                  ^
      19 |     await screen.findByTestId('uptime-ts-iso');
      20 |     await screen.findByTestId('uptime-ts-human');
      21 |   });

      at waitForWrapper (../node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at ../node_modules/@testing-library/dom/dist/query-helpers.js:86:33
      at Object.<anonymous> (unit/ui/SystemUptimeTile.spec.tsx:18:18)

FAIL tests/unit/ui/SystemRoleBadge.spec.tsx
  ‚óè System Role Badge (labs) ‚Ä∫ renders role and test mode

    ReferenceError: Response is not defined

      23 |     } catch {}
      24 |     if (typeof originalFetch === 'function') return originalFetch(input as any, init);
    > 25 |     return new Response(JSON.stringify({ ok: false }), { status: 404, headers: { 'content-type': 'application/json' } });
         |     ^
      26 |   };
      27 | }
      28 |

      at g.fetch (shims/msw-node.ts:25:5)
      at g.fetch (shims/msw-node.ts:24:53)
      at serverFetch (../apps/web/src/lib/serverFetch.ts:74:21)
      at fetchJson (../apps/web/src/lib/serverFetch.ts:88:21)
      at Object.get (../apps/web/src/lib/data/health.ts:14:23)
      at SystemRoleBadgePage (../apps/web/src/app/labs/system/role-badge/page.tsx:10:44)
      at Object.<anonymous> (unit/ui/SystemRoleBadge.spec.tsx:15:41)

FAIL tests/unit/ui/SystemOkCard.spec.tsx
  ‚óè System OK Card (labs) ‚Ä∫ renders ok and ts (human) on success

    expect(element).toHaveTextContent()

    Expected element to have text content:
      true
    Received:
      false

      16 |     const ui = await SystemOkCardPage();
      17 |     render(ui);
    > 18 |     expect(await screen.findByTestId('ok-value')).toHaveTextContent('true');
         |                                                   ^
      19 |     await screen.findByTestId('ts-human');
      20 |   });
      21 | });

      at Object.<anonymous> (unit/ui/SystemOkCard.spec.tsx:18:51)

FAIL tests/unit/ui/SystemRequestId.spec.tsx
  ‚óè System Request ID (labs) ‚Ä∫ renders request-id from response headers when present

    expect(element).toHaveTextContent()

    Expected element to have text content:
      req-123
    Received:
      generated-1755698632460

      17 |     const ui = await RequestIdPage();
      18 |     render(ui);
    > 19 |     expect(await screen.findByTestId('request-id')).toHaveTextContent('req-123');
         |                                                     ^
      20 |   });
      21 | });
      22 |

      at Object.<anonymous> (unit/ui/SystemRequestId.spec.tsx:19:53)

Test Suites: 6 failed, 1 passed, 7 total
Tests:       6 failed, 2 passed, 8 total
Snapshots:   0 total
Time:        7.741 s
Ran all test suites related to files matching /tests\/unit\/ui\/SystemHealthHistory.spec.tsx|tests\/unit\/ui\/SystemUptimeTile.spec.tsx|tests\/unit\/ui\/SystemRoleBadge.spec.tsx|tests\/unit\/ui\/SystemOkCard.spec.tsx|tests\/unit\/ui\/SystemRequestId.spec.tsx|tests\/unit\/ui\/AdminReports.spec.tsx|tests\/unit\/ui\/NotificationsDropdownClient.spec.tsx/i.
